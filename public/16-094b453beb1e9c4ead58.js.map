{"version":3,"sources":["webpack:///./node_modules/@firebase/performance/dist/index.cjs.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/idb/build/idb.js","webpack:///./node_modules/firebase/performance/dist/index.esm.js"],"names":["Object","defineProperty","exports","value","ex","firebase","_a","apiInstance","windowInstance","settingsServiceInstance","tslib","util","logger$1","component","name","version","SDK_VERSION","TRACE_START_MARK_PREFIX","TRACE_STOP_MARK_PREFIX","TRACE_MEASURE_PREFIX","OOB_TRACE_PAGE_LOAD_PREFIX","CONFIG_LOCAL_STORAGE_KEY","CONFIG_EXPIRY_LOCAL_STORAGE_KEY","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","ErrorFactory","Api","window","this","create","performance","PerformanceObserver","windowLocation","location","navigator","document","cookieEnabled","localStorage","perfMetrics","onFirstInputDelay","prototype","getUrl","href","split","mark","measure","measureName","mark1","mark2","getEntriesByType","type","getEntriesByName","getTimeOrigin","timeOrigin","timing","navigationStart","requiredApisAvailable","fetch","Promise","setupObserver","entryType","callback","list","_i","getEntries","length","entry","observe","entryTypes","getInstance","undefined","iid","VisibilityState","SettingsService","instrumentationEnabled","dataCollectionEnabled","loggingEnabled","tracesSamplingRate","networkRequestsSamplingRate","logEndPointUrl","logSource","logTraceAfterSampling","logNetworkAfterSampling","configTimeToLive","getAppId","appId","firebaseAppInstance","options","getProjectId","projectId","getApiKey","apiKey","getIid","RESERVED_ATTRIBUTE_PREFIXES","ATTRIBUTE_FORMAT_REGEX","RegExp","MAX_ATTRIBUTE_NAME_LENGTH","MAX_ATTRIBUTE_VALUE_LENGTH","getServiceWorkerStatus","serviceWorker","controller","getVisibilityState","visibilityState","VISIBLE","HIDDEN","UNKNOWN","getEffectiveConnectionType","navigatorConnection","connection","effectiveType","consoleLogger","Logger","logLevel","LogLevel","INFO","REMOTE_CONFIG_SDK_VERSION","SECONDARY_CONFIGS","FIS_AUTH_PREFIX","getConfig","config","expiryString","getItem","expiry","Number","Date","now","configStringified","JSON","parse","getStoredConfig","processConfig","resolve","authTokenPromise","installationsService","getToken","then","authTokenVal","authToken","configEndPoint","request","Request","method","headers","Authorization","body","stringify","app_instance_id","app_instance_id_token","app_id","app_version","sdk_version","response","ok","json","info","COULD_NOT_GET_CONFIG_MSG","getRemoteConfig","setItem","String","storeConfig","entries","fpr_enabled","fpr_log_source","fpr_log_endpoint_url","fpr_vc_network_request_sampling_rate","fpr_vc_trace_sampling_rate","shouldLogAfterSampling","samplingRate","Math","random","initializationPromise","initializationStatus","getInitializationPromise","readyState","addEventListener","handler_1","removeEventListener","iidPromise","getId","iidVal","changeInitializationStatus","logger","DEFAULT_SEND_INTERVAL_MS","DEFAULT_REMAINING_TRIES","remainingTries","queue","addToQueue","evt","eventTime","message","__spreadArrays","getLogger","ccLogger","serializer","_loggerInstance","_level","args","arguments","apply","ccHandler","logHandler","logTrace","trace","settingsService","isAuto","sendTraceLog","setTimeout","log","resource","resourceType","networkRequestMetric","url","networkRequest","http_method","httpMethod","http_response_code","response_payload_bytes","responsePayloadBytes","client_start_time_us","startTimeUs","time_to_response_initiated_us","timeToResponseInitiatedUs","time_to_response_completed_us","timeToResponseCompletedUs","perfMetric","application_info","getApplicationInfo","network_request_metric","traceMetric","is_auto","duration_us","durationUs","keys","counters","convertToKeyValueArray","customAttributes","getAttributes","custom_attributes","trace_metric","serializeTrace","google_app_id","web_app_info","page_url","service_worker_status","visibility_state","effective_connection_type","application_process_state","obj","map","key","processQueue","timeOffset","staged","log_event","source_extension_json","event_time_ms","data","request_time_ms","client_info","client_type","js_client_info","log_source","res","wait","next_request_wait_millis","requestOffset","isNaN","max","MAX_METRIC_NAME_LENGTH","RESERVED_AUTO_PREFIX","oobMetrics","Trace","traceMeasureName","state","api","randomId","floor","traceStartMark","traceStopMark","traceMeasure","calculateTraceMetrics","start","traceName","stop","record","startTime","duration","attributes","__assign","metrics","metric","incrementMetric","counter","num","putMetric","startsWith","indexOf","isValidMetricName","customMetricName","getMetric","putAttribute","attr","isValidName","some","prefix","match","isValidCustomAttributeName","isValidValue","isValidCustomAttributeValue","attributeName","attributeValue","getAttribute","removeAttribute","setStartTime","setDuration","perfMeasureEntries","perfMeasureEntry","createOobTrace","navigationTimings","paintTimings","firstInputDelay","route","timeOriginUs","domInteractive","domContentLoadedEventEnd","loadEventEnd","firstPaint","find","paintObject","firstContentfulPaint","createUserTimingTrace","createNetworkRequestEntry","performanceEntry","responseStart","responseEnd","logNetworkRequest","transferSize","FID_WAIT_TIME_MS","setupOobResources","timeoutId_1","fid","clearTimeout","setupOobTraces","resources","resources_1","setupNetworkRequests","measures","measures_1","setupUserTimingTraces","substring","PerformanceController","app","get","set","val","enumerable","configurable","DEFAULT_ENTRY_NAME","registerPerformance","instance","factoryMethod","installations","setupApi","INTERNAL","registerComponent","Component","container","getProvider","getImmediate","registerVersion","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","isServerError","error","code","includes","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","token","requestStatus","expiresIn","responseExpiresIn","replace","creationTime","getErrorFromResponse","requestName","responseJson","errorData","label","sent","serverCode","serverMessage","serverStatus","status","getHeaders","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","append","getAuthorizationHeader","retryIfServerError","fn","result","createInstallationRequest","endpoint","responseValue","_b","authVersion","sdkVersion","registrationStatus","sleep","ms","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","self","crypto","msCrypto","getRandomValues","array","btoa","fromCharCode","substr","encode","test","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","db","tx","getKey","transaction","objectStore","put","complete","remove","update","updateFn","store","oldValue","newValue","appName","getInstallationEntry","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registeredInstallationEntry","e_1","trys","push","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","updateInstallationRequest","generateAuthTokenRequest","platformLoggerProvider","platformLogger","getGenerateAuthTokenEndpoint","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","getMissingValueError","valueName","registerInstallations","configKeys_1","configKeys_1_1","next","done","keyName","e_1_1","call","extractAppConfig","console","_getId","_getToken","deleteInstallation","toArray","arr","Array","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","p","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","nativeObject","getAll","query","count","items","iterateCursor","openDb","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb","factory"],"mappings":"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","file":"16-094b453beb1e9c4ead58.js","sourcesContent":["'use strict';\n\nrequire(\"core-js/modules/es6.array.find\");\n\nrequire(\"core-js/modules/es6.array.index-of\");\n\nrequire(\"core-js/modules/es6.object.keys\");\n\nrequire(\"core-js/modules/es6.function.name\");\n\nrequire(\"core-js/modules/es6.array.map\");\n\nrequire(\"core-js/modules/es6.number.constructor\");\n\nrequire(\"core-js/modules/web.dom.iterable\");\n\nrequire(\"core-js/modules/es6.array.iterator\");\n\nrequire(\"core-js/modules/es6.date.now\");\n\nrequire(\"core-js/modules/es6.regexp.match\");\n\nrequire(\"core-js/modules/es6.string.starts-with\");\n\nrequire(\"core-js/modules/es6.array.some\");\n\nrequire(\"core-js/modules/es6.regexp.constructor\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\nrequire(\"core-js/modules/es6.regexp.split\");\n\nrequire(\"core-js/modules/es6.object.define-property\");\n\nObject.defineProperty(exports, '__esModule', {\n  value: true\n});\n\nfunction _interopDefault(ex) {\n  return ex && typeof ex === 'object' && 'default' in ex ? ex['default'] : ex;\n}\n\nvar firebase = _interopDefault(require('@firebase/app'));\n\nrequire('@firebase/installations');\n\nvar tslib = require('tslib');\n\nvar util = require('@firebase/util');\n\nvar logger$1 = require('@firebase/logger');\n\nvar component = require('@firebase/component');\n\nvar name = \"@firebase/performance\";\nvar version = \"0.2.28\";\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar SDK_VERSION = version;\n/** The prefix for start User Timing marks used for creating Traces. */\n\nvar TRACE_START_MARK_PREFIX = 'FB-PERF-TRACE-START';\n/** The prefix for stop User Timing marks used for creating Traces. */\n\nvar TRACE_STOP_MARK_PREFIX = 'FB-PERF-TRACE-STOP';\n/** The prefix for User Timing measure used for creating Traces. */\n\nvar TRACE_MEASURE_PREFIX = 'FB-PERF-TRACE-MEASURE';\n/** The prefix for out of the box page load Trace name. */\n\nvar OOB_TRACE_PAGE_LOAD_PREFIX = '_wt_';\nvar FIRST_PAINT_COUNTER_NAME = '_fp';\nvar FIRST_CONTENTFUL_PAINT_COUNTER_NAME = '_fcp';\nvar FIRST_INPUT_DELAY_COUNTER_NAME = '_fid';\nvar CONFIG_LOCAL_STORAGE_KEY = '@firebase/performance/config';\nvar CONFIG_EXPIRY_LOCAL_STORAGE_KEY = '@firebase/performance/configexpire';\nvar SERVICE = 'performance';\nvar SERVICE_NAME = 'Performance';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"trace started\"\n/* TRACE_STARTED_BEFORE */\n] = 'Trace {$traceName} was started before.', _a[\"trace stopped\"\n/* TRACE_STOPPED_BEFORE */\n] = 'Trace {$traceName} is not running.', _a[\"no window\"\n/* NO_WINDOW */\n] = 'Window is not available.', _a[\"no app id\"\n/* NO_APP_ID */\n] = 'App id is not available.', _a[\"no project id\"\n/* NO_PROJECT_ID */\n] = 'Project id is not available.', _a[\"no api key\"\n/* NO_API_KEY */\n] = 'Api key is not available.', _a[\"invalid cc log\"\n/* INVALID_CC_LOG */\n] = 'Attempted to queue invalid cc event', _a[\"FB not default\"\n/* FB_NOT_DEFAULT */\n] = 'Performance can only start when Firebase app instance is the default one.', _a[\"RC response not ok\"\n/* RC_NOT_OK */\n] = 'RC response is not ok', _a[\"invalid attribute name\"\n/* INVALID_ATTRIBUTE_NAME */\n] = 'Attribute name {$attributeName} is invalid.', _a[\"invalid attribute value\"\n/* INVALID_ATTRIBUTE_VALUE */\n] = 'Attribute value {$attributeValue} is invalid.', _a[\"invalide custom metric name\"\n/* INVALID_CUSTOM_METRIC_NAME */\n] = 'Custom metric name {$customMetricName} is invalid', _a);\nvar ERROR_FACTORY = new util.ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar apiInstance;\nvar windowInstance;\n/**\r\n * This class holds a reference to various browser related objects injected by\r\n * set methods.\r\n */\n\nvar Api =\n/** @class */\nfunction () {\n  function Api(window) {\n    this.window = window;\n\n    if (!window) {\n      throw ERROR_FACTORY.create(\"no window\"\n      /* NO_WINDOW */\n      );\n    }\n\n    this.performance = window.performance;\n    this.PerformanceObserver = window.PerformanceObserver;\n    this.windowLocation = window.location;\n    this.navigator = window.navigator;\n    this.document = window.document;\n\n    if (this.navigator && this.navigator.cookieEnabled) {\n      // If user blocks cookies on the browser, accessing localStorage will\n      // throw an exception.\n      this.localStorage = window.localStorage;\n    }\n\n    if (window.perfMetrics && window.perfMetrics.onFirstInputDelay) {\n      this.onFirstInputDelay = window.perfMetrics.onFirstInputDelay;\n    }\n  }\n\n  Api.prototype.getUrl = function () {\n    // Do not capture the string query part of url.\n    return this.windowLocation.href.split('?')[0];\n  };\n\n  Api.prototype.mark = function (name) {\n    if (!this.performance || !this.performance.mark) {\n      return;\n    }\n\n    this.performance.mark(name);\n  };\n\n  Api.prototype.measure = function (measureName, mark1, mark2) {\n    if (!this.performance || !this.performance.measure) {\n      return;\n    }\n\n    this.performance.measure(measureName, mark1, mark2);\n  };\n\n  Api.prototype.getEntriesByType = function (type) {\n    if (!this.performance || !this.performance.getEntriesByType) {\n      return [];\n    }\n\n    return this.performance.getEntriesByType(type);\n  };\n\n  Api.prototype.getEntriesByName = function (name) {\n    if (!this.performance || !this.performance.getEntriesByName) {\n      return [];\n    }\n\n    return this.performance.getEntriesByName(name);\n  };\n\n  Api.prototype.getTimeOrigin = function () {\n    // Polyfill the time origin with performance.timing.navigationStart.\n    return this.performance && (this.performance.timeOrigin || this.performance.timing.navigationStart);\n  };\n\n  Api.prototype.requiredApisAvailable = function () {\n    if (fetch && Promise && this.navigator && this.navigator.cookieEnabled) {\n      return true;\n    }\n\n    return false;\n  };\n\n  Api.prototype.setupObserver = function (entryType, callback) {\n    if (!this.PerformanceObserver) {\n      return;\n    }\n\n    var observer = new this.PerformanceObserver(function (list) {\n      for (var _i = 0, _a = list.getEntries(); _i < _a.length; _i++) {\n        var entry = _a[_i]; // `entry` is a PerformanceEntry instance.\n\n        callback(entry);\n      }\n    }); // Start observing the entry types you care about.\n\n    observer.observe({\n      entryTypes: [entryType]\n    });\n  };\n\n  Api.getInstance = function () {\n    if (apiInstance === undefined) {\n      apiInstance = new Api(windowInstance);\n    }\n\n    return apiInstance;\n  };\n\n  return Api;\n}();\n\nfunction setupApi(window) {\n  windowInstance = window;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar settingsServiceInstance;\n\nvar SettingsService =\n/** @class */\nfunction () {\n  function SettingsService() {\n    // The variable which controls logging of automatic traces and HTTP/S network monitoring.\n    this.instrumentationEnabled = true; // The variable which controls logging of custom traces.\n\n    this.dataCollectionEnabled = true; // Configuration flags set through remote config.\n\n    this.loggingEnabled = false; // Sampling rate between 0 and 1.\n\n    this.tracesSamplingRate = 1;\n    this.networkRequestsSamplingRate = 1; // Address of logging service.\n\n    this.logEndPointUrl = 'https://firebaselogging.googleapis.com/v0cc/log?format=json_proto';\n    this.logSource = 462; // Flags which control per session logging of traces and network requests.\n\n    this.logTraceAfterSampling = false;\n    this.logNetworkAfterSampling = false; // TTL of config retrieved from remote config in hours.\n\n    this.configTimeToLive = 12;\n  }\n\n  SettingsService.prototype.getAppId = function () {\n    var appId = this.firebaseAppInstance && this.firebaseAppInstance.options && this.firebaseAppInstance.options.appId;\n\n    if (!appId) {\n      throw ERROR_FACTORY.create(\"no app id\"\n      /* NO_APP_ID */\n      );\n    }\n\n    return appId;\n  };\n\n  SettingsService.prototype.getProjectId = function () {\n    var projectId = this.firebaseAppInstance && this.firebaseAppInstance.options && this.firebaseAppInstance.options.projectId;\n\n    if (!projectId) {\n      throw ERROR_FACTORY.create(\"no project id\"\n      /* NO_PROJECT_ID */\n      );\n    }\n\n    return projectId;\n  };\n\n  SettingsService.prototype.getApiKey = function () {\n    var apiKey = this.firebaseAppInstance && this.firebaseAppInstance.options && this.firebaseAppInstance.options.apiKey;\n\n    if (!apiKey) {\n      throw ERROR_FACTORY.create(\"no api key\"\n      /* NO_API_KEY */\n      );\n    }\n\n    return apiKey;\n  };\n\n  SettingsService.getInstance = function () {\n    if (settingsServiceInstance === undefined) {\n      settingsServiceInstance = new SettingsService();\n    }\n\n    return settingsServiceInstance;\n  };\n\n  return SettingsService;\n}();\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar iid;\n\nfunction getIidPromise() {\n  var iidPromise = SettingsService.getInstance().installationsService.getId(); // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n  iidPromise.then(function (iidVal) {\n    iid = iidVal;\n  });\n  return iidPromise;\n} // This method should be used after the iid is retrieved by getIidPromise method.\n\n\nfunction getIid() {\n  return iid;\n}\n\nfunction getAuthTokenPromise() {\n  var authTokenPromise = SettingsService.getInstance().installationsService.getToken(); // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n  authTokenPromise.then(function (authTokenVal) {});\n  return authTokenPromise;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VisibilityState;\n\n(function (VisibilityState) {\n  VisibilityState[VisibilityState[\"UNKNOWN\"] = 0] = \"UNKNOWN\";\n  VisibilityState[VisibilityState[\"VISIBLE\"] = 1] = \"VISIBLE\";\n  VisibilityState[VisibilityState[\"HIDDEN\"] = 2] = \"HIDDEN\";\n})(VisibilityState || (VisibilityState = {}));\n\nvar RESERVED_ATTRIBUTE_PREFIXES = ['firebase_', 'google_', 'ga_'];\nvar ATTRIBUTE_FORMAT_REGEX = new RegExp('^[a-zA-Z]\\\\w*$');\nvar MAX_ATTRIBUTE_NAME_LENGTH = 40;\nvar MAX_ATTRIBUTE_VALUE_LENGTH = 100;\n\nfunction getServiceWorkerStatus() {\n  var navigator = Api.getInstance().navigator;\n\n  if ('serviceWorker' in navigator) {\n    if (navigator.serviceWorker.controller) {\n      return 2\n      /* CONTROLLED */\n      ;\n    } else {\n        return 3\n        /* UNCONTROLLED */\n        ;\n      }\n  } else {\n      return 1\n      /* UNSUPPORTED */\n      ;\n    }\n}\n\nfunction getVisibilityState() {\n  var document = Api.getInstance().document;\n  var visibilityState = document.visibilityState;\n\n  switch (visibilityState) {\n    case 'visible':\n      return VisibilityState.VISIBLE;\n\n    case 'hidden':\n      return VisibilityState.HIDDEN;\n\n    default:\n      return VisibilityState.UNKNOWN;\n  }\n}\n\nfunction getEffectiveConnectionType() {\n  var navigator = Api.getInstance().navigator;\n  var navigatorConnection = navigator.connection;\n  var effectiveType = navigatorConnection && navigatorConnection.effectiveType;\n\n  switch (effectiveType) {\n    case 'slow-2g':\n      return 1\n      /* CONNECTION_SLOW_2G */\n      ;\n\n    case '2g':\n      return 2\n      /* CONNECTION_2G */\n      ;\n\n    case '3g':\n      return 3\n      /* CONNECTION_3G */\n      ;\n\n    case '4g':\n      return 4\n      /* CONNECTION_4G */\n      ;\n\n    default:\n      return 0\n      /* UNKNOWN */\n      ;\n  }\n}\n\nfunction isValidCustomAttributeName(name) {\n  if (name.length === 0 || name.length > MAX_ATTRIBUTE_NAME_LENGTH) {\n    return false;\n  }\n\n  var matchesReservedPrefix = RESERVED_ATTRIBUTE_PREFIXES.some(function (prefix) {\n    return name.startsWith(prefix);\n  });\n  return !matchesReservedPrefix && !!name.match(ATTRIBUTE_FORMAT_REGEX);\n}\n\nfunction isValidCustomAttributeValue(value) {\n  return value.length !== 0 && value.length <= MAX_ATTRIBUTE_VALUE_LENGTH;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar consoleLogger = new logger$1.Logger(SERVICE_NAME);\nconsoleLogger.logLevel = logger$1.LogLevel.INFO;\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar REMOTE_CONFIG_SDK_VERSION = '0.0.1'; // These values will be used if the remote config object is successfully\n// retrieved, but the template does not have these fields.\n\nvar SECONDARY_CONFIGS = {\n  loggingEnabled: true\n};\nvar FIS_AUTH_PREFIX = 'FIREBASE_INSTALLATIONS_AUTH';\n\nfunction getConfig(iid) {\n  var config = getStoredConfig();\n\n  if (config) {\n    processConfig(config);\n    return Promise.resolve();\n  }\n\n  return getRemoteConfig(iid).then(function (config) {\n    return processConfig(config);\n  }).then(function (config) {\n    return storeConfig(config);\n  },\n  /** Do nothing for error, use defaults set in settings service. */\n  function () {});\n}\n\nfunction getStoredConfig() {\n  var localStorage = Api.getInstance().localStorage;\n\n  if (!localStorage) {\n    return;\n  }\n\n  var expiryString = localStorage.getItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY);\n\n  if (!expiryString || !configValid(expiryString)) {\n    return;\n  }\n\n  var configStringified = localStorage.getItem(CONFIG_LOCAL_STORAGE_KEY);\n\n  if (!configStringified) {\n    return;\n  }\n\n  try {\n    var configResponse = JSON.parse(configStringified);\n    return configResponse;\n  } catch (_a) {\n    return;\n  }\n}\n\nfunction storeConfig(config) {\n  var localStorage = Api.getInstance().localStorage;\n\n  if (!config || !localStorage) {\n    return;\n  }\n\n  localStorage.setItem(CONFIG_LOCAL_STORAGE_KEY, JSON.stringify(config));\n  localStorage.setItem(CONFIG_EXPIRY_LOCAL_STORAGE_KEY, String(Date.now() + SettingsService.getInstance().configTimeToLive * 60 * 60 * 1000));\n}\n\nvar COULD_NOT_GET_CONFIG_MSG = 'Could not fetch config, will use default configs';\n\nfunction getRemoteConfig(iid) {\n  // Perf needs auth token only to retrieve remote config.\n  return getAuthTokenPromise().then(function (authToken) {\n    var projectId = SettingsService.getInstance().getProjectId();\n    var configEndPoint = \"https://firebaseremoteconfig.googleapis.com/v1/projects/\" + projectId + \"/namespaces/fireperf:fetch?key=\" + SettingsService.getInstance().getApiKey();\n    var request = new Request(configEndPoint, {\n      method: 'POST',\n      headers: {\n        Authorization: FIS_AUTH_PREFIX + \" \" + authToken\n      },\n\n      /* eslint-disable camelcase */\n      body: JSON.stringify({\n        app_instance_id: iid,\n        app_instance_id_token: authToken,\n        app_id: SettingsService.getInstance().getAppId(),\n        app_version: SDK_VERSION,\n        sdk_version: REMOTE_CONFIG_SDK_VERSION\n      })\n      /* eslint-enable camelcase */\n\n    });\n    return fetch(request).then(function (response) {\n      if (response.ok) {\n        return response.json();\n      } // In case response is not ok. This will be caught by catch.\n\n\n      throw ERROR_FACTORY.create(\"RC response not ok\"\n      /* RC_NOT_OK */\n      );\n    });\n  })[\"catch\"](function () {\n    consoleLogger.info(COULD_NOT_GET_CONFIG_MSG);\n    return undefined;\n  });\n}\n/**\r\n * Processes config coming either from calling RC or from local storage.\r\n * This method only runs if call is successful or config in storage\r\n * is valie.\r\n */\n\n\nfunction processConfig(config) {\n  if (!config) {\n    return config;\n  }\n\n  var settingsServiceInstance = SettingsService.getInstance();\n  var entries = config.entries || {};\n\n  if (entries.fpr_enabled !== undefined) {\n    // TODO: Change the assignment of loggingEnabled once the received type is\n    // known.\n    settingsServiceInstance.loggingEnabled = String(entries.fpr_enabled) === 'true';\n  } else {\n    // Config retrieved successfully, but there is no fpr_enabled in template.\n    // Use secondary configs value.\n    settingsServiceInstance.loggingEnabled = SECONDARY_CONFIGS.loggingEnabled;\n  }\n\n  if (entries.fpr_log_source) {\n    settingsServiceInstance.logSource = Number(entries.fpr_log_source);\n  }\n\n  if (entries.fpr_log_endpoint_url) {\n    settingsServiceInstance.logEndPointUrl = entries.fpr_log_endpoint_url;\n  }\n\n  if (entries.fpr_vc_network_request_sampling_rate !== undefined) {\n    settingsServiceInstance.networkRequestsSamplingRate = Number(entries.fpr_vc_network_request_sampling_rate);\n  }\n\n  if (entries.fpr_vc_trace_sampling_rate !== undefined) {\n    settingsServiceInstance.tracesSamplingRate = Number(entries.fpr_vc_trace_sampling_rate);\n  } // Set the per session trace and network logging flags.\n\n\n  settingsServiceInstance.logTraceAfterSampling = shouldLogAfterSampling(settingsServiceInstance.tracesSamplingRate);\n  settingsServiceInstance.logNetworkAfterSampling = shouldLogAfterSampling(settingsServiceInstance.networkRequestsSamplingRate);\n  return config;\n}\n\nfunction configValid(expiry) {\n  return Number(expiry) > Date.now();\n}\n\nfunction shouldLogAfterSampling(samplingRate) {\n  return Math.random() <= samplingRate;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar initializationStatus = 1\n/* notInitialized */\n;\nvar initializationPromise;\n\nfunction getInitializationPromise() {\n  initializationStatus = 2\n  /* initializationPending */\n  ;\n  initializationPromise = initializationPromise || initializePerf();\n  return initializationPromise;\n}\n\nfunction isPerfInitialized() {\n  return initializationStatus === 3\n  /* initialized */\n  ;\n}\n\nfunction initializePerf() {\n  return getDocumentReadyComplete().then(function () {\n    return getIidPromise();\n  }).then(function (iid) {\n    return getConfig(iid);\n  }).then(function () {\n    return changeInitializationStatus();\n  }, function () {\n    return changeInitializationStatus();\n  });\n}\n/**\r\n * Returns a promise which resolves whenever the document readystate is complete or\r\n * immediately if it is called after page load complete.\r\n */\n\n\nfunction getDocumentReadyComplete() {\n  var document = Api.getInstance().document;\n  return new Promise(function (resolve) {\n    if (document && document.readyState !== 'complete') {\n      var handler_1 = function handler_1() {\n        if (document.readyState === 'complete') {\n          document.removeEventListener('readystatechange', handler_1);\n          resolve();\n        }\n      };\n\n      document.addEventListener('readystatechange', handler_1);\n    } else {\n      resolve();\n    }\n  });\n}\n\nfunction changeInitializationStatus() {\n  initializationStatus = 3\n  /* initialized */\n  ;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DEFAULT_SEND_INTERVAL_MS = 10 * 1000;\nvar INITIAL_SEND_TIME_DELAY_MS = 5.5 * 1000; // If end point does not work, the call will be tried for these many times.\n\nvar DEFAULT_REMAINING_TRIES = 3;\nvar remainingTries = DEFAULT_REMAINING_TRIES;\n/* eslint-enable camelcase */\n\nvar queue = [];\n\nfunction processQueue(timeOffset) {\n  setTimeout(function () {\n    // If there is no remainingTries left, stop retrying.\n    if (remainingTries === 0) {\n      return;\n    } // If there are no events to process, wait for DEFAULT_SEND_INTERVAL_MS and try again.\n\n\n    if (!queue.length) {\n      return processQueue(DEFAULT_SEND_INTERVAL_MS);\n    } // Capture a snapshot of the queue and empty the \"official queue\".\n\n\n    var staged = tslib.__spreadArrays(queue);\n\n    queue = [];\n    /* eslint-disable camelcase */\n    // We will pass the JSON serialized event to the backend.\n\n    var log_event = staged.map(function (evt) {\n      return {\n        source_extension_json: evt.message,\n        event_time_ms: String(evt.eventTime)\n      };\n    });\n    var data = {\n      request_time_ms: String(Date.now()),\n      client_info: {\n        client_type: 1,\n        js_client_info: {}\n      },\n      log_source: SettingsService.getInstance().logSource,\n      log_event: log_event\n    };\n    /* eslint-enable camelcase */\n\n    fetch(SettingsService.getInstance().logEndPointUrl, {\n      method: 'POST',\n      body: JSON.stringify(data)\n    }).then(function (res) {\n      if (!res.ok) {\n        consoleLogger.info('Call to Firebase backend failed.');\n      }\n\n      return res.json();\n    }).then(function (res) {\n      var wait = Number(res.next_request_wait_millis); // Find the next call wait time from the response.\n\n      var requestOffset = isNaN(wait) ? DEFAULT_SEND_INTERVAL_MS : Math.max(DEFAULT_SEND_INTERVAL_MS, wait);\n      remainingTries = DEFAULT_REMAINING_TRIES; // Schedule the next process.\n\n      processQueue(requestOffset);\n    })[\"catch\"](function () {\n      /**\r\n       * If the request fails for some reason, add the events that were attempted\r\n       * back to the primary queue to retry later.\r\n       */\n      queue = tslib.__spreadArrays(staged, queue);\n      remainingTries--;\n      consoleLogger.info(\"Tries left: \" + remainingTries + \".\");\n      processQueue(DEFAULT_SEND_INTERVAL_MS);\n    });\n  }, timeOffset);\n}\n\nprocessQueue(INITIAL_SEND_TIME_DELAY_MS);\n\nfunction addToQueue(evt) {\n  if (!evt.eventTime || !evt.message) {\n    throw ERROR_FACTORY.create(\"invalid cc log\"\n    /* INVALID_CC_LOG */\n    );\n  } // Add the new event to the queue.\n\n\n  queue = tslib.__spreadArrays(queue, [evt]);\n}\n/** Log handler for cc service to send the performance logs to the server. */\n\n\nfunction ccHandler( // eslint-disable-next-line @typescript-eslint/no-explicit-any\nserializer) {\n  // The underscores for loggerInstance and level parameters are added to avoid the\n  // noUnusedParameters related error.\n  return function (_loggerInstance, _level) {\n    var args = [];\n\n    for (var _i = 2; _i < arguments.length; _i++) {\n      args[_i - 2] = arguments[_i];\n    }\n\n    var message = serializer.apply(void 0, args);\n    addToQueue({\n      message: message,\n      eventTime: Date.now()\n    });\n  };\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/* eslint-enble camelcase */\n\n\nvar logger; // This method is not called before initialization.\n\nfunction getLogger() {\n  if (logger) {\n    return logger;\n  }\n\n  var ccLogger = ccHandler(serializer);\n  logger = new logger$1.Logger('@firebase/performance/cc');\n  logger.logHandler = ccLogger;\n  return logger;\n}\n\nfunction logTrace(trace) {\n  var settingsService = SettingsService.getInstance(); // Do not log if trace is auto generated and instrumentation is disabled.\n\n  if (!settingsService.instrumentationEnabled && trace.isAuto) {\n    return;\n  } // Do not log if trace is custom and data collection is disabled.\n\n\n  if (!settingsService.dataCollectionEnabled && !trace.isAuto) {\n    return;\n  } // Do not log if required apis are not available.\n\n\n  if (!Api.getInstance().requiredApisAvailable()) {\n    return;\n  } // Only log the page load auto traces if page is visible.\n\n\n  if (trace.isAuto && getVisibilityState() !== VisibilityState.VISIBLE) {\n    return;\n  }\n\n  if (!settingsService.loggingEnabled || !settingsService.logTraceAfterSampling) {\n    return;\n  }\n\n  if (isPerfInitialized()) {\n    sendTraceLog(trace);\n  } else {\n    // Custom traces can be used before the initialization but logging\n    // should wait until after.\n    getInitializationPromise().then(function () {\n      return sendTraceLog(trace);\n    }, function () {\n      return sendTraceLog(trace);\n    });\n  }\n}\n\nfunction sendTraceLog(trace) {\n  if (getIid()) {\n    setTimeout(function () {\n      return getLogger().log(trace, 1\n      /* Trace */\n      );\n    }, 0);\n  }\n}\n\nfunction logNetworkRequest(networkRequest) {\n  var settingsService = SettingsService.getInstance(); // Do not log network requests if instrumentation is disabled.\n\n  if (!settingsService.instrumentationEnabled) {\n    return;\n  } // Do not log the js sdk's call to cc service to avoid unnecessary cycle.\n\n\n  if (networkRequest.url === settingsService.logEndPointUrl.split('?')[0]) {\n    return;\n  }\n\n  if (!settingsService.loggingEnabled || !settingsService.logNetworkAfterSampling) {\n    return;\n  }\n\n  setTimeout(function () {\n    return getLogger().log(networkRequest, 0\n    /* NetworkRequest */\n    );\n  }, 0);\n}\n\nfunction serializer(resource, resourceType) {\n  if (resourceType === 0\n  /* NetworkRequest */\n  ) {\n      return serializeNetworkRequest(resource);\n    }\n\n  return serializeTrace(resource);\n}\n\nfunction serializeNetworkRequest(networkRequest) {\n  var networkRequestMetric = {\n    url: networkRequest.url,\n    http_method: networkRequest.httpMethod || 0,\n    http_response_code: 200,\n    response_payload_bytes: networkRequest.responsePayloadBytes,\n    client_start_time_us: networkRequest.startTimeUs,\n    time_to_response_initiated_us: networkRequest.timeToResponseInitiatedUs,\n    time_to_response_completed_us: networkRequest.timeToResponseCompletedUs\n  };\n  var perfMetric = {\n    application_info: getApplicationInfo(),\n    network_request_metric: networkRequestMetric\n  };\n  return JSON.stringify(perfMetric);\n}\n\nfunction serializeTrace(trace) {\n  var traceMetric = {\n    name: trace.name,\n    is_auto: trace.isAuto,\n    client_start_time_us: trace.startTimeUs,\n    duration_us: trace.durationUs\n  };\n\n  if (Object.keys(trace.counters).length !== 0) {\n    traceMetric.counters = convertToKeyValueArray(trace.counters);\n  }\n\n  var customAttributes = trace.getAttributes();\n\n  if (Object.keys(customAttributes).length !== 0) {\n    traceMetric.custom_attributes = convertToKeyValueArray(customAttributes);\n  }\n\n  var perfMetric = {\n    application_info: getApplicationInfo(),\n    trace_metric: traceMetric\n  };\n  return JSON.stringify(perfMetric);\n}\n\nfunction getApplicationInfo() {\n  return {\n    google_app_id: SettingsService.getInstance().getAppId(),\n    app_instance_id: getIid(),\n    web_app_info: {\n      sdk_version: SDK_VERSION,\n      page_url: Api.getInstance().getUrl(),\n      service_worker_status: getServiceWorkerStatus(),\n      visibility_state: getVisibilityState(),\n      effective_connection_type: getEffectiveConnectionType()\n    },\n    application_process_state: 0\n  };\n}\n\nfunction convertToKeyValueArray(obj) {\n  var keys = Object.keys(obj);\n  return keys.map(function (key) {\n    return {\n      key: key,\n      value: obj[key]\n    };\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar MAX_METRIC_NAME_LENGTH = 100;\nvar RESERVED_AUTO_PREFIX = '_';\nvar oobMetrics = [FIRST_PAINT_COUNTER_NAME, FIRST_CONTENTFUL_PAINT_COUNTER_NAME, FIRST_INPUT_DELAY_COUNTER_NAME];\n/**\r\n * Returns true if the metric is custom and does not start with reserved prefix, or if\r\n * the metric is one of out of the box page load trace metrics.\r\n */\n\nfunction isValidMetricName(name, traceName) {\n  if (name.length === 0 || name.length > MAX_METRIC_NAME_LENGTH) {\n    return false;\n  }\n\n  return traceName && traceName.startsWith(OOB_TRACE_PAGE_LOAD_PREFIX) && oobMetrics.indexOf(name) > -1 || !name.startsWith(RESERVED_AUTO_PREFIX);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar Trace =\n/** @class */\nfunction () {\n  /**\r\n   * @param name The name of the trace.\r\n   * @param isAuto If the trace is auto-instrumented.\r\n   * @param traceMeasureName The name of the measure marker in user timing specification. This field\r\n   * is only set when the trace is built for logging when the user directly uses the user timing\r\n   * api (performance.mark and performance.measure).\r\n   */\n  function Trace(name, isAuto, traceMeasureName) {\n    if (isAuto === void 0) {\n      isAuto = false;\n    }\n\n    this.name = name;\n    this.isAuto = isAuto;\n    this.state = 1\n    /* UNINITIALIZED */\n    ;\n    this.customAttributes = {};\n    this.counters = {};\n    this.api = Api.getInstance();\n    this.randomId = Math.floor(Math.random() * 1000000);\n\n    if (!this.isAuto) {\n      this.traceStartMark = TRACE_START_MARK_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\n      this.traceStopMark = TRACE_STOP_MARK_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\n      this.traceMeasure = traceMeasureName || TRACE_MEASURE_PREFIX + \"-\" + this.randomId + \"-\" + this.name;\n\n      if (traceMeasureName) {\n        // For the case of direct user timing traces, no start stop will happen. The measure object\n        // is already available.\n        this.calculateTraceMetrics();\n      }\n    }\n  }\n  /**\r\n   * Starts a trace. The measurement of the duration starts at this point.\r\n   */\n\n\n  Trace.prototype.start = function () {\n    if (this.state !== 1\n    /* UNINITIALIZED */\n    ) {\n        throw ERROR_FACTORY.create(\"trace started\"\n        /* TRACE_STARTED_BEFORE */\n        , {\n          traceName: this.name\n        });\n      }\n\n    this.api.mark(this.traceStartMark);\n    this.state = 2\n    /* RUNNING */\n    ;\n  };\n  /**\r\n   * Stops the trace. The measurement of the duration of the trace stops at this point and trace\r\n   * is logged.\r\n   */\n\n\n  Trace.prototype.stop = function () {\n    if (this.state !== 2\n    /* RUNNING */\n    ) {\n        throw ERROR_FACTORY.create(\"trace stopped\"\n        /* TRACE_STOPPED_BEFORE */\n        , {\n          traceName: this.name\n        });\n      }\n\n    this.state = 3\n    /* TERMINATED */\n    ;\n    this.api.mark(this.traceStopMark);\n    this.api.measure(this.traceMeasure, this.traceStartMark, this.traceStopMark);\n    this.calculateTraceMetrics();\n    logTrace(this);\n  };\n  /**\r\n   * Records a trace with predetermined values. If this method is used a trace is created and logged\r\n   * directly. No need to use start and stop methods.\r\n   * @param startTime Trace start time since epoch in millisec\r\n   * @param duration The duraction of the trace in millisec\r\n   * @param options An object which can optionally hold maps of custom metrics and custom attributes\r\n   */\n\n\n  Trace.prototype.record = function (startTime, duration, options) {\n    this.durationUs = Math.floor(duration * 1000);\n    this.startTimeUs = Math.floor(startTime * 1000);\n\n    if (options && options.attributes) {\n      this.customAttributes = tslib.__assign({}, options.attributes);\n    }\n\n    if (options && options.metrics) {\n      for (var _i = 0, _a = Object.keys(options.metrics); _i < _a.length; _i++) {\n        var metric = _a[_i];\n\n        if (!isNaN(Number(options.metrics[metric]))) {\n          this.counters[metric] = Number(Math.floor(options.metrics[metric]));\n        }\n      }\n    }\n\n    logTrace(this);\n  };\n  /**\r\n   * Increments a custom metric by a certain number or 1 if number not specified. Will create a new\r\n   * custom metric if one with the given name does not exist.\r\n   * @param counter Name of the custom metric\r\n   * @param num Increment by value\r\n   */\n\n\n  Trace.prototype.incrementMetric = function (counter, num) {\n    if (num === void 0) {\n      num = 1;\n    }\n\n    if (this.counters[counter] === undefined) {\n      this.putMetric(counter, 0);\n    }\n\n    this.counters[counter] += num;\n  };\n  /**\r\n   * Sets a custom metric to a specified value. Will create a new custom metric if one with the\r\n   * given name does not exist.\r\n   * @param counter Name of the custom metric\r\n   * @param num Set custom metric to this value\r\n   */\n\n\n  Trace.prototype.putMetric = function (counter, num) {\n    if (isValidMetricName(counter, this.name)) {\n      this.counters[counter] = num;\n    } else {\n      throw ERROR_FACTORY.create(\"invalide custom metric name\"\n      /* INVALID_CUSTOM_METRIC_NAME */\n      , {\n        customMetricName: counter\n      });\n    }\n  };\n  /**\r\n   * Returns the value of the custom metric by that name. If a custom metric with that name does\r\n   * not exist will return zero.\r\n   * @param counter\r\n   */\n\n\n  Trace.prototype.getMetric = function (counter) {\n    return this.counters[counter] || 0;\n  };\n  /**\r\n   * Sets a custom attribute of a trace to a certain value.\r\n   * @param attr\r\n   * @param value\r\n   */\n\n\n  Trace.prototype.putAttribute = function (attr, value) {\n    var isValidName = isValidCustomAttributeName(attr);\n    var isValidValue = isValidCustomAttributeValue(value);\n\n    if (isValidName && isValidValue) {\n      this.customAttributes[attr] = value;\n      return;\n    } // Throw appropriate error when the attribute name or value is invalid.\n\n\n    if (!isValidName) {\n      throw ERROR_FACTORY.create(\"invalid attribute name\"\n      /* INVALID_ATTRIBUTE_NAME */\n      , {\n        attributeName: attr\n      });\n    }\n\n    if (!isValidValue) {\n      throw ERROR_FACTORY.create(\"invalid attribute value\"\n      /* INVALID_ATTRIBUTE_VALUE */\n      , {\n        attributeValue: value\n      });\n    }\n  };\n  /**\r\n   * Retrieves the value a custom attribute of a trace is set to.\r\n   * @param attr\r\n   */\n\n\n  Trace.prototype.getAttribute = function (attr) {\n    return this.customAttributes[attr];\n  };\n\n  Trace.prototype.removeAttribute = function (attr) {\n    if (this.customAttributes[attr] === undefined) {\n      return;\n    }\n\n    delete this.customAttributes[attr];\n  };\n\n  Trace.prototype.getAttributes = function () {\n    return tslib.__assign({}, this.customAttributes);\n  };\n\n  Trace.prototype.setStartTime = function (startTime) {\n    this.startTimeUs = startTime;\n  };\n\n  Trace.prototype.setDuration = function (duration) {\n    this.durationUs = duration;\n  };\n  /**\r\n   * Calculates and assigns the duration and start time of the trace using the measure performance\r\n   * entry.\r\n   */\n\n\n  Trace.prototype.calculateTraceMetrics = function () {\n    var perfMeasureEntries = this.api.getEntriesByName(this.traceMeasure);\n    var perfMeasureEntry = perfMeasureEntries && perfMeasureEntries[0];\n\n    if (perfMeasureEntry) {\n      this.durationUs = Math.floor(perfMeasureEntry.duration * 1000);\n      this.startTimeUs = Math.floor((perfMeasureEntry.startTime + this.api.getTimeOrigin()) * 1000);\n    }\n  };\n  /**\r\n   * @param navigationTimings A single element array which contains the navigationTIming object of\r\n   * the page load\r\n   * @param paintTimings A array which contains paintTiming object of the page load\r\n   * @param firstInputDelay First input delay in millisec\r\n   */\n\n\n  Trace.createOobTrace = function (navigationTimings, paintTimings, firstInputDelay) {\n    var route = Api.getInstance().getUrl();\n\n    if (!route) {\n      return;\n    }\n\n    var trace = new Trace(OOB_TRACE_PAGE_LOAD_PREFIX + route, true);\n    var timeOriginUs = Math.floor(Api.getInstance().getTimeOrigin() * 1000);\n    trace.setStartTime(timeOriginUs); // navigationTimings includes only one element.\n\n    if (navigationTimings && navigationTimings[0]) {\n      trace.setDuration(Math.floor(navigationTimings[0].duration * 1000));\n      trace.putMetric('domInteractive', Math.floor(navigationTimings[0].domInteractive * 1000));\n      trace.putMetric('domContentLoadedEventEnd', Math.floor(navigationTimings[0].domContentLoadedEventEnd * 1000));\n      trace.putMetric('loadEventEnd', Math.floor(navigationTimings[0].loadEventEnd * 1000));\n    }\n\n    var FIRST_PAINT = 'first-paint';\n    var FIRST_CONTENTFUL_PAINT = 'first-contentful-paint';\n\n    if (paintTimings) {\n      var firstPaint = paintTimings.find(function (paintObject) {\n        return paintObject.name === FIRST_PAINT;\n      });\n\n      if (firstPaint && firstPaint.startTime) {\n        trace.putMetric(FIRST_PAINT_COUNTER_NAME, Math.floor(firstPaint.startTime * 1000));\n      }\n\n      var firstContentfulPaint = paintTimings.find(function (paintObject) {\n        return paintObject.name === FIRST_CONTENTFUL_PAINT;\n      });\n\n      if (firstContentfulPaint && firstContentfulPaint.startTime) {\n        trace.putMetric(FIRST_CONTENTFUL_PAINT_COUNTER_NAME, Math.floor(firstContentfulPaint.startTime * 1000));\n      }\n\n      if (firstInputDelay) {\n        trace.putMetric(FIRST_INPUT_DELAY_COUNTER_NAME, Math.floor(firstInputDelay * 1000));\n      }\n    }\n\n    logTrace(trace);\n  };\n\n  Trace.createUserTimingTrace = function (measureName) {\n    var trace = new Trace(measureName, false, measureName);\n    logTrace(trace);\n  };\n\n  return Trace;\n}();\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createNetworkRequestEntry(entry) {\n  var performanceEntry = entry;\n\n  if (!performanceEntry || performanceEntry.responseStart === undefined) {\n    return;\n  }\n\n  var timeOrigin = Api.getInstance().getTimeOrigin();\n  var startTimeUs = Math.floor((performanceEntry.startTime + timeOrigin) * 1000);\n  var timeToResponseInitiatedUs = performanceEntry.responseStart ? Math.floor((performanceEntry.responseStart - performanceEntry.startTime) * 1000) : undefined;\n  var timeToResponseCompletedUs = Math.floor((performanceEntry.responseEnd - performanceEntry.startTime) * 1000); // Remove the query params from logged network request url.\n\n  var url = performanceEntry.name && performanceEntry.name.split('?')[0];\n  var networkRequest = {\n    url: url,\n    responsePayloadBytes: performanceEntry.transferSize,\n    startTimeUs: startTimeUs,\n    timeToResponseInitiatedUs: timeToResponseInitiatedUs,\n    timeToResponseCompletedUs: timeToResponseCompletedUs\n  };\n  logNetworkRequest(networkRequest);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar FID_WAIT_TIME_MS = 5000;\n\nfunction setupOobResources() {\n  // Do not initialize unless iid is available.\n  if (!getIid()) {\n    return;\n  } // The load event might not have fired yet, and that means performance navigation timing\n  // object has a duration of 0. The setup should run after all current tasks in js queue.\n\n\n  setTimeout(function () {\n    return setupOobTraces();\n  }, 0);\n  setTimeout(function () {\n    return setupNetworkRequests();\n  }, 0);\n  setTimeout(function () {\n    return setupUserTimingTraces();\n  }, 0);\n}\n\nfunction setupNetworkRequests() {\n  var api = Api.getInstance();\n  var resources = api.getEntriesByType('resource');\n\n  for (var _i = 0, resources_1 = resources; _i < resources_1.length; _i++) {\n    var resource = resources_1[_i];\n    createNetworkRequestEntry(resource);\n  }\n\n  api.setupObserver('resource', createNetworkRequestEntry);\n}\n\nfunction setupOobTraces() {\n  var api = Api.getInstance();\n  var navigationTimings = api.getEntriesByType('navigation');\n  var paintTimings = api.getEntriesByType('paint'); // If First Input Desly polyfill is added to the page, report the fid value.\n  // https://github.com/GoogleChromeLabs/first-input-delay\n\n  if (api.onFirstInputDelay) {\n    // If the fid call back is not called for certain time, continue without it.\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    var timeoutId_1 = setTimeout(function () {\n      Trace.createOobTrace(navigationTimings, paintTimings);\n      timeoutId_1 = undefined;\n    }, FID_WAIT_TIME_MS);\n    api.onFirstInputDelay(function (fid) {\n      if (timeoutId_1) {\n        clearTimeout(timeoutId_1);\n        Trace.createOobTrace(navigationTimings, paintTimings, fid);\n      }\n    });\n  } else {\n    Trace.createOobTrace(navigationTimings, paintTimings);\n  }\n}\n\nfunction setupUserTimingTraces() {\n  var api = Api.getInstance(); // Run through the measure performance entries collected up to this point.\n\n  var measures = api.getEntriesByType('measure');\n\n  for (var _i = 0, measures_1 = measures; _i < measures_1.length; _i++) {\n    var measure = measures_1[_i];\n    createUserTimingTrace(measure);\n  } // Setup an observer to capture the measures from this point on.\n\n\n  api.setupObserver('measure', createUserTimingTrace);\n}\n\nfunction createUserTimingTrace(measure) {\n  var measureName = measure.name; // Do not create a trace, if the user timing marks and measures are created by the sdk itself.\n\n  if (measureName.substring(0, TRACE_MEASURE_PREFIX.length) === TRACE_MEASURE_PREFIX) {\n    return;\n  }\n\n  Trace.createUserTimingTrace(measureName);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar PerformanceController =\n/** @class */\nfunction () {\n  function PerformanceController(app) {\n    this.app = app;\n\n    if (Api.getInstance().requiredApisAvailable()) {\n      getInitializationPromise().then(setupOobResources, setupOobResources);\n    } else {\n      consoleLogger.info('Firebase Performance cannot start if browser does not support fetch and Promise or cookie is disabled.');\n    }\n  }\n\n  PerformanceController.prototype.trace = function (name) {\n    return new Trace(name);\n  };\n\n  Object.defineProperty(PerformanceController.prototype, \"instrumentationEnabled\", {\n    get: function get() {\n      return SettingsService.getInstance().instrumentationEnabled;\n    },\n    set: function set(val) {\n      SettingsService.getInstance().instrumentationEnabled = val;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PerformanceController.prototype, \"dataCollectionEnabled\", {\n    get: function get() {\n      return SettingsService.getInstance().dataCollectionEnabled;\n    },\n    set: function set(val) {\n      SettingsService.getInstance().dataCollectionEnabled = val;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return PerformanceController;\n}();\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DEFAULT_ENTRY_NAME = '[DEFAULT]';\n\nfunction registerPerformance(instance) {\n  var factoryMethod = function factoryMethod(app, installations) {\n    if (app.name !== DEFAULT_ENTRY_NAME) {\n      throw ERROR_FACTORY.create(\"FB not default\"\n      /* FB_NOT_DEFAULT */\n      );\n    }\n\n    if (typeof window === 'undefined') {\n      throw ERROR_FACTORY.create(\"no window\"\n      /* NO_WINDOW */\n      );\n    }\n\n    setupApi(window);\n    SettingsService.getInstance().firebaseAppInstance = app;\n    SettingsService.getInstance().installationsService = installations;\n    return new PerformanceController(app);\n  }; // Register performance with firebase-app.\n\n\n  instance.INTERNAL.registerComponent(new component.Component('performance', function (container) {\n    /* Dependencies */\n    // getImmediate for FirebaseApp will always succeed\n    var app = container.getProvider('app').getImmediate(); // The following call will always succeed because perf has `import '@firebase/installations'`\n\n    var installations = container.getProvider('installations').getImmediate();\n    return factoryMethod(app, installations);\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ));\n  instance.registerVersion(name, version);\n}\n\nregisterPerformance(firebase);\nexports.registerPerformance = registerPerformance;","import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __assign, __values } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar name = \"@firebase/installations\";\nvar version = \"0.3.8\";\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\"\n/* NOT_REGISTERED */\n] = 'Firebase Installation is not registered.', _a[\"installation-not-found\"\n/* INSTALLATION_NOT_FOUND */\n] = 'Firebase Installation not found.', _a[\"request-failed\"\n/* REQUEST_FAILED */\n] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\"\n/* APP_OFFLINE */\n] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\"\n/* DELETE_PENDING_REGISTRATION */\n] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\n\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\"\n  /* REQUEST_FAILED */\n  );\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\n\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2\n    /* COMPLETED */\n    ,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2\n          /*return*/\n          , ERROR_FACTORY.create(\"request-failed\"\n          /* REQUEST_FAILED */\n          , {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\n\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\n\n\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fn()];\n\n        case 1:\n          result = _a.sent();\n\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2\n            /*return*/\n            , fn()];\n          }\n\n          return [2\n          /*return*/\n          , result];\n      }\n    });\n  });\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2\n            /* COMPLETED */\n            ,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2\n          /*return*/\n          , registeredInstallationEntry];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Create Installation', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\n\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray); // Replace the first 4 random bits with the constant FID header of 0b0111.\n\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\n\n\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray); // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n\n  return b64String.substr(0, 22);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME)[\"delete\"](key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\n\n\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , store.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , store[\"delete\"](key)];\n\n        case 3:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          return [4\n          /*yield*/\n          , store.put(newValue, key)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 7:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , newValue];\n      }\n    });\n  });\n}\n\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\n\n\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3\n          /*break*/\n          , 3];\n          _a = {};\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2\n          /*return*/\n          , (_a.installationEntry = _b.sent(), _a)];\n\n        case 3:\n          return [2\n          /*return*/\n          , {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\n\n\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0\n    /* NOT_STARTED */\n\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\n\n\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0\n  /* NOT_STARTED */\n  ) {\n      if (!navigator.onLine) {\n        // Registration required but app is offline.\n        var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\"\n        /* APP_OFFLINE */\n        ));\n        return {\n          installationEntry: installationEntry,\n          registrationPromise: registrationPromiseWithError\n        };\n      } // Try registering. Change status to IN_PROGRESS.\n\n\n      var inProgressEntry = {\n        fid: installationEntry.fid,\n        registrationStatus: 1\n        /* IN_PROGRESS */\n        ,\n        registrationTime: Date.now()\n      };\n      var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n      return {\n        installationEntry: inProgressEntry,\n        registrationPromise: registrationPromise\n      };\n    } else if (installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  ) {\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: waitUntilFidRegistration(appConfig)\n      };\n    } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\n\n\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n\n          return [4\n          /*yield*/\n          , createInstallationRequest(appConfig, installationEntry)];\n\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2\n          /*return*/\n          , set(appConfig, registeredInstallationEntry)];\n\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3\n          /*break*/\n          , 4]; // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4\n          /*yield*/\n          , set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0\n            /* NOT_STARTED */\n\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          throw e_1;\n\n        case 7:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\n\n\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n\n        case 2:\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // createInstallation request still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 4:\n          entry = _b.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          if (!(entry.registrationStatus === 0\n          /* NOT_STARTED */\n          )) return [3\n            /*break*/\n            , 7];\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            return [2\n            /*return*/\n            , registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2\n            /*return*/\n            , installationEntry];\n          }\n\n        case 7:\n          return [2\n          /*return*/\n          , entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\"\n      /* INSTALLATION_NOT_FOUND */\n      );\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0\n      /* NOT_STARTED */\n\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n      platformLoggerProvider = _a.platformLoggerProvider;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2\n          /*return*/\n          , completedAuthToken];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Generate Auth Token', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\n\n\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\"\n              /* NOT_REGISTERED */\n              );\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1\n            /* IN_PROGRESS */\n            ) {\n                // There already is a token request in progress.\n                tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n                return oldEntry;\n              } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\"\n                /* APP_OFFLINE */\n                );\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , tokenPromise];\n\n        case 2:\n          _a = _b.sent();\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n\n        case 4:\n          authToken = _a;\n          return [2\n          /*return*/\n          , authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\n\n\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n\n        case 2:\n          if (!(entry.authToken.requestStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // generateAuthToken still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 4:\n          entry = _a.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          authToken = entry.authToken;\n\n          if (authToken.requestStatus === 0\n          /* NOT_STARTED */\n          ) {\n              // The request timed out or failed in a different call. Try again.\n              return [2\n              /*return*/\n              , refreshAuthToken(dependencies, forceRefresh)];\n            } else {\n            return [2\n            /*return*/\n            , authToken];\n          }\n\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\"\n      /* NOT_REGISTERED */\n      );\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0\n          /* NOT_STARTED */\n\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\n\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n\n          return [4\n          /*yield*/\n          , generateAuthTokenRequest(dependencies, installationEntry)];\n\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , authToken];\n\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3\n          /*break*/\n          , 5]; // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(dependencies.appConfig)];\n\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0\n              /* NOT_STARTED */\n\n            }\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 6:\n          _a.sent();\n\n          _a.label = 7;\n\n        case 7:\n          throw e_1;\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2\n  /* COMPLETED */\n  ;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2\n  /* COMPLETED */\n  && !isAuthTokenExpired(authToken);\n}\n\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\n\n\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1\n    /* IN_PROGRESS */\n    ,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1\n  /* IN_PROGRESS */\n  && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getId(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(dependencies.appConfig)];\n\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            registrationPromise[\"catch\"](console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies)[\"catch\"](console.error);\n          }\n\n          return [2\n          /*return*/\n          , installationEntry.fid];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , completeInstallationRegistration(dependencies.appConfig)];\n\n        case 1:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , refreshAuthToken(dependencies, forceRefresh)];\n\n        case 2:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , authToken.token];\n      }\n    });\n  });\n}\n\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3\n          /*break*/\n          , 3]; // A createInstallation request is in progress. Wait until it finishes.\n\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Delete Installation', response)];\n\n        case 2:\n          throw _a.sent();\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0\n            /* NOT_STARTED */\n            ) {\n                // Delete the unregistered entry without sending a deleteInstallation request.\n                return undefined;\n              }\n\n            return oldEntry;\n          })];\n\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3\n          /*break*/\n          , 6];\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 2]; // Can't delete while trying to register.\n\n          throw ERROR_FACTORY.create(\"delete-pending-registration\"\n          /* DELETE_PENDING_REGISTRATION */\n          );\n\n        case 2:\n          if (!(entry.registrationStatus === 2\n          /* COMPLETED */\n          )) return [3\n            /*break*/\n            , 6];\n          if (!!navigator.onLine) return [3\n          /*break*/\n          , 3];\n          throw ERROR_FACTORY.create(\"app-offline\"\n          /* APP_OFFLINE */\n          );\n\n        case 3:\n          return [4\n          /*yield*/\n          , deleteInstallationRequest(appConfig, entry)];\n\n        case 4:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1[\"return\"])) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate(); // Throws if app isn't configured properly.\n\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    return {\n      app: app,\n      getId: function getId() {\n        return _getId(dependencies);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(dependencies, forceRefresh);\n      },\n      \"delete\": function _delete() {\n        return deleteInstallation(dependencies);\n      }\n    };\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ));\n  instance.registerVersion(name, version);\n}\n\nregisterInstallations(firebase);\nexport { registerInstallations };","require(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.object.define-property\");\n\nrequire(\"core-js/modules/es6.array.for-each\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.idb = {}));\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']); // proxy 'next' methods\n\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']); // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  }); // polyfill getAll\n\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n\n          cursor[\"continue\"]();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","import '@firebase/performance';"],"sourceRoot":""}