{"version":3,"sources":["webpack:///./node_modules/core-js/modules/es6.string.repeat.js","webpack:///./node_modules/core-js/modules/es6.typed.data-view.js","webpack:///./node_modules/@firebase/messaging/dist/index.esm.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/core-js/modules/_string-repeat.js","webpack:///./node_modules/idb/build/idb.js","webpack:///./node_modules/core-js/modules/es6.string.link.js"],"names":["$export","P","repeat","G","W","F","ABV","DataView","MessageType","ERROR_MAP","errorFactory","DEFAULT_PUBLIC_VAPID_KEY","Uint8Array","ENDPOINT","isArrayBufferEqual","a","b","byteLength","viewA","viewB","i","getUint8","arrayBufferToBase64","arrayBuffer","uint8Version","btoa","String","fromCharCode","apply","toBase64","replace","SubscriptionManager","prototype","getToken","services","subscription","vapidKey","this","headers","body","subscribeOptions","responseData","err_1","message","_a","label","getHeaders","sent","getBody","method","JSON","stringify","trys","push","fetch","getEndpoint","app","json","create","errorInfo","error","token","updateToken","tokenDetails","updateOptions","err_2","fcmToken","deleteToken","unsubscribeOptions","err_3","options","projectId","installations","authToken","_b","Headers","Accept","apiKey","p256dh","getKey","auth","web","endpoint","buffer","applicationPubKey","base64ToArrayBuffer","base64String","base64","length","rawData","atob","outputArray","charCodeAt","OLD_DB_NAME","OLD_OBJECT_STORE_NAME","cleanV1","request","indexedDB","open","onerror","_event","onsuccess","db","objectStoreNames","contains","objectStore","transaction","subscriptionManager","openCursorRequest","openCursor","event","console","warn","cursor","result","value","close","deleteDatabase","handleDb","DbInterface","dbPromise","get","key","createTransaction","getIndex","index","put","closeDatabase","runRequest","mode","getDb","objectStoreName","promisify","Promise","resolve","reject","oncomplete","_this","dbName","dbVersion","onupgradeneeded","onDbUpgrade","_super","TokenDetailsModel","call","oldVersion","createObjectStore","keyPath","createIndex","unique","cursorRequest_1","newValue","createTime","Date","now","fcmPushSet","update","cursorRequest_2","getTokenDetailsFromToken","validateInputs","getTokenDetailsFromSWScope","swScope","saveTokenDetails","fcmSenderId","details","input","ArrayBuffer","VapidDetailsModel","arguments","getVapidFromSWScope","undefined","saveVapidDetails","deleteVapidDetails","BaseController","vapidDetailsModel","messagingSenderId","INTERNAL","tokenDetailsModel","permission","swReg","publicVapidKey","pushSubscription","getNotificationPermission","requestNotificationPermission","getSWRegistration_","getPublicVapidKey_","getPushSubscription","scope","manageExistingToken","getNewToken","isEndpointEqual","isAuthEqual","isP256dhEqual","isTokenStillValid","deleteTokenFromDB","updatedToken","allDetails","e_1","newToken","registration","pushManager","getSubscription","unsubscribe","e_2","swRegistration","subscribe","userVisibleOnly","applicationServerKey","requestPermission","useServiceWorker","_registration","usePublicVapidKey","_b64PublicKey","onMessage","_nextOrObserver","_error","_completed","onTokenRefresh","setBackgroundMessageHandler","_callback","all","Notification","getTokenDetailsModel","getVapidDetailsModel","getSubscriptionManager","SwController","bgMessageHandler","self","addEventListener","e","onPush","onSubChange","onNotificationClick","waitUntil","onPush_","onSubChange_","onNotificationClick_","msgPayload","notificationDetails","notificationTitle","reg","actions","maxActions","data","err","hasVisibleClients_","sendMessageToWindowClients_","getNotificationData_","title","showNotification","link","windowClient","internalMsg","notification","action","stopImmediatePropagation","fcmOptions","click_action","location","origin","getWindowClient_","clients","openWindow","ms","setTimeout","focus","createNewMsg","NOTIFICATION_CLICKED","attemptToMessageClient_","notificationInformation","callback","url","parsedURL","clientList","suitableClient","URL","href","getClientList","client","postMessage","some","visibilityState","startsWith","PUSH_MSG_RECEIVED","map","vapidKeyFromDatabase","matchAll","type","includeUncontrolled","msgType","msgData","firebaseMessagingType","firebaseMessagingData","WindowController","registrationToUse","publicVapidKeyToUse","messageObserver","tokenRefreshObserver","onMessageInternal","observer","onTokenRefreshInternal","setupSWMessageListener_","permissionResult","ServiceWorkerRegistration","publicKey","parsedKey","nextOrObserver","completed","waitForRegistrationToActivate_","serviceWorker","installing","waiting","active","state","stateChangeListener","removeEventListener","navigator","register","browserErrorMessage","then","eventType","next","messageType","Error","getEventType","analyticsProvider","logEvent","message_name","message_id","message_time","message_device_time","Math","floor","instance","namespaceExports","version","isSupported","hasOwnProperty","PushSubscription","cookieEnabled","window","registerComponent","container","firebaseServices","getProvider","getImmediate","setServiceProps","registerVersion","name","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","ERROR_DESCRIPTION_MAP","ERROR_FACTORY","isServerError","code","includes","getInstallationsEndpoint","extractAuthTokenInfoFromResponse","response","requestStatus","expiresIn","responseExpiresIn","Number","creationTime","getErrorFromResponse","requestName","responseJson","errorData","serverCode","serverMessage","serverStatus","status","getHeadersWithAuth","appConfig","refreshToken","append","getAuthorizationHeader","retryIfServerError","fn","createInstallationRequest","fid","responseValue","authVersion","appId","sdkVersion","ok","registrationStatus","sleep","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","crypto","msCrypto","getRandomValues","array","substr","encode","test","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","getDbPromise","upgradeDB","set","tx","complete","remove","updateFn","store","oldValue","appName","getInstallationEntry","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","onLine","registrationPromiseWithError","inProgressEntry","registrationTime","registeredInstallationEntry","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","entry","updateInstallationRequest","generateAuthTokenRequest","platformLoggerProvider","platformLogger","getGenerateAuthTokenEndpoint","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","getMissingValueError","valueName","registerInstallations","configKeys_1","configKeys_1_1","done","keyName","e_1_1","extractAppConfig","getId","_getId","_getToken","deleteInstallation","toInteger","defined","module","exports","count","str","res","n","Infinity","RangeError","toArray","arr","Array","slice","promisifyRequest","promisifyRequestCall","obj","args","p","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","properties","forEach","prop","Object","defineProperty","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","_index","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","nativeObject","getAll","query","items","iterateCursor","openDb","upgradeCallback","deleteDb","factory","createHTML"],"mappings":"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","file":"14-9f0287dc790fe179b956.js","sourcesContent":["var $export = require('./_export');\n\n$export($export.P, 'String', {\n  // 21.1.3.13 String.prototype.repeat(count)\n  repeat: require('./_string-repeat')\n});\n","var $export = require('./_export');\n$export($export.G + $export.W + $export.F * !require('./_typed').ABV, {\n  DataView: require('./_typed-buffer').DataView\n});\n","import \"core-js/modules/es6.array.map\";\nimport \"core-js/modules/es6.string.starts-with\";\nimport \"core-js/modules/es6.array.some\";\nimport \"core-js/modules/es6.string.link\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.string.repeat\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.typed.data-view\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { __spread, __awaiter, __generator, __extends, __assign } from 'tslib';\nimport { ErrorFactory, createSubscribe } from '@firebase/util';\nimport { Component } from '@firebase/component';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_MAP = (_a = {}, _a[\"only-available-in-window\"\n/* AVAILABLE_IN_WINDOW */\n] = 'This method is available in a Window context.', _a[\"only-available-in-sw\"\n/* AVAILABLE_IN_SW */\n] = 'This method is available in a service worker context.', _a[\"should-be-overriden\"\n/* SHOULD_BE_INHERITED */\n] = 'This method should be overriden by extended classes.', _a[\"bad-sender-id\"\n/* BAD_SENDER_ID */\n] = \"Please ensure that 'messagingSenderId' is set \" + 'correctly in the options passed into firebase.initializeApp().', _a[\"permission-default\"\n/* PERMISSION_DEFAULT */\n] = 'The required permissions were not granted and dismissed instead.', _a[\"permission-blocked\"\n/* PERMISSION_BLOCKED */\n] = 'The required permissions were not granted and blocked instead.', _a[\"unsupported-browser\"\n/* UNSUPPORTED_BROWSER */\n] = \"This browser doesn't support the API's \" + 'required to use the firebase SDK.', _a[\"notifications-blocked\"\n/* NOTIFICATIONS_BLOCKED */\n] = 'Notifications have been blocked.', _a[\"failed-serviceworker-registration\"\n/* FAILED_DEFAULT_REGISTRATION */\n] = 'We are unable to register the ' + 'default service worker. {$browserErrorMessage}', _a[\"sw-registration-expected\"\n/* SW_REGISTRATION_EXPECTED */\n] = 'A service worker registration was the expected input.', _a[\"get-subscription-failed\"\n/* GET_SUBSCRIPTION_FAILED */\n] = 'There was an error when trying to get ' + 'any existing Push Subscriptions.', _a[\"invalid-saved-token\"\n/* INVALID_SAVED_TOKEN */\n] = 'Unable to access details of the saved token.', _a[\"sw-reg-redundant\"\n/* SW_REG_REDUNDANT */\n] = 'The service worker being used for push was made redundant.', _a[\"token-subscribe-failed\"\n/* TOKEN_SUBSCRIBE_FAILED */\n] = 'A problem occured while subscribing the user to FCM: {$errorInfo}', _a[\"token-subscribe-no-token\"\n/* TOKEN_SUBSCRIBE_NO_TOKEN */\n] = 'FCM returned no token when subscribing the user to push.', _a[\"token-unsubscribe-failed\"\n/* TOKEN_UNSUBSCRIBE_FAILED */\n] = 'A problem occured while unsubscribing the ' + 'user from FCM: {$errorInfo}', _a[\"token-update-failed\"\n/* TOKEN_UPDATE_FAILED */\n] = 'A problem occured while updating the user from FCM: {$errorInfo}', _a[\"token-update-no-token\"\n/* TOKEN_UPDATE_NO_TOKEN */\n] = 'FCM returned no token when updating the user to push.', _a[\"use-sw-before-get-token\"\n/* USE_SW_BEFORE_GET_TOKEN */\n] = 'The useServiceWorker() method may only be called once and must be ' + 'called before calling getToken() to ensure your service worker is used.', _a[\"invalid-delete-token\"\n/* INVALID_DELETE_TOKEN */\n] = 'You must pass a valid token into ' + 'deleteToken(), i.e. the token from getToken().', _a[\"delete-token-not-found\"\n/* DELETE_TOKEN_NOT_FOUND */\n] = 'The deletion attempt for token could not ' + 'be performed as the token was not found.', _a[\"delete-scope-not-found\"\n/* DELETE_SCOPE_NOT_FOUND */\n] = 'The deletion attempt for service worker ' + 'scope could not be performed as the scope was not found.', _a[\"bg-handler-function-expected\"\n/* BG_HANDLER_FUNCTION_EXPECTED */\n] = 'The input to setBackgroundMessageHandler() must be a function.', _a[\"no-window-client-to-msg\"\n/* NO_WINDOW_CLIENT_TO_MSG */\n] = 'An attempt was made to message a non-existant window client.', _a[\"unable-to-resubscribe\"\n/* UNABLE_TO_RESUBSCRIBE */\n] = 'There was an error while re-subscribing ' + 'the FCM token for push messaging. Will have to resubscribe the ' + 'user on next visit. {$errorInfo}', _a[\"no-fcm-token-for-resubscribe\"\n/* NO_FCM_TOKEN_FOR_RESUBSCRIBE */\n] = 'Could not find an FCM token ' + 'and as a result, unable to resubscribe. Will have to resubscribe the ' + 'user on next visit.', _a[\"failed-to-delete-token\"\n/* FAILED_TO_DELETE_TOKEN */\n] = 'Unable to delete the currently saved token.', _a[\"no-sw-in-reg\"\n/* NO_SW_IN_REG */\n] = 'Even though the service worker registration was ' + 'successful, there was a problem accessing the service worker itself.', _a[\"bad-scope\"\n/* BAD_SCOPE */\n] = 'The service worker scope must be a string with at ' + 'least one character.', _a[\"bad-vapid-key\"\n/* BAD_VAPID_KEY */\n] = 'The public VAPID key is not a Uint8Array with 65 bytes.', _a[\"bad-subscription\"\n/* BAD_SUBSCRIPTION */\n] = 'The subscription must be a valid PushSubscription.', _a[\"bad-token\"\n/* BAD_TOKEN */\n] = 'The FCM Token used for storage / lookup was not ' + 'a valid token string.', _a[\"failed-delete-vapid-key\"\n/* FAILED_DELETE_VAPID_KEY */\n] = 'The VAPID key could not be deleted.', _a[\"invalid-public-vapid-key\"\n/* INVALID_PUBLIC_VAPID_KEY */\n] = 'The public VAPID key must be a string.', _a[\"use-public-key-before-get-token\"\n/* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */\n] = 'The usePublicVapidKey() method may only be called once and must be ' + 'called before calling getToken() to ensure your VAPID key is used.', _a[\"public-vapid-key-decryption-failed\"\n/* PUBLIC_KEY_DECRYPTION_FAILED */\n] = 'The public VAPID key did not equal 65 bytes when decrypted.', _a);\nvar errorFactory = new ErrorFactory('messaging', 'Messaging', ERROR_MAP);\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar DEFAULT_PUBLIC_VAPID_KEY = new Uint8Array([0x04, 0x33, 0x94, 0xf7, 0xdf, 0xa1, 0xeb, 0xb1, 0xdc, 0x03, 0xa2, 0x5e, 0x15, 0x71, 0xdb, 0x48, 0xd3, 0x2e, 0xed, 0xed, 0xb2, 0x34, 0xdb, 0xb7, 0x47, 0x3a, 0x0c, 0x8f, 0xc4, 0xcc, 0xe1, 0x6f, 0x3c, 0x8c, 0x84, 0xdf, 0xab, 0xb6, 0x66, 0x3e, 0xf2, 0x0c, 0xd4, 0x8b, 0xfe, 0xe3, 0xf9, 0x76, 0x2f, 0x14, 0x1c, 0x63, 0x08, 0x6a, 0x6f, 0x2d, 0xb1, 0x1a, 0x95, 0xb0, 0xce, 0x37, 0xc0, 0x9c, 0x6e]);\nvar ENDPOINT = 'https://fcmregistrations.googleapis.com/v1';\nvar FN_CAMPAIGN_ID = 'google.c.a.c_id';\nvar FN_CAMPAIGN_NAME = 'google.c.a.c_l';\nvar FN_CAMPAIGN_TIME = 'google.c.a.ts';\n/** Set to '1' if Analytics is enabled for the campaign */\n\nvar FN_CAMPAIGN_ANALYTICS_ENABLED = 'google.c.a.e';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar MessageType;\n\n(function (MessageType) {\n  MessageType[\"PUSH_MSG_RECEIVED\"] = \"push-msg-received\";\n  MessageType[\"NOTIFICATION_CLICKED\"] = \"notification-clicked\";\n})(MessageType || (MessageType = {}));\n/**\r\n * @license\r\n * Copyright 2018 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction isArrayBufferEqual(a, b) {\n  if (a == null || b == null) {\n    return false;\n  }\n\n  if (a === b) {\n    return true;\n  }\n\n  if (a.byteLength !== b.byteLength) {\n    return false;\n  }\n\n  var viewA = new DataView(a);\n  var viewB = new DataView(b);\n\n  for (var i = 0; i < a.byteLength; i++) {\n    if (viewA.getUint8(i) !== viewB.getUint8(i)) {\n      return false;\n    }\n  }\n\n  return true;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction toBase64(arrayBuffer) {\n  var uint8Version = new Uint8Array(arrayBuffer);\n  return btoa(String.fromCharCode.apply(String, __spread(uint8Version)));\n}\n\nfunction arrayBufferToBase64(arrayBuffer) {\n  var base64String = toBase64(arrayBuffer);\n  return base64String.replace(/=/g, '').replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar SubscriptionManager =\n/** @class */\nfunction () {\n  function SubscriptionManager() {}\n\n  SubscriptionManager.prototype.getToken = function (services, subscription, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, body, subscribeOptions, responseData, response, err_1, message;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(services)];\n\n          case 1:\n            headers = _a.sent();\n            body = getBody(subscription, vapidKey);\n            subscribeOptions = {\n              method: 'POST',\n              headers: headers,\n              body: JSON.stringify(body)\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(services.app), subscribeOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_1 = _a.sent();\n            throw errorFactory.create(\"token-subscribe-failed\"\n            /* TOKEN_SUBSCRIBE_FAILED */\n            , {\n              errorInfo: err_1\n            });\n\n          case 6:\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-subscribe-failed\"\n              /* TOKEN_SUBSCRIBE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            if (!responseData.token) {\n              throw errorFactory.create(\"token-subscribe-no-token\"\n              /* TOKEN_SUBSCRIBE_NO_TOKEN */\n              );\n            }\n\n            return [2\n            /*return*/\n            , responseData.token];\n        }\n      });\n    });\n  };\n  /**\r\n   * Update the underlying token details for fcmToken.\r\n   */\n\n\n  SubscriptionManager.prototype.updateToken = function (tokenDetails, services, subscription, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, body, updateOptions, responseData, response, err_2, message;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(services)];\n\n          case 1:\n            headers = _a.sent();\n            body = getBody(subscription, vapidKey);\n            updateOptions = {\n              method: 'PATCH',\n              headers: headers,\n              body: JSON.stringify(body)\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(services.app) + \"/\" + tokenDetails.fcmToken, updateOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_2 = _a.sent();\n            throw errorFactory.create(\"token-update-failed\"\n            /* TOKEN_UPDATE_FAILED */\n            , {\n              errorInfo: err_2\n            });\n\n          case 6:\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-update-failed\"\n              /* TOKEN_UPDATE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            if (!responseData.token) {\n              throw errorFactory.create(\"token-update-no-token\"\n              /* TOKEN_UPDATE_NO_TOKEN */\n              );\n            }\n\n            return [2\n            /*return*/\n            , responseData.token];\n        }\n      });\n    });\n  };\n\n  SubscriptionManager.prototype.deleteToken = function (services, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var headers, unsubscribeOptions, response, responseData, message, err_3;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getHeaders(services)];\n\n          case 1:\n            headers = _a.sent();\n            unsubscribeOptions = {\n              method: 'DELETE',\n              headers: headers\n            };\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 5,, 6]);\n\n            return [4\n            /*yield*/\n            , fetch(getEndpoint(services.app) + \"/\" + tokenDetails.fcmToken, unsubscribeOptions)];\n\n          case 3:\n            response = _a.sent();\n            return [4\n            /*yield*/\n            , response.json()];\n\n          case 4:\n            responseData = _a.sent();\n\n            if (responseData.error) {\n              message = responseData.error.message;\n              throw errorFactory.create(\"token-unsubscribe-failed\"\n              /* TOKEN_UNSUBSCRIBE_FAILED */\n              , {\n                errorInfo: message\n              });\n            }\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 5:\n            err_3 = _a.sent();\n            throw errorFactory.create(\"token-unsubscribe-failed\"\n            /* TOKEN_UNSUBSCRIBE_FAILED */\n            , {\n              errorInfo: err_3\n            });\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return SubscriptionManager;\n}();\n\nfunction getEndpoint(app) {\n  return ENDPOINT + \"/projects/\" + app.options.projectId + \"/registrations\";\n}\n\nfunction getHeaders(_a) {\n  var app = _a.app,\n      installations = _a.installations;\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , installations.getToken()];\n\n        case 1:\n          authToken = _b.sent();\n          return [2\n          /*return*/\n          , new Headers({\n            'Content-Type': 'application/json',\n            Accept: 'application/json',\n            'x-goog-api-key': app.options.apiKey,\n            'x-goog-firebase-installations-auth': \"FIS \" + authToken\n          })];\n      }\n    });\n  });\n}\n\nfunction getBody(subscription, vapidKey) {\n  var p256dh = arrayBufferToBase64(subscription.getKey('p256dh'));\n  var auth = arrayBufferToBase64(subscription.getKey('auth'));\n  var body = {\n    web: {\n      endpoint: subscription.endpoint,\n      p256dh: p256dh,\n      auth: auth\n    }\n  };\n\n  if (!isArrayBufferEqual(vapidKey.buffer, DEFAULT_PUBLIC_VAPID_KEY.buffer)) {\n    body.web.applicationPubKey = arrayBufferToBase64(vapidKey);\n  }\n\n  return body;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction base64ToArrayBuffer(base64String) {\n  var padding = '='.repeat((4 - base64String.length % 4) % 4);\n  var base64 = (base64String + padding).replace(/\\-/g, '+').replace(/_/g, '/');\n  var rawData = atob(base64);\n  var outputArray = new Uint8Array(rawData.length);\n\n  for (var i = 0; i < rawData.length; ++i) {\n    outputArray[i] = rawData.charCodeAt(i);\n  }\n\n  return outputArray;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar OLD_DB_NAME = 'undefined';\nvar OLD_OBJECT_STORE_NAME = 'fcm_token_object_Store';\n\nfunction handleDb(db, services) {\n  if (!db.objectStoreNames.contains(OLD_OBJECT_STORE_NAME)) {\n    // We found a database with the name 'undefined', but our expected object\n    // store isn't defined.\n    return;\n  }\n\n  var transaction = db.transaction(OLD_OBJECT_STORE_NAME);\n  var objectStore = transaction.objectStore(OLD_OBJECT_STORE_NAME);\n  var subscriptionManager = new SubscriptionManager();\n  var openCursorRequest = objectStore.openCursor();\n\n  openCursorRequest.onerror = function (event) {\n    // NOOP - Nothing we can do.\n    console.warn('Unable to cleanup old IDB.', event);\n  };\n\n  openCursorRequest.onsuccess = function () {\n    var cursor = openCursorRequest.result;\n\n    if (cursor) {\n      // cursor.value contains the current record being iterated through\n      // this is where you'd do something with the result\n      var tokenDetails = cursor.value; // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n      subscriptionManager.deleteToken(services, tokenDetails);\n      cursor[\"continue\"]();\n    } else {\n      db.close();\n      indexedDB.deleteDatabase(OLD_DB_NAME);\n    }\n  };\n}\n\nfunction cleanV1(services) {\n  var request = indexedDB.open(OLD_DB_NAME);\n\n  request.onerror = function (_event) {// NOOP - Nothing we can do.\n  };\n\n  request.onsuccess = function (_event) {\n    var db = request.result;\n    handleDb(db, services);\n  };\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DbInterface =\n/** @class */\nfunction () {\n  function DbInterface() {\n    this.dbPromise = null;\n  }\n  /** Gets record(s) from the objectStore that match the given key. */\n\n\n  DbInterface.prototype.get = function (key) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore.get(key);\n    });\n  };\n  /** Gets record(s) from the objectStore that match the given index. */\n\n\n  DbInterface.prototype.getIndex = function (index, key) {\n    function runRequest(objectStore) {\n      var idbIndex = objectStore.index(index);\n      return idbIndex.get(key);\n    }\n\n    return this.createTransaction(runRequest);\n  };\n  /** Assigns or overwrites the record for the given value. */\n  // IndexedDB values are of type \"any\"\n\n\n  DbInterface.prototype.put = function (value) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore.put(value);\n    }, 'readwrite');\n  };\n  /** Deletes record(s) from the objectStore that match the given key. */\n\n\n  DbInterface.prototype[\"delete\"] = function (key) {\n    return this.createTransaction(function (objectStore) {\n      return objectStore[\"delete\"](key);\n    }, 'readwrite');\n  };\n  /**\r\n   * Close the currently open database.\r\n   */\n\n\n  DbInterface.prototype.closeDatabase = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var db;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!this.dbPromise) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.dbPromise];\n\n          case 1:\n            db = _a.sent();\n            db.close();\n            this.dbPromise = null;\n            _a.label = 2;\n\n          case 2:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Creates an IndexedDB Transaction and passes its objectStore to the\r\n   * runRequest function, which runs the database request.\r\n   *\r\n   * @return Promise that resolves with the result of the runRequest function\r\n   */\n\n\n  DbInterface.prototype.createTransaction = function (runRequest, mode) {\n    if (mode === void 0) {\n      mode = 'readonly';\n    }\n\n    return __awaiter(this, void 0, void 0, function () {\n      var db, transaction, request, result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getDb()];\n\n          case 1:\n            db = _a.sent();\n            transaction = db.transaction(this.objectStoreName, mode);\n            request = transaction.objectStore(this.objectStoreName);\n            return [4\n            /*yield*/\n            , promisify(runRequest(request))];\n\n          case 2:\n            result = _a.sent();\n            return [2\n            /*return*/\n            , new Promise(function (resolve, reject) {\n              transaction.oncomplete = function () {\n                resolve(result);\n              };\n\n              transaction.onerror = function () {\n                reject(transaction.error);\n              };\n            })];\n        }\n      });\n    });\n  };\n  /** Gets the cached db connection or opens a new one. */\n\n\n  DbInterface.prototype.getDb = function () {\n    var _this = this;\n\n    if (!this.dbPromise) {\n      this.dbPromise = new Promise(function (resolve, reject) {\n        var request = indexedDB.open(_this.dbName, _this.dbVersion);\n\n        request.onsuccess = function () {\n          resolve(request.result);\n        };\n\n        request.onerror = function () {\n          _this.dbPromise = null;\n          reject(request.error);\n        };\n\n        request.onupgradeneeded = function (event) {\n          return _this.onDbUpgrade(request, event);\n        };\n      });\n    }\n\n    return this.dbPromise;\n  };\n\n  return DbInterface;\n}();\n/** Promisifies an IDBRequest. Resolves with the IDBRequest's result. */\n\n\nfunction promisify(request) {\n  return new Promise(function (resolve, reject) {\n    request.onsuccess = function () {\n      resolve(request.result);\n    };\n\n    request.onerror = function () {\n      reject(request.error);\n    };\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar TokenDetailsModel =\n/** @class */\nfunction (_super) {\n  __extends(TokenDetailsModel, _super);\n\n  function TokenDetailsModel(services) {\n    var _this = _super.call(this) || this;\n\n    _this.services = services;\n    _this.dbName = 'fcm_token_details_db';\n    _this.dbVersion = 4;\n    _this.objectStoreName = 'fcm_token_object_Store';\n    return _this;\n  }\n\n  TokenDetailsModel.prototype.onDbUpgrade = function (request, event) {\n    var db = request.result; // Lack of 'break' statements is intentional.\n\n    switch (event.oldVersion) {\n      case 0:\n        {\n          // New IDB instance\n          var objectStore = db.createObjectStore(this.objectStoreName, {\n            keyPath: 'swScope'\n          }); // Make sure the sender ID can be searched\n\n          objectStore.createIndex('fcmSenderId', 'fcmSenderId', {\n            unique: false\n          });\n          objectStore.createIndex('fcmToken', 'fcmToken', {\n            unique: true\n          });\n        }\n\n      case 1:\n        {\n          // Prior to version 2, we were using either 'fcm_token_details_db'\n          // or 'undefined' as the database name due to bug in the SDK\n          // So remove the old tokens and databases.\n          cleanV1(this.services);\n        }\n\n      case 2:\n        {\n          // Update from v2 to v4 directly in a single openCursor request.\n          // We need to do this because for some reason, doing a subsequent update on the same data\n          // in the same transaction drops the first update.\n          var objectStore = request.transaction.objectStore(this.objectStoreName);\n          var cursorRequest_1 = objectStore.openCursor();\n\n          cursorRequest_1.onsuccess = function () {\n            var cursor = cursorRequest_1.result;\n\n            if (cursor) {\n              var value = cursor.value;\n\n              var newValue = __assign({}, value);\n\n              if (!value.createTime) {\n                newValue.createTime = Date.now();\n              }\n\n              if (typeof value.vapidKey === 'string') {\n                newValue.vapidKey = base64ToArrayBuffer(value.vapidKey);\n              }\n\n              if (typeof value.auth === 'string') {\n                newValue.auth = base64ToArrayBuffer(value.auth).buffer;\n              }\n\n              if (typeof value.auth === 'string') {\n                newValue.p256dh = base64ToArrayBuffer(value.p256dh).buffer;\n              }\n\n              if (typeof value.fcmPushSet === 'string') {\n                delete newValue.fcmPushSet;\n              }\n\n              cursor.update(newValue);\n              cursor[\"continue\"]();\n            }\n          }; // Break here as we've already updated to v4.\n\n\n          break;\n        }\n\n      case 3:\n        {\n          // Update from V3 to V4.\n          var objectStore = request.transaction.objectStore(this.objectStoreName);\n          var cursorRequest_2 = objectStore.openCursor();\n\n          cursorRequest_2.onsuccess = function () {\n            var cursor = cursorRequest_2.result;\n\n            if (cursor) {\n              var value = cursor.value;\n\n              var newValue = __assign({}, value);\n\n              if (typeof value.fcmPushSet === 'string') {\n                delete newValue.fcmPushSet;\n              }\n\n              cursor.update(newValue);\n              cursor[\"continue\"]();\n            }\n          };\n        }\n    }\n  };\n  /**\r\n   * Given a token, this method will look up the details in indexedDB.\r\n   */\n\n\n  TokenDetailsModel.prototype.getTokenDetailsFromToken = function (fcmToken) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!fcmToken) {\n          throw errorFactory.create(\"bad-token\"\n          /* BAD_TOKEN */\n          );\n        }\n\n        validateInputs({\n          fcmToken: fcmToken\n        });\n        return [2\n        /*return*/\n        , this.getIndex('fcmToken', fcmToken)];\n      });\n    });\n  };\n  /**\r\n   * Given a service worker scope, this method will look up the details in\r\n   * indexedDB.\r\n   * @return The details associated with that token.\r\n   */\n\n\n  TokenDetailsModel.prototype.getTokenDetailsFromSWScope = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!swScope) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        validateInputs({\n          swScope: swScope\n        });\n        return [2\n        /*return*/\n        , this.get(swScope)];\n      });\n    });\n  };\n  /**\r\n   * Save the details for the fcm token for re-use at a later date.\r\n   * @param input A plain js object containing args to save.\r\n   */\n\n\n  TokenDetailsModel.prototype.saveTokenDetails = function (tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!tokenDetails.swScope) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        if (!tokenDetails.vapidKey) {\n          throw errorFactory.create(\"bad-vapid-key\"\n          /* BAD_VAPID_KEY */\n          );\n        }\n\n        if (!tokenDetails.endpoint || !tokenDetails.auth || !tokenDetails.p256dh) {\n          throw errorFactory.create(\"bad-subscription\"\n          /* BAD_SUBSCRIPTION */\n          );\n        }\n\n        if (!tokenDetails.fcmSenderId) {\n          throw errorFactory.create(\"bad-sender-id\"\n          /* BAD_SENDER_ID */\n          );\n        }\n\n        if (!tokenDetails.fcmToken) {\n          throw errorFactory.create(\"bad-token\"\n          /* BAD_TOKEN */\n          );\n        }\n\n        validateInputs(tokenDetails);\n        return [2\n        /*return*/\n        , this.put(tokenDetails)];\n      });\n    });\n  };\n  /**\r\n   * This method deletes details of the current FCM token.\r\n   * It's returning a promise in case we need to move to an async\r\n   * method for deleting at a later date.\r\n   *\r\n   * @return Resolves once the FCM token details have been deleted and returns\r\n   * the deleted details.\r\n   */\n\n\n  TokenDetailsModel.prototype.deleteToken = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var details;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof token !== 'string' || token.length === 0) {\n              return [2\n              /*return*/\n              , Promise.reject(errorFactory.create(\"invalid-delete-token\"\n              /* INVALID_DELETE_TOKEN */\n              ))];\n            }\n\n            return [4\n            /*yield*/\n            , this.getTokenDetailsFromToken(token)];\n\n          case 1:\n            details = _a.sent();\n\n            if (!details) {\n              throw errorFactory.create(\"delete-token-not-found\"\n              /* DELETE_TOKEN_NOT_FOUND */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this[\"delete\"](details.swScope)];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , details];\n        }\n      });\n    });\n  };\n\n  return TokenDetailsModel;\n}(DbInterface);\n/**\r\n * This method takes an object and will check for known arguments and\r\n * validate the input.\r\n * @return Promise that resolves if input is valid, rejects otherwise.\r\n */\n\n\nfunction validateInputs(input) {\n  if (input.fcmToken) {\n    if (typeof input.fcmToken !== 'string' || input.fcmToken.length === 0) {\n      throw errorFactory.create(\"bad-token\"\n      /* BAD_TOKEN */\n      );\n    }\n  }\n\n  if (input.swScope) {\n    if (typeof input.swScope !== 'string' || input.swScope.length === 0) {\n      throw errorFactory.create(\"bad-scope\"\n      /* BAD_SCOPE */\n      );\n    }\n  }\n\n  if (input.vapidKey) {\n    if (!(input.vapidKey instanceof Uint8Array) || input.vapidKey.length !== 65) {\n      throw errorFactory.create(\"bad-vapid-key\"\n      /* BAD_VAPID_KEY */\n      );\n    }\n  }\n\n  if (input.endpoint) {\n    if (typeof input.endpoint !== 'string' || input.endpoint.length === 0) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.auth) {\n    if (!(input.auth instanceof ArrayBuffer)) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.p256dh) {\n    if (!(input.p256dh instanceof ArrayBuffer)) {\n      throw errorFactory.create(\"bad-subscription\"\n      /* BAD_SUBSCRIPTION */\n      );\n    }\n  }\n\n  if (input.fcmSenderId) {\n    if (typeof input.fcmSenderId !== 'string' || input.fcmSenderId.length === 0) {\n      throw errorFactory.create(\"bad-sender-id\"\n      /* BAD_SENDER_ID */\n      );\n    }\n  }\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar UNCOMPRESSED_PUBLIC_KEY_SIZE = 65;\n\nvar VapidDetailsModel =\n/** @class */\nfunction (_super) {\n  __extends(VapidDetailsModel, _super);\n\n  function VapidDetailsModel() {\n    var _this = _super !== null && _super.apply(this, arguments) || this;\n\n    _this.dbName = 'fcm_vapid_details_db';\n    _this.dbVersion = 1;\n    _this.objectStoreName = 'fcm_vapid_object_Store';\n    return _this;\n  }\n\n  VapidDetailsModel.prototype.onDbUpgrade = function (request) {\n    var db = request.result;\n    db.createObjectStore(this.objectStoreName, {\n      keyPath: 'swScope'\n    });\n  };\n  /**\r\n   * Given a service worker scope, this method will look up the vapid key\r\n   * in indexedDB.\r\n   */\n\n\n  VapidDetailsModel.prototype.getVapidFromSWScope = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      var result;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (typeof swScope !== 'string' || swScope.length === 0) {\n              throw errorFactory.create(\"bad-scope\"\n              /* BAD_SCOPE */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.get(swScope)];\n\n          case 1:\n            result = _a.sent();\n            return [2\n            /*return*/\n            , result ? result.vapidKey : undefined];\n        }\n      });\n    });\n  };\n  /**\r\n   * Save a vapid key against a swScope for later date.\r\n   */\n\n\n  VapidDetailsModel.prototype.saveVapidDetails = function (swScope, vapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var details;\n      return __generator(this, function (_a) {\n        if (typeof swScope !== 'string' || swScope.length === 0) {\n          throw errorFactory.create(\"bad-scope\"\n          /* BAD_SCOPE */\n          );\n        }\n\n        if (vapidKey === null || vapidKey.length !== UNCOMPRESSED_PUBLIC_KEY_SIZE) {\n          throw errorFactory.create(\"bad-vapid-key\"\n          /* BAD_VAPID_KEY */\n          );\n        }\n\n        details = {\n          swScope: swScope,\n          vapidKey: vapidKey\n        };\n        return [2\n        /*return*/\n        , this.put(details)];\n      });\n    });\n  };\n  /**\r\n   * This method deletes details of the current FCM VAPID key for a SW scope.\r\n   * Resolves once the scope/vapid details have been deleted and returns the\r\n   * deleted vapid key.\r\n   */\n\n\n  VapidDetailsModel.prototype.deleteVapidDetails = function (swScope) {\n    return __awaiter(this, void 0, void 0, function () {\n      var vapidKey;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getVapidFromSWScope(swScope)];\n\n          case 1:\n            vapidKey = _a.sent();\n\n            if (!vapidKey) {\n              throw errorFactory.create(\"delete-scope-not-found\"\n              /* DELETE_SCOPE_NOT_FOUND */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this[\"delete\"](swScope)];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , vapidKey];\n        }\n      });\n    });\n  };\n\n  return VapidDetailsModel;\n}(DbInterface);\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n// Token should be refreshed once a week.\n\n\nvar TOKEN_EXPIRATION_MILLIS = 7 * 24 * 60 * 60 * 1000; // 7 days\n\nvar BaseController =\n/** @class */\nfunction () {\n  function BaseController(services) {\n    var _this = this;\n\n    this.services = services;\n    this.vapidDetailsModel = new VapidDetailsModel();\n    this.subscriptionManager = new SubscriptionManager();\n    var app = services.app;\n    this.app = app;\n\n    if (!app.options.messagingSenderId || typeof app.options.messagingSenderId !== 'string') {\n      throw errorFactory.create(\"bad-sender-id\"\n      /* BAD_SENDER_ID */\n      );\n    }\n\n    this.INTERNAL = {\n      \"delete\": function _delete() {\n        return _this[\"delete\"]();\n      }\n    };\n    this.tokenDetailsModel = new TokenDetailsModel(services);\n  }\n\n  BaseController.prototype.getToken = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permission, swReg, publicVapidKey, pushSubscription, tokenDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            permission = this.getNotificationPermission();\n            if (!(permission === 'default')) return [3\n            /*break*/\n            , 2];\n            return [4\n            /*yield*/\n            , this.requestNotificationPermission()];\n\n          case 1:\n            // The user hasn't allowed or denied notifications yet. Ask them.\n            permission = _a.sent();\n            _a.label = 2;\n\n          case 2:\n            if (permission !== 'granted') {\n              throw errorFactory.create(\"notifications-blocked\"\n              /* NOTIFICATIONS_BLOCKED */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 3:\n            swReg = _a.sent();\n            return [4\n            /*yield*/\n            , this.getPublicVapidKey_()];\n\n          case 4:\n            publicVapidKey = _a.sent();\n            return [4\n            /*yield*/\n            , this.getPushSubscription(swReg, publicVapidKey)];\n\n          case 5:\n            pushSubscription = _a.sent();\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.getTokenDetailsFromSWScope(swReg.scope)];\n\n          case 6:\n            tokenDetails = _a.sent();\n\n            if (tokenDetails) {\n              return [2\n              /*return*/\n              , this.manageExistingToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\n            }\n\n            return [2\n            /*return*/\n            , this.getNewToken(swReg, pushSubscription, publicVapidKey)];\n        }\n      });\n    });\n  };\n  /**\r\n   * manageExistingToken is triggered if there's an existing FCM token in the\r\n   * database and it can take 3 different actions:\r\n   * 1) Retrieve the existing FCM token from the database.\r\n   * 2) If VAPID details have changed: Delete the existing token and create a\r\n   * new one with the new VAPID key.\r\n   * 3) If the database cache is invalidated: Send a request to FCM to update\r\n   * the token, and to check if the token is still valid on FCM-side.\r\n   */\n\n\n  BaseController.prototype.manageExistingToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var isTokenValid, now;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            isTokenValid = isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails);\n            if (!isTokenValid) return [3\n            /*break*/\n            , 1];\n            now = Date.now();\n\n            if (now < tokenDetails.createTime + TOKEN_EXPIRATION_MILLIS) {\n              return [2\n              /*return*/\n              , tokenDetails.fcmToken];\n            } else {\n              return [2\n              /*return*/\n              , this.updateToken(swReg, pushSubscription, publicVapidKey, tokenDetails)];\n            }\n\n          case 1:\n            // If the token is no longer valid (for example if the VAPID details\n            // have changed), delete the existing token from the FCM client and server\n            // database. No need to unsubscribe from the Service Worker as we have a\n            // good push subscription that we'd like to use in getNewToken.\n            return [4\n            /*yield*/\n            , this.deleteTokenFromDB(tokenDetails.fcmToken)];\n\n          case 2:\n            // If the token is no longer valid (for example if the VAPID details\n            // have changed), delete the existing token from the FCM client and server\n            // database. No need to unsubscribe from the Service Worker as we have a\n            // good push subscription that we'd like to use in getNewToken.\n            _a.sent();\n\n            return [2\n            /*return*/\n            , this.getNewToken(swReg, pushSubscription, publicVapidKey)];\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  BaseController.prototype.updateToken = function (swReg, pushSubscription, publicVapidKey, tokenDetails) {\n    return __awaiter(this, void 0, void 0, function () {\n      var updatedToken, allDetails, e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 4,, 6]);\n\n            return [4\n            /*yield*/\n            , this.subscriptionManager.updateToken(tokenDetails, this.services, pushSubscription, publicVapidKey)];\n\n          case 1:\n            updatedToken = _a.sent();\n            allDetails = {\n              swScope: swReg.scope,\n              vapidKey: publicVapidKey,\n              fcmSenderId: this.services.app.options.messagingSenderId,\n              fcmToken: updatedToken,\n              createTime: Date.now(),\n              endpoint: pushSubscription.endpoint,\n              auth: pushSubscription.getKey('auth'),\n              p256dh: pushSubscription.getKey('p256dh')\n            };\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.saveTokenDetails(allDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , updatedToken];\n\n          case 4:\n            e_1 = _a.sent();\n            return [4\n            /*yield*/\n            , this.deleteToken(tokenDetails.fcmToken)];\n\n          case 5:\n            _a.sent();\n\n            throw e_1;\n\n          case 6:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  BaseController.prototype.getNewToken = function (swReg, pushSubscription, publicVapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var newToken, allDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.subscriptionManager.getToken(this.services, pushSubscription, publicVapidKey)];\n\n          case 1:\n            newToken = _a.sent();\n            allDetails = {\n              swScope: swReg.scope,\n              vapidKey: publicVapidKey,\n              fcmSenderId: this.app.options.messagingSenderId,\n              fcmToken: newToken,\n              createTime: Date.now(),\n              endpoint: pushSubscription.endpoint,\n              auth: pushSubscription.getKey('auth'),\n              p256dh: pushSubscription.getKey('p256dh')\n            };\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.saveTokenDetails(allDetails)];\n\n          case 2:\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.vapidDetailsModel.saveVapidDetails(swReg.scope, publicVapidKey)];\n\n          case 3:\n            _a.sent();\n\n            return [2\n            /*return*/\n            , newToken];\n        }\n      });\n    });\n  };\n  /**\r\n   * This method deletes tokens that the token manager looks after,\r\n   * unsubscribes the token from FCM  and then unregisters the push\r\n   * subscription if it exists. It returns a promise that indicates\r\n   * whether or not the unsubscribe request was processed successfully.\r\n   */\n\n\n  BaseController.prototype.deleteToken = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var registration, pushSubscription;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            // Delete the token details from the database.\n            return [4\n            /*yield*/\n            , this.deleteTokenFromDB(token)];\n\n          case 1:\n            // Delete the token details from the database.\n            _a.sent();\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 2:\n            registration = _a.sent();\n            if (!registration) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , registration.pushManager.getSubscription()];\n\n          case 3:\n            pushSubscription = _a.sent();\n\n            if (pushSubscription) {\n              return [2\n              /*return*/\n              , pushSubscription.unsubscribe()];\n            }\n\n            _a.label = 4;\n\n          case 4:\n            // If there's no SW, consider it a success.\n            return [2\n            /*return*/\n            , true];\n        }\n      });\n    });\n  };\n  /**\r\n   * This method will delete the token from the client database, and make a\r\n   * call to FCM to remove it from the server DB. Does not temper with the\r\n   * push subscription.\r\n   */\n\n\n  BaseController.prototype.deleteTokenFromDB = function (token) {\n    return __awaiter(this, void 0, void 0, function () {\n      var tokenDetails, e_2;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.tokenDetailsModel.deleteToken(token)];\n\n          case 1:\n            tokenDetails = _a.sent();\n            _a.label = 2;\n\n          case 2:\n            _a.trys.push([2, 4,, 5]);\n\n            return [4\n            /*yield*/\n            , this.subscriptionManager.deleteToken(this.services, tokenDetails)];\n\n          case 3:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 5];\n\n          case 4:\n            e_2 = _a.sent(); // A failed server-side delete does not need to break the app.\n\n            console.error(e_2);\n            return [3\n            /*break*/\n            , 5];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Gets a PushSubscription for the current user.\r\n   */\n\n\n  BaseController.prototype.getPushSubscription = function (swRegistration, publicVapidKey) {\n    return __awaiter(this, void 0, void 0, function () {\n      var subscription;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , swRegistration.pushManager.getSubscription()];\n\n          case 1:\n            subscription = _a.sent();\n\n            if (subscription) {\n              return [2\n              /*return*/\n              , subscription];\n            }\n\n            return [2\n            /*return*/\n            , swRegistration.pushManager.subscribe({\n              userVisibleOnly: true,\n              applicationServerKey: publicVapidKey\n            })];\n        }\n      });\n    });\n  }; //\n  // The following methods should only be available in the window.\n  //\n\n  /**\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  BaseController.prototype.requestPermission = function () {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.useServiceWorker = function (_registration) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.usePublicVapidKey = function (_b64PublicKey) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.onMessage = function (_nextOrObserver, _error, _completed) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  };\n\n  BaseController.prototype.onTokenRefresh = function (_nextOrObserver, _error, _completed) {\n    throw errorFactory.create(\"only-available-in-window\"\n    /* AVAILABLE_IN_WINDOW */\n    );\n  }; //\n  // The following methods are used by the service worker only.\n  //\n\n\n  BaseController.prototype.setBackgroundMessageHandler = function (_callback) {\n    throw errorFactory.create(\"only-available-in-sw\"\n    /* AVAILABLE_IN_SW */\n    );\n  }; //\n  // The following methods are used by the service themselves and not exposed\n  // publicly or not expected to be used by developers.\n  //\n\n  /**\r\n   * This method is required to adhere to the Firebase interface.\r\n   * It closes any currently open indexdb database connections.\r\n   */\n\n\n  BaseController.prototype[\"delete\"] = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , Promise.all([this.tokenDetailsModel.closeDatabase(), this.vapidDetailsModel.closeDatabase()])];\n\n          case 1:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * Returns the current Notification Permission state.\r\n   */\n\n\n  BaseController.prototype.getNotificationPermission = function () {\n    return Notification.permission;\n  };\n  /**\r\n   * Requests notification permission from the user.\r\n   */\n\n\n  BaseController.prototype.requestNotificationPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (!Notification.requestPermission) {\n          // Notification.requestPermission() is not available in service workers.\n          // Return the current permission.\n          return [2\n          /*return*/\n          , Notification.permission];\n        }\n\n        return [2\n        /*return*/\n        , Notification.requestPermission()];\n      });\n    });\n  };\n\n  BaseController.prototype.getTokenDetailsModel = function () {\n    return this.tokenDetailsModel;\n  };\n\n  BaseController.prototype.getVapidDetailsModel = function () {\n    return this.vapidDetailsModel;\n  }; // Visible for testing\n  // TODO: make protected\n\n\n  BaseController.prototype.getSubscriptionManager = function () {\n    return this.subscriptionManager;\n  };\n\n  return BaseController;\n}();\n/**\r\n * Checks if the tokenDetails match the details provided in the clients.\r\n */\n\n\nfunction isTokenStillValid(pushSubscription, publicVapidKey, tokenDetails) {\n  if (!tokenDetails.vapidKey || !isArrayBufferEqual(publicVapidKey.buffer, tokenDetails.vapidKey.buffer)) {\n    return false;\n  }\n\n  var isEndpointEqual = pushSubscription.endpoint === tokenDetails.endpoint;\n  var isAuthEqual = isArrayBufferEqual(pushSubscription.getKey('auth'), tokenDetails.auth);\n  var isP256dhEqual = isArrayBufferEqual(pushSubscription.getKey('p256dh'), tokenDetails.p256dh);\n  return isEndpointEqual && isAuthEqual && isP256dhEqual;\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar FCM_MSG = 'FCM_MSG';\n\nvar SwController =\n/** @class */\nfunction (_super) {\n  __extends(SwController, _super);\n\n  function SwController(services) {\n    var _this = _super.call(this, services) || this;\n\n    _this.bgMessageHandler = null;\n    self.addEventListener('push', function (e) {\n      _this.onPush(e);\n    });\n    self.addEventListener('pushsubscriptionchange', function (e) {\n      _this.onSubChange(e);\n    });\n    self.addEventListener('notificationclick', function (e) {\n      _this.onNotificationClick(e);\n    });\n    return _this;\n  } // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onPush = function (event) {\n    event.waitUntil(this.onPush_(event));\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onSubChange = function (event) {\n    event.waitUntil(this.onSubChange_(event));\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.onNotificationClick = function (event) {\n    event.waitUntil(this.onNotificationClick_(event));\n  };\n  /**\r\n   * A handler for push events that shows notifications based on the content of\r\n   * the payload.\r\n   *\r\n   * The payload must be a JSON-encoded Object with a `notification` key. The\r\n   * value of the `notification` property will be used as the NotificationOptions\r\n   * object passed to showNotification. Additionally, the `title` property of the\r\n   * notification object will be used as the title.\r\n   *\r\n   * If there is no notification data in the payload then no notification will be\r\n   * shown.\r\n   */\n\n\n  SwController.prototype.onPush_ = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var msgPayload, hasVisibleClients, notificationDetails, notificationTitle, reg, actions, maxActions;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!event.data) {\n              return [2\n              /*return*/\n              ];\n            }\n\n            try {\n              msgPayload = event.data.json();\n            } catch (err) {\n              // Not JSON so not an FCM message\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , this.hasVisibleClients_()];\n\n          case 1:\n            hasVisibleClients = _a.sent();\n\n            if (hasVisibleClients) {\n              // App in foreground. Send to page.\n              return [2\n              /*return*/\n              , this.sendMessageToWindowClients_(msgPayload)];\n            }\n\n            notificationDetails = this.getNotificationData_(msgPayload);\n            if (!notificationDetails) return [3\n            /*break*/\n            , 3];\n            notificationTitle = notificationDetails.title || '';\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 2:\n            reg = _a.sent();\n            actions = notificationDetails.actions;\n            maxActions = Notification.maxActions;\n\n            if (actions && maxActions && actions.length > maxActions) {\n              console.warn(\"This browser only supports \" + maxActions + \" actions.\" + \"The remaining actions will not be displayed.\");\n            }\n\n            return [2\n            /*return*/\n            , reg.showNotification(notificationTitle, notificationDetails)];\n\n          case 3:\n            if (!this.bgMessageHandler) return [3\n            /*break*/\n            , 5];\n            return [4\n            /*yield*/\n            , this.bgMessageHandler(msgPayload)];\n\n          case 4:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n\n          case 5:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onSubChange_ = function (_event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var registration, err_1, err_2, tokenDetailsModel, tokenDetails;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 1:\n            registration = _a.sent();\n            return [3\n            /*break*/\n            , 3];\n\n          case 2:\n            err_1 = _a.sent();\n            throw errorFactory.create(\"unable-to-resubscribe\"\n            /* UNABLE_TO_RESUBSCRIBE */\n            , {\n              errorInfo: err_1\n            });\n\n          case 3:\n            _a.trys.push([3, 5,, 8]);\n\n            return [4\n            /*yield*/\n            , registration.pushManager.getSubscription()];\n\n          case 4:\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 8];\n\n          case 5:\n            err_2 = _a.sent();\n            tokenDetailsModel = this.getTokenDetailsModel();\n            return [4\n            /*yield*/\n            , tokenDetailsModel.getTokenDetailsFromSWScope(registration.scope)];\n\n          case 6:\n            tokenDetails = _a.sent();\n\n            if (!tokenDetails) {\n              // This should rarely occure, but could if indexedDB\n              // is corrupted or wiped\n              throw err_2;\n            } // Attempt to delete the token if we know it's bad\n\n\n            return [4\n            /*yield*/\n            , this.deleteToken(tokenDetails.fcmToken)];\n\n          case 7:\n            // Attempt to delete the token if we know it's bad\n            _a.sent();\n\n            throw err_2;\n\n          case 8:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  SwController.prototype.onNotificationClick_ = function (event) {\n    return __awaiter(this, void 0, void 0, function () {\n      var msgPayload, link, windowClient, internalMsg;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (!event.notification || !event.notification.data || !event.notification.data[FCM_MSG]) {\n              // Not an FCM notification, do nothing.\n              return [2\n              /*return*/\n              ];\n            } else if (event.action) {\n              // User clicked on an action button.\n              // This will allow devs to act on action button clicks by using a custom\n              // onNotificationClick listener that they define.\n              return [2\n              /*return*/\n              ];\n            } // Prevent other listeners from receiving the event\n\n\n            event.stopImmediatePropagation();\n            event.notification.close();\n            msgPayload = event.notification.data[FCM_MSG];\n\n            if (!msgPayload.notification) {\n              // Nothing to do.\n              return [2\n              /*return*/\n              ];\n            }\n\n            link = msgPayload.fcmOptions && msgPayload.fcmOptions.link || msgPayload.notification.click_action;\n\n            if (!link) {\n              if (msgPayload.data && FN_CAMPAIGN_ID in msgPayload.data) {\n                link = self.location.origin;\n              } else {\n                // Nothing to do.\n                return [2\n                /*return*/\n                ];\n              }\n            }\n\n            return [4\n            /*yield*/\n            , this.getWindowClient_(link)];\n\n          case 1:\n            windowClient = _a.sent();\n            if (!!windowClient) return [3\n            /*break*/\n            , 4];\n            return [4\n            /*yield*/\n            , self.clients.openWindow(link)];\n\n          case 2:\n            // Unable to find window client so need to open one.\n            windowClient = _a.sent(); // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n\n            return [4\n            /*yield*/\n            , sleep(3000)];\n\n          case 3:\n            // Wait three seconds for the client to initialize and set up the message\n            // handler so that it can receive the message.\n            _a.sent();\n\n            return [3\n            /*break*/\n            , 6];\n\n          case 4:\n            return [4\n            /*yield*/\n            , windowClient.focus()];\n\n          case 5:\n            windowClient = _a.sent();\n            _a.label = 6;\n\n          case 6:\n            if (!windowClient) {\n              // Window Client will not be returned if it's for a third party origin.\n              return [2\n              /*return*/\n              ];\n            } // Delete notification and fcmOptions data from payload before sending to\n            // the page.\n\n\n            delete msgPayload.notification;\n            delete msgPayload.fcmOptions;\n            internalMsg = createNewMsg(MessageType.NOTIFICATION_CLICKED, msgPayload); // Attempt to send a message to the client to handle the data\n            // Is affected by: https://github.com/slightlyoff/ServiceWorker/issues/728\n\n            return [2\n            /*return*/\n            , this.attemptToMessageClient_(windowClient, internalMsg)];\n        }\n      });\n    });\n  }; // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.getNotificationData_ = function (msgPayload) {\n    var _a;\n\n    if (!msgPayload) {\n      return;\n    }\n\n    if (typeof msgPayload.notification !== 'object') {\n      return;\n    }\n\n    var notificationInformation = __assign({}, msgPayload.notification); // Put the message payload under FCM_MSG name so we can identify the\n    // notification as being an FCM notification vs a notification from\n    // somewhere else (i.e. normal web push or developer generated\n    // notification).\n\n\n    notificationInformation.data = __assign(__assign({}, msgPayload.notification.data), (_a = {}, _a[FCM_MSG] = msgPayload, _a));\n    return notificationInformation;\n  };\n  /**\r\n   * Calling setBackgroundMessageHandler will opt in to some specific\r\n   * behaviours.\r\n   * 1.) If a notification doesn't need to be shown due to a window already\r\n   * being visible, then push messages will be sent to the page.\r\n   * 2.) If a notification needs to be shown, and the message contains no\r\n   * notification data this method will be called\r\n   * and the promise it returns will be passed to event.waitUntil.\r\n   * If you do not set this callback then all push messages will let and the\r\n   * developer can handle them in a their own 'push' event callback\r\n   *\r\n   * @param callback The callback to be called when a push message is received\r\n   * and a notification must be shown. The callback will be given the data from\r\n   * the push message.\r\n   */\n\n\n  SwController.prototype.setBackgroundMessageHandler = function (callback) {\n    if (!callback || typeof callback !== 'function') {\n      throw errorFactory.create(\"bg-handler-function-expected\"\n      /* BG_HANDLER_FUNCTION_EXPECTED */\n      );\n    }\n\n    this.bgMessageHandler = callback;\n  };\n  /**\r\n   * @param url The URL to look for when focusing a client.\r\n   * @return Returns an existing window client or a newly opened WindowClient.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.getWindowClient_ = function (url) {\n    return __awaiter(this, void 0, void 0, function () {\n      var parsedURL, clientList, suitableClient, i, parsedClientUrl;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            parsedURL = new URL(url, self.location.href).href;\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            suitableClient = null;\n\n            for (i = 0; i < clientList.length; i++) {\n              parsedClientUrl = new URL(clientList[i].url, self.location.href).href;\n\n              if (parsedClientUrl === parsedURL) {\n                suitableClient = clientList[i];\n                break;\n              }\n            }\n\n            return [2\n            /*return*/\n            , suitableClient];\n        }\n      });\n    });\n  };\n  /**\r\n   * This message will attempt to send the message to a window client.\r\n   * @param client The WindowClient to send the message to.\r\n   * @param message The message to send to the client.\r\n   * @returns Returns a promise that resolves after sending the message. This\r\n   * does not guarantee that the message was successfully received.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.attemptToMessageClient_ = function (client, message) {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        // NOTE: This returns a promise in case this API is abstracted later on to\n        // do additional work\n        if (!client) {\n          throw errorFactory.create(\"no-window-client-to-msg\"\n          /* NO_WINDOW_CLIENT_TO_MSG */\n          );\n        }\n\n        client.postMessage(message);\n        return [2\n        /*return*/\n        ];\n      });\n    });\n  };\n  /**\r\n   * @returns If there is currently a visible WindowClient, this method will\r\n   * resolve to true, otherwise false.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.hasVisibleClients_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var clientList;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            return [2\n            /*return*/\n            , clientList.some(function (client) {\n              return client.visibilityState === 'visible' && // Ignore chrome-extension clients as that matches the background pages\n              // of extensions, which are always considered visible.\n              !client.url.startsWith('chrome-extension://');\n            })];\n        }\n      });\n    });\n  };\n  /**\r\n   * @param msgPayload The data from the push event that should be sent to all\r\n   * available pages.\r\n   * @returns Returns a promise that resolves once the message has been sent to\r\n   * all WindowClients.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  SwController.prototype.sendMessageToWindowClients_ = function (msgPayload) {\n    return __awaiter(this, void 0, void 0, function () {\n      var clientList, internalMsg;\n\n      var _this = this;\n\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , getClientList()];\n\n          case 1:\n            clientList = _a.sent();\n            internalMsg = createNewMsg(MessageType.PUSH_MSG_RECEIVED, msgPayload);\n            return [4\n            /*yield*/\n            , Promise.all(clientList.map(function (client) {\n              return _this.attemptToMessageClient_(client, internalMsg);\n            }))];\n\n          case 2:\n            _a.sent();\n\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n  /**\r\n   * This will register the default service worker and return the registration.\r\n   * @return he service worker registration to be used for the push service.\r\n   */\n\n\n  SwController.prototype.getSWRegistration_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        return [2\n        /*return*/\n        , self.registration];\n      });\n    });\n  };\n  /**\r\n   * This will return the default VAPID key or the uint8array version of the\r\n   * public VAPID key provided by the developer.\r\n   */\n\n\n  SwController.prototype.getPublicVapidKey_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var swReg, vapidKeyFromDatabase;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            return [4\n            /*yield*/\n            , this.getSWRegistration_()];\n\n          case 1:\n            swReg = _a.sent();\n\n            if (!swReg) {\n              throw errorFactory.create(\"sw-registration-expected\"\n              /* SW_REGISTRATION_EXPECTED */\n              );\n            }\n\n            return [4\n            /*yield*/\n            , this.getVapidDetailsModel().getVapidFromSWScope(swReg.scope)];\n\n          case 2:\n            vapidKeyFromDatabase = _a.sent();\n\n            if (vapidKeyFromDatabase == null) {\n              return [2\n              /*return*/\n              , DEFAULT_PUBLIC_VAPID_KEY];\n            }\n\n            return [2\n            /*return*/\n            , vapidKeyFromDatabase];\n        }\n      });\n    });\n  };\n\n  return SwController;\n}(BaseController);\n\nfunction getClientList() {\n  return self.clients.matchAll({\n    type: 'window',\n    includeUncontrolled: true // TS doesn't know that \"type: 'window'\" means it'll return WindowClient[]\n\n  });\n}\n\nfunction createNewMsg(msgType, msgData) {\n  return {\n    firebaseMessagingType: msgType,\n    firebaseMessagingData: msgData\n  };\n}\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DEFAULT_SW_PATH = '/firebase-messaging-sw.js';\nvar DEFAULT_SW_SCOPE = '/firebase-cloud-messaging-push-scope';\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar WindowController =\n/** @class */\nfunction (_super) {\n  __extends(WindowController, _super);\n  /**\r\n   * A service that provides a MessagingService instance.\r\n   */\n\n\n  function WindowController(services) {\n    var _this = _super.call(this, services) || this;\n\n    _this.registrationToUse = null;\n    _this.publicVapidKeyToUse = null;\n    _this.messageObserver = null; // @ts-ignore: Unused variable error, this is not implemented yet.\n\n    _this.tokenRefreshObserver = null;\n    _this.onMessageInternal = createSubscribe(function (observer) {\n      _this.messageObserver = observer;\n    });\n    _this.onTokenRefreshInternal = createSubscribe(function (observer) {\n      _this.tokenRefreshObserver = observer;\n    });\n\n    _this.setupSWMessageListener_();\n\n    return _this;\n  }\n  /**\r\n   * Request permission if it is not currently granted\r\n   *\r\n   * @return Resolves if the permission was granted, otherwise rejects\r\n   *\r\n   * @deprecated Use Notification.requestPermission() instead.\r\n   * https://developer.mozilla.org/en-US/docs/Web/API/Notification/requestPermission\r\n   */\n\n\n  WindowController.prototype.requestPermission = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var permissionResult;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            if (Notification.permission === 'granted') {\n              return [2\n              /*return*/\n              ];\n            }\n\n            return [4\n            /*yield*/\n            , Notification.requestPermission()];\n\n          case 1:\n            permissionResult = _a.sent();\n\n            if (permissionResult === 'granted') {\n              return [2\n              /*return*/\n              ];\n            } else if (permissionResult === 'denied') {\n              throw errorFactory.create(\"permission-blocked\"\n              /* PERMISSION_BLOCKED */\n              );\n            } else {\n              throw errorFactory.create(\"permission-default\"\n              /* PERMISSION_DEFAULT */\n              );\n            }\n\n        }\n      });\n    });\n  };\n  /**\r\n   * This method allows a developer to override the default service worker and\r\n   * instead use a custom service worker.\r\n   *\r\n   * @param registration The service worker registration that should be used to\r\n   * receive the push messages.\r\n   */\n\n\n  WindowController.prototype.useServiceWorker = function (registration) {\n    if (!(registration instanceof ServiceWorkerRegistration)) {\n      throw errorFactory.create(\"sw-registration-expected\"\n      /* SW_REGISTRATION_EXPECTED */\n      );\n    }\n\n    if (this.registrationToUse != null) {\n      throw errorFactory.create(\"use-sw-before-get-token\"\n      /* USE_SW_BEFORE_GET_TOKEN */\n      );\n    }\n\n    this.registrationToUse = registration;\n  };\n  /**\r\n   * This method allows a developer to override the default vapid key\r\n   * and instead use a custom VAPID public key.\r\n   *\r\n   * @param publicKey A URL safe base64 encoded string.\r\n   */\n\n\n  WindowController.prototype.usePublicVapidKey = function (publicKey) {\n    if (typeof publicKey !== 'string') {\n      throw errorFactory.create(\"invalid-public-vapid-key\"\n      /* INVALID_PUBLIC_VAPID_KEY */\n      );\n    }\n\n    if (this.publicVapidKeyToUse != null) {\n      throw errorFactory.create(\"use-public-key-before-get-token\"\n      /* USE_PUBLIC_KEY_BEFORE_GET_TOKEN */\n      );\n    }\n\n    var parsedKey = base64ToArrayBuffer(publicKey);\n\n    if (parsedKey.length !== 65) {\n      throw errorFactory.create(\"public-vapid-key-decryption-failed\"\n      /* PUBLIC_KEY_DECRYPTION_FAILED */\n      );\n    }\n\n    this.publicVapidKeyToUse = parsedKey;\n  };\n  /**\r\n   * @export\r\n   * @param nextOrObserver An observer object or a function triggered on\r\n   * message.\r\n   * @param error A function triggered on message error.\r\n   * @param completed function triggered when the observer is removed.\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onMessage = function (nextOrObserver, error, completed) {\n    if (typeof nextOrObserver === 'function') {\n      return this.onMessageInternal(nextOrObserver, error, completed);\n    } else {\n      return this.onMessageInternal(nextOrObserver);\n    }\n  };\n  /**\r\n   * @param nextOrObserver An observer object or a function triggered on token\r\n   * refresh.\r\n   * @param error A function triggered on token refresh error.\r\n   * @param completed function triggered when the observer is removed.\r\n   * @return The unsubscribe function for the observer.\r\n   */\n\n\n  WindowController.prototype.onTokenRefresh = function (nextOrObserver, error, completed) {\n    if (typeof nextOrObserver === 'function') {\n      return this.onTokenRefreshInternal(nextOrObserver, error, completed);\n    } else {\n      return this.onTokenRefreshInternal(nextOrObserver);\n    }\n  };\n  /**\r\n   * Given a registration, wait for the service worker it relates to\r\n   * become activer\r\n   * @param registration Registration to wait for service worker to become active\r\n   * @return Wait for service worker registration to become active\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  WindowController.prototype.waitForRegistrationToActivate_ = function (registration) {\n    var serviceWorker = registration.installing || registration.waiting || registration.active;\n    return new Promise(function (resolve, reject) {\n      if (!serviceWorker) {\n        // This is a rare scenario but has occured in firefox\n        reject(errorFactory.create(\"no-sw-in-reg\"\n        /* NO_SW_IN_REG */\n        ));\n        return;\n      } // Because the Promise function is called on next tick there is a\n      // small chance that the worker became active or redundant already.\n\n\n      if (serviceWorker.state === 'activated') {\n        resolve(registration);\n        return;\n      }\n\n      if (serviceWorker.state === 'redundant') {\n        reject(errorFactory.create(\"sw-reg-redundant\"\n        /* SW_REG_REDUNDANT */\n        ));\n        return;\n      }\n\n      var stateChangeListener = function stateChangeListener() {\n        if (serviceWorker.state === 'activated') {\n          resolve(registration);\n        } else if (serviceWorker.state === 'redundant') {\n          reject(errorFactory.create(\"sw-reg-redundant\"\n          /* SW_REG_REDUNDANT */\n          ));\n        } else {\n          // Return early and wait to next state change\n          return;\n        }\n\n        serviceWorker.removeEventListener('statechange', stateChangeListener);\n      };\n\n      serviceWorker.addEventListener('statechange', stateChangeListener);\n    });\n  };\n  /**\r\n   * This will register the default service worker and return the registration\r\n   * @return The service worker registration to be used for the push service.\r\n   */\n\n\n  WindowController.prototype.getSWRegistration_ = function () {\n    var _this = this;\n\n    if (this.registrationToUse) {\n      return this.waitForRegistrationToActivate_(this.registrationToUse);\n    } // Make the registration null so we know useServiceWorker will not\n    // use a new service worker as registrationToUse is no longer undefined\n\n\n    this.registrationToUse = null;\n    return navigator.serviceWorker.register(DEFAULT_SW_PATH, {\n      scope: DEFAULT_SW_SCOPE\n    })[\"catch\"](function (err) {\n      throw errorFactory.create(\"failed-serviceworker-registration\"\n      /* FAILED_DEFAULT_REGISTRATION */\n      , {\n        browserErrorMessage: err.message\n      });\n    }).then(function (registration) {\n      return _this.waitForRegistrationToActivate_(registration).then(function () {\n        _this.registrationToUse = registration; // We update after activation due to an issue with Firefox v49 where\n        // a race condition occassionally causes the service worker to not\n        // install\n        // eslint-disable-next-line @typescript-eslint/no-floating-promises\n\n        registration.update();\n        return registration;\n      });\n    });\n  };\n  /**\r\n   * This will return the default VAPID key or the uint8array version of the\r\n   * public VAPID key provided by the developer.\r\n   */\n\n\n  WindowController.prototype.getPublicVapidKey_ = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      return __generator(this, function (_a) {\n        if (this.publicVapidKeyToUse) {\n          return [2\n          /*return*/\n          , this.publicVapidKeyToUse];\n        }\n\n        return [2\n        /*return*/\n        , DEFAULT_PUBLIC_VAPID_KEY];\n      });\n    });\n  };\n  /**\r\n   * This method will set up a message listener to handle\r\n   * events from the service worker that should trigger\r\n   * events in the page.\r\n   */\n  // Visible for testing\n  // TODO: Make private\n\n\n  WindowController.prototype.setupSWMessageListener_ = function () {\n    var _this = this;\n\n    navigator.serviceWorker.addEventListener('message', function (event) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a, firebaseMessagingType, firebaseMessagingData, data, eventType, analytics;\n\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!event.data || !event.data.firebaseMessagingType || !event.data.firebaseMessagingData) {\n                // Not a message from FCM\n                return [2\n                /*return*/\n                ];\n              }\n\n              _a = event.data, firebaseMessagingType = _a.firebaseMessagingType, firebaseMessagingData = _a.firebaseMessagingData;\n\n              if (this.messageObserver) {\n                this.messageObserver.next(firebaseMessagingData);\n              }\n\n              data = firebaseMessagingData.data;\n              if (!(data && FN_CAMPAIGN_ID in data && data[FN_CAMPAIGN_ANALYTICS_ENABLED] === '1')) return [3\n              /*break*/\n              , 2];\n              eventType = getEventType(firebaseMessagingType);\n              return [4\n              /*yield*/\n              , this.services.analyticsProvider.get()];\n\n            case 1:\n              analytics = _b.sent();\n              analytics.logEvent(eventType,\n              /* eslint-disable camelcase */\n              {\n                message_name: data[FN_CAMPAIGN_NAME],\n                message_id: data[FN_CAMPAIGN_ID],\n                message_time: data[FN_CAMPAIGN_TIME],\n                message_device_time: Math.floor(Date.now() / 1000)\n              }\n              /* eslint-enable camelcase */\n              );\n              _b.label = 2;\n\n            case 2:\n              return [2\n              /*return*/\n              ];\n          }\n        });\n      });\n    }, false);\n  };\n\n  return WindowController;\n}(BaseController);\n\nfunction getEventType(messageType) {\n  switch (messageType) {\n    case MessageType.NOTIFICATION_CLICKED:\n      return 'notification_open';\n\n    case MessageType.PUSH_MSG_RECEIVED:\n      return 'notification_foreground';\n\n    default:\n      throw new Error();\n  }\n}\n\nvar name = \"@firebase/messaging\";\nvar version = \"0.6.0\";\n/**\r\n * @license\r\n * Copyright 2017 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nfunction registerMessaging(instance) {\n  var messagingName = 'messaging';\n\n  var factoryMethod = function factoryMethod(container) {\n    /* Dependencies */\n    var app = container.getProvider('app').getImmediate();\n    var installations = container.getProvider('installations').getImmediate();\n    var analyticsProvider = container.getProvider('analytics-internal');\n    var firebaseServices = {\n      app: app,\n      installations: installations,\n      analyticsProvider: analyticsProvider\n    };\n\n    if (!isSupported()) {\n      throw errorFactory.create(\"unsupported-browser\"\n      /* UNSUPPORTED_BROWSER */\n      );\n    }\n\n    if (self && 'ServiceWorkerGlobalScope' in self) {\n      // Running in ServiceWorker context\n      return new SwController(firebaseServices);\n    } else {\n      // Assume we are in the window context.\n      return new WindowController(firebaseServices);\n    }\n  };\n\n  var namespaceExports = {\n    isSupported: isSupported\n  };\n  instance.INTERNAL.registerComponent(new Component(messagingName, factoryMethod, \"PUBLIC\"\n  /* PUBLIC */\n  ).setServiceProps(namespaceExports));\n  instance.registerVersion(name, version);\n}\n\nregisterMessaging(firebase);\n\nfunction isSupported() {\n  if (self && 'ServiceWorkerGlobalScope' in self) {\n    // Running in ServiceWorker context\n    return isSWControllerSupported();\n  } else {\n    // Assume we are in the window context.\n    return isWindowControllerSupported();\n  }\n}\n/**\r\n * Checks to see if the required APIs exist.\r\n */\n\n\nfunction isWindowControllerSupported() {\n  return navigator.cookieEnabled && 'serviceWorker' in navigator && 'PushManager' in window && 'Notification' in window && 'fetch' in window && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n/**\r\n * Checks to see if the required APIs exist within SW Context.\r\n */\n\n\nfunction isSWControllerSupported() {\n  return 'PushManager' in self && 'Notification' in self && ServiceWorkerRegistration.prototype.hasOwnProperty('showNotification') && PushSubscription.prototype.hasOwnProperty('getKey');\n}\n\nexport { isSupported, registerMessaging };","import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __assign, __values } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar name = \"@firebase/installations\";\nvar version = \"0.3.8\";\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\"\n/* NOT_REGISTERED */\n] = 'Firebase Installation is not registered.', _a[\"installation-not-found\"\n/* INSTALLATION_NOT_FOUND */\n] = 'Firebase Installation not found.', _a[\"request-failed\"\n/* REQUEST_FAILED */\n] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\"\n/* APP_OFFLINE */\n] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\"\n/* DELETE_PENDING_REGISTRATION */\n] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\n\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\"\n  /* REQUEST_FAILED */\n  );\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\n\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2\n    /* COMPLETED */\n    ,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2\n          /*return*/\n          , ERROR_FACTORY.create(\"request-failed\"\n          /* REQUEST_FAILED */\n          , {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\n\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\n\n\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fn()];\n\n        case 1:\n          result = _a.sent();\n\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2\n            /*return*/\n            , fn()];\n          }\n\n          return [2\n          /*return*/\n          , result];\n      }\n    });\n  });\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2\n            /* COMPLETED */\n            ,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2\n          /*return*/\n          , registeredInstallationEntry];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Create Installation', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\n\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray); // Replace the first 4 random bits with the constant FID header of 0b0111.\n\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\n\n\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray); // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n\n  return b64String.substr(0, 22);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME)[\"delete\"](key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\n\n\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , store.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , store[\"delete\"](key)];\n\n        case 3:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          return [4\n          /*yield*/\n          , store.put(newValue, key)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 7:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , newValue];\n      }\n    });\n  });\n}\n\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\n\n\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3\n          /*break*/\n          , 3];\n          _a = {};\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2\n          /*return*/\n          , (_a.installationEntry = _b.sent(), _a)];\n\n        case 3:\n          return [2\n          /*return*/\n          , {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\n\n\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0\n    /* NOT_STARTED */\n\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\n\n\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0\n  /* NOT_STARTED */\n  ) {\n      if (!navigator.onLine) {\n        // Registration required but app is offline.\n        var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\"\n        /* APP_OFFLINE */\n        ));\n        return {\n          installationEntry: installationEntry,\n          registrationPromise: registrationPromiseWithError\n        };\n      } // Try registering. Change status to IN_PROGRESS.\n\n\n      var inProgressEntry = {\n        fid: installationEntry.fid,\n        registrationStatus: 1\n        /* IN_PROGRESS */\n        ,\n        registrationTime: Date.now()\n      };\n      var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n      return {\n        installationEntry: inProgressEntry,\n        registrationPromise: registrationPromise\n      };\n    } else if (installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  ) {\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: waitUntilFidRegistration(appConfig)\n      };\n    } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\n\n\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n\n          return [4\n          /*yield*/\n          , createInstallationRequest(appConfig, installationEntry)];\n\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2\n          /*return*/\n          , set(appConfig, registeredInstallationEntry)];\n\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3\n          /*break*/\n          , 4]; // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4\n          /*yield*/\n          , set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0\n            /* NOT_STARTED */\n\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          throw e_1;\n\n        case 7:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\n\n\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n\n        case 2:\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // createInstallation request still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 4:\n          entry = _b.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          if (!(entry.registrationStatus === 0\n          /* NOT_STARTED */\n          )) return [3\n            /*break*/\n            , 7];\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            return [2\n            /*return*/\n            , registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2\n            /*return*/\n            , installationEntry];\n          }\n\n        case 7:\n          return [2\n          /*return*/\n          , entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\"\n      /* INSTALLATION_NOT_FOUND */\n      );\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0\n      /* NOT_STARTED */\n\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n      platformLoggerProvider = _a.platformLoggerProvider;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2\n          /*return*/\n          , completedAuthToken];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Generate Auth Token', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\n\n\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\"\n              /* NOT_REGISTERED */\n              );\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1\n            /* IN_PROGRESS */\n            ) {\n                // There already is a token request in progress.\n                tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n                return oldEntry;\n              } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\"\n                /* APP_OFFLINE */\n                );\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , tokenPromise];\n\n        case 2:\n          _a = _b.sent();\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n\n        case 4:\n          authToken = _a;\n          return [2\n          /*return*/\n          , authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\n\n\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n\n        case 2:\n          if (!(entry.authToken.requestStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // generateAuthToken still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 4:\n          entry = _a.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          authToken = entry.authToken;\n\n          if (authToken.requestStatus === 0\n          /* NOT_STARTED */\n          ) {\n              // The request timed out or failed in a different call. Try again.\n              return [2\n              /*return*/\n              , refreshAuthToken(dependencies, forceRefresh)];\n            } else {\n            return [2\n            /*return*/\n            , authToken];\n          }\n\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\"\n      /* NOT_REGISTERED */\n      );\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0\n          /* NOT_STARTED */\n\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\n\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n\n          return [4\n          /*yield*/\n          , generateAuthTokenRequest(dependencies, installationEntry)];\n\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , authToken];\n\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3\n          /*break*/\n          , 5]; // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(dependencies.appConfig)];\n\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0\n              /* NOT_STARTED */\n\n            }\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 6:\n          _a.sent();\n\n          _a.label = 7;\n\n        case 7:\n          throw e_1;\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2\n  /* COMPLETED */\n  ;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2\n  /* COMPLETED */\n  && !isAuthTokenExpired(authToken);\n}\n\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\n\n\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1\n    /* IN_PROGRESS */\n    ,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1\n  /* IN_PROGRESS */\n  && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getId(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(dependencies.appConfig)];\n\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            registrationPromise[\"catch\"](console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies)[\"catch\"](console.error);\n          }\n\n          return [2\n          /*return*/\n          , installationEntry.fid];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , completeInstallationRegistration(dependencies.appConfig)];\n\n        case 1:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , refreshAuthToken(dependencies, forceRefresh)];\n\n        case 2:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , authToken.token];\n      }\n    });\n  });\n}\n\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3\n          /*break*/\n          , 3]; // A createInstallation request is in progress. Wait until it finishes.\n\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Delete Installation', response)];\n\n        case 2:\n          throw _a.sent();\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0\n            /* NOT_STARTED */\n            ) {\n                // Delete the unregistered entry without sending a deleteInstallation request.\n                return undefined;\n              }\n\n            return oldEntry;\n          })];\n\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3\n          /*break*/\n          , 6];\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 2]; // Can't delete while trying to register.\n\n          throw ERROR_FACTORY.create(\"delete-pending-registration\"\n          /* DELETE_PENDING_REGISTRATION */\n          );\n\n        case 2:\n          if (!(entry.registrationStatus === 2\n          /* COMPLETED */\n          )) return [3\n            /*break*/\n            , 6];\n          if (!!navigator.onLine) return [3\n          /*break*/\n          , 3];\n          throw ERROR_FACTORY.create(\"app-offline\"\n          /* APP_OFFLINE */\n          );\n\n        case 3:\n          return [4\n          /*yield*/\n          , deleteInstallationRequest(appConfig, entry)];\n\n        case 4:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1[\"return\"])) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate(); // Throws if app isn't configured properly.\n\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    return {\n      app: app,\n      getId: function getId() {\n        return _getId(dependencies);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(dependencies, forceRefresh);\n      },\n      \"delete\": function _delete() {\n        return deleteInstallation(dependencies);\n      }\n    };\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ));\n  instance.registerVersion(name, version);\n}\n\nregisterInstallations(firebase);\nexport { registerInstallations };","'use strict';\nvar toInteger = require('./_to-integer');\nvar defined = require('./_defined');\n\nmodule.exports = function repeat(count) {\n  var str = String(defined(this));\n  var res = '';\n  var n = toInteger(count);\n  if (n < 0 || n == Infinity) throw RangeError(\"Count can't be negative\");\n  for (;n > 0; (n >>>= 1) && (str += str)) if (n & 1) res += str;\n  return res;\n};\n","require(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.object.define-property\");\n\nrequire(\"core-js/modules/es6.array.for-each\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.idb = {}));\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']); // proxy 'next' methods\n\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']); // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  }); // polyfill getAll\n\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n\n          cursor[\"continue\"]();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});","'use strict';\n// B.2.3.10 String.prototype.link(url)\nrequire('./_string-html')('link', function (createHTML) {\n  return function link(url) {\n    return createHTML(this, 'a', 'href', url);\n  };\n});\n"],"sourceRoot":""}