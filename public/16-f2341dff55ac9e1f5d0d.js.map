{"version":3,"sources":["webpack:///./node_modules/@firebase/analytics/dist/index.esm.js","webpack:///./node_modules/@firebase/installations/dist/index.esm.js","webpack:///./node_modules/core-js/modules/es7.object.values.js","webpack:///./node_modules/idb/build/idb.js"],"names":["GtagCommand","EventName","ANALYTICS_ID_FIELD","GA_FID_KEY","ORIGIN_KEY","GTAG_URL","wrapOrCreateGtag","initializedIdPromisesMap","dataLayerName","gtagFunctionName","gtagCore","_args","_i","arguments","length","window","push","command","idOrNameOrParams","gtagParams","EVENT","initializationPromisesToWaitFor","gaSendToList","Array","isArray","gaSendToList_1","sendToId","initializationPromise","_a","_b","Object","values","idPromise","Promise","all","then","e","console","error","CONFIG","resolve","SET","wrapGtag","wrappedGtag","gtagCoreFunction","wrappedGtagFunction","ERRORS","ERROR_FACTORY","gtagName","globalInitDone","settings","options","create","factory","app","installations","analyticsId","id","scriptTags","document","getElementsByTagName","tag","src","includes","findGtagScriptOnPage","script","createElement","async","head","appendChild","insertScriptTag","dataLayer","getOrCreateDataLayer","this","fid","label","getId","sent","Date","update","initializeGAId","logEvent","eventName","eventParams","gtagFunction","params","global","_logEvent","setCurrentScreen","screenName","_setCurrentScreen","setUserId","_setUserId","setUserProperties","properties","flatProperties","keys","key","_setUserProperties","setAnalyticsCollectionEnabled","enabled","_setAnalyticsCollectionEnabled","instance","version","ANALYTICS_TYPE","INTERNAL","registerComponent","container","getProvider","getImmediate","setServiceProps","reason","registerVersion","name","PENDING_TIMEOUT_MS","PACKAGE_VERSION","INTERNAL_AUTH_VERSION","INSTALLATIONS_API_URL","TOKEN_EXPIRATION_BUFFER","ERROR_DESCRIPTION_MAP","isServerError","code","getInstallationsEndpoint","projectId","extractAuthTokenInfoFromResponse","response","token","requestStatus","expiresIn","responseExpiresIn","Number","replace","creationTime","now","getErrorFromResponse","requestName","responseJson","errorData","json","serverCode","serverMessage","message","serverStatus","status","getHeaders","apiKey","Headers","Accept","getHeadersWithAuth","appConfig","refreshToken","headers","append","getAuthorizationHeader","retryIfServerError","fn","result","createInstallationRequest","endpoint","body","request","responseValue","authVersion","appId","sdkVersion","method","JSON","stringify","fetch","ok","registrationStatus","authToken","sleep","ms","setTimeout","VALID_FID_PATTERN","INVALID_FID","generateFid","fidByteArray","Uint8Array","self","crypto","msCrypto","getRandomValues","array","btoa","String","fromCharCode","apply","substr","encode","test","DATABASE_NAME","DATABASE_VERSION","OBJECT_STORE_NAME","dbPromise","getDbPromise","upgradeDB","oldVersion","createObjectStore","set","value","db","tx","getKey","transaction","objectStore","put","complete","remove","updateFn","store","oldValue","newValue","get","undefined","appName","getInstallationEntry","registrationPromise","installationEntry","oldEntry","clearTimedOutRequest","updateOrCreateInstallationEntry","entryWithPromise","navigator","onLine","registrationPromiseWithError","reject","inProgressEntry","registrationTime","registeredInstallationEntry","e_1","trys","registerInstallation","waitUntilFidRegistration","triggerRegistrationIfNecessary","entry","updateInstallationRequest","generateAuthTokenRequest","platformLoggerProvider","platformLogger","getGenerateAuthTokenEndpoint","optional","getPlatformInfoString","installation","refreshAuthToken","dependencies","forceRefresh","tokenPromise","isEntryRegistered","oldAuthToken","isAuthTokenExpired","isAuthTokenValid","updateAuthTokenRequest","waitUntilAuthTokenRequest","inProgressAuthToken","requestTime","makeAuthTokenRequestInProgressEntry","updatedInstallationEntry","fetchAuthTokenFromServer","completeInstallationRegistration","deleteInstallationRequest","getDeleteEndpoint","getMissingValueError","valueName","registerInstallations","configKeys_1","configKeys_1_1","next","done","keyName","e_1_1","call","extractAppConfig","_getId","getToken","_getToken","deleteInstallation","$export","$values","S","it","exports","toArray","arr","prototype","slice","promisifyRequest","onsuccess","onerror","promisifyRequestCall","obj","args","p","promisifyCursorRequestCall","Cursor","proxyProperties","ProxyClass","targetProp","forEach","prop","defineProperty","val","proxyRequestMethods","Constructor","proxyMethods","proxyCursorRequestMethods","Index","index","_index","cursor","_cursor","_request","ObjectStore","_store","Transaction","idbTransaction","_tx","oncomplete","onabort","UpgradeDB","_db","DB","IDBIndex","IDBCursor","methodName","createIndex","IDBObjectStore","IDBTransaction","IDBDatabase","funcName","callback","nativeObject","getAll","query","count","items","iterateCursor","openDb","upgradeCallback","indexedDB","onupgradeneeded","event","deleteDb"],"mappings":"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","file":"16-f2341dff55ac9e1f5d0d.js","sourcesContent":["import \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.string.iterator\";\nimport \"core-js/modules/es7.object.values\";\nimport \"core-js/modules/es6.array.is-array\";\nimport \"core-js/modules/web.dom.iterable\";\nimport \"core-js/modules/es6.array.iterator\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.object.keys\";\nimport firebase from '@firebase/app';\nimport '@firebase/installations';\nimport { __assign, __awaiter, __generator } from 'tslib';\nimport { ErrorFactory } from '@firebase/util';\nimport { Component } from '@firebase/component';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar ANALYTICS_ID_FIELD = 'measurementId'; // Key to attach FID to in gtag params.\n\nvar GA_FID_KEY = 'firebase_id';\nvar ORIGIN_KEY = 'origin';\nvar GTAG_URL = 'https://www.googletagmanager.com/gtag/js';\nvar GtagCommand;\n\n(function (GtagCommand) {\n  GtagCommand[\"EVENT\"] = \"event\";\n  GtagCommand[\"SET\"] = \"set\";\n  GtagCommand[\"CONFIG\"] = \"config\";\n})(GtagCommand || (GtagCommand = {}));\n/*\r\n * Officially recommended event names for gtag.js\r\n * Any other string is also allowed.\r\n */\n\n\nvar EventName;\n\n(function (EventName) {\n  EventName[\"ADD_PAYMENT_INFO\"] = \"add_payment_info\";\n  EventName[\"ADD_TO_CART\"] = \"add_to_cart\";\n  EventName[\"ADD_TO_WISHLIST\"] = \"add_to_wishlist\";\n  EventName[\"BEGIN_CHECKOUT\"] = \"begin_checkout\";\n  EventName[\"CHECKOUT_PROGRESS\"] = \"checkout_progress\";\n  EventName[\"EXCEPTION\"] = \"exception\";\n  EventName[\"GENERATE_LEAD\"] = \"generate_lead\";\n  EventName[\"LOGIN\"] = \"login\";\n  EventName[\"PAGE_VIEW\"] = \"page_view\";\n  EventName[\"PURCHASE\"] = \"purchase\";\n  EventName[\"REFUND\"] = \"refund\";\n  EventName[\"REMOVE_FROM_CART\"] = \"remove_from_cart\";\n  EventName[\"SCREEN_VIEW\"] = \"screen_view\";\n  EventName[\"SEARCH\"] = \"search\";\n  EventName[\"SELECT_CONTENT\"] = \"select_content\";\n  EventName[\"SET_CHECKOUT_OPTION\"] = \"set_checkout_option\";\n  EventName[\"SHARE\"] = \"share\";\n  EventName[\"SIGN_UP\"] = \"sign_up\";\n  EventName[\"TIMING_COMPLETE\"] = \"timing_complete\";\n  EventName[\"VIEW_ITEM\"] = \"view_item\";\n  EventName[\"VIEW_ITEM_LIST\"] = \"view_item_list\";\n  EventName[\"VIEW_PROMOTION\"] = \"view_promotion\";\n  EventName[\"VIEW_SEARCH_RESULTS\"] = \"view_search_results\";\n})(EventName || (EventName = {}));\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Logs an analytics event through the Firebase SDK.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param eventName Google Analytics event name, choose from standard list or use a custom string.\r\n * @param eventParams Analytics event parameters.\r\n */\n\n\nfunction _logEvent(gtagFunction, analyticsId, eventName, eventParams, options) {\n  var params = eventParams || {};\n\n  if (!options || !options.global) {\n    params = __assign(__assign({}, eventParams), {\n      'send_to': analyticsId\n    });\n  } // Workaround for http://b/141370449 - third argument cannot be undefined.\n\n\n  gtagFunction(GtagCommand.EVENT, eventName, params || {});\n} // TODO: Brad is going to add `screen_name` to GA Gold config parameter schema\n\n/**\r\n * Set screen_name parameter for this Google Analytics ID.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param screenName Screen name string to set.\r\n */\n\n\nfunction _setCurrentScreen(gtagFunction, analyticsId, screenName, options) {\n  if (options && options.global) {\n    gtagFunction(GtagCommand.SET, {\n      'screen_name': screenName\n    });\n  } else {\n    gtagFunction(GtagCommand.CONFIG, analyticsId, {\n      update: true,\n      'screen_name': screenName\n    });\n  }\n}\n/**\r\n * Set user_id parameter for this Google Analytics ID.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param id User ID string to set\r\n */\n\n\nfunction _setUserId(gtagFunction, analyticsId, id, options) {\n  if (options && options.global) {\n    gtagFunction(GtagCommand.SET, {\n      'user_id': id\n    });\n  } else {\n    gtagFunction(GtagCommand.CONFIG, analyticsId, {\n      update: true,\n      'user_id': id\n    });\n  }\n}\n/**\r\n * Set all other user properties other than user_id and screen_name.\r\n *\r\n * @param gtagFunction Wrapped gtag function that waits for fid to be set before sending an event\r\n * @param properties Map of user properties to set\r\n */\n\n\nfunction _setUserProperties(gtagFunction, analyticsId, properties, options) {\n  if (options && options.global) {\n    var flatProperties = {};\n\n    for (var _i = 0, _a = Object.keys(properties); _i < _a.length; _i++) {\n      var key = _a[_i]; // use dot notation for merge behavior in gtag.js\n\n      flatProperties[\"user_properties.\" + key] = properties[key];\n    }\n\n    gtagFunction(GtagCommand.SET, flatProperties);\n  } else {\n    gtagFunction(GtagCommand.CONFIG, analyticsId, {\n      update: true,\n      'user_properties': properties\n    });\n  }\n}\n/**\r\n * Set whether collection is enabled for this ID.\r\n *\r\n * @param enabled If true, collection is enabled for this ID.\r\n */\n\n\nfunction _setAnalyticsCollectionEnabled(analyticsId, enabled) {\n  window[\"ga-disable-\" + analyticsId] = !enabled;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Initialize the analytics instance in gtag.js by calling config command with fid.\r\n *\r\n * NOTE: We combine analytics initialization and setting fid together because we want fid to be\r\n * part of the `page_view` event that's sent during the initialization\r\n * @param app Firebase app\r\n * @param gtagCore The gtag function that's not wrapped.\r\n */\n\n\nfunction initializeGAId(app, installations, gtagCore) {\n  return __awaiter(this, void 0, void 0, function () {\n    var fid;\n\n    var _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , installations.getId()];\n\n        case 1:\n          fid = _b.sent(); // This command initializes gtag.js and only needs to be called once for the entire web app,\n          // but since it is idempotent, we can call it multiple times.\n          // We keep it together with other initialization logic for better code structure.\n          // eslint-disable-next-line @typescript-eslint/no-explicit-any\n\n          gtagCore('js', new Date()); // It should be the first config command called on this GA-ID\n          // Initialize this GA-ID and set FID on it using the gtag config API.\n\n          gtagCore(GtagCommand.CONFIG, app.options[ANALYTICS_ID_FIELD], (_a = {}, _a[GA_FID_KEY] = fid, // guard against developers accidentally setting properties with prefix `firebase_`\n          _a[ORIGIN_KEY] = 'firebase', _a.update = true, _a));\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction insertScriptTag(dataLayerName) {\n  var script = document.createElement('script'); // We are not providing an analyticsId in the URL because it would trigger a `page_view`\n  // without fid. We will initialize ga-id using gtag (config) command together with fid.\n\n  script.src = GTAG_URL + \"?l=\" + dataLayerName;\n  script.async = true;\n  document.head.appendChild(script);\n}\n/** Get reference to, or create, global datalayer.\r\n * @param dataLayerName Name of datalayer (most often the default, \"_dataLayer\")\r\n */\n\n\nfunction getOrCreateDataLayer(dataLayerName) {\n  // Check for existing dataLayer and create if needed.\n  var dataLayer = [];\n\n  if (Array.isArray(window[dataLayerName])) {\n    dataLayer = window[dataLayerName];\n  } else {\n    window[dataLayerName] = dataLayer;\n  }\n\n  return dataLayer;\n}\n/**\r\n * Wraps a standard gtag function with extra code to wait for completion of\r\n * relevant initialization promises before sending requests.\r\n *\r\n * @param gtagCore Basic gtag function that just appends to dataLayer\r\n * @param initializedIdPromisesMap Map of gaIds to their initialization promises\r\n */\n\n\nfunction wrapGtag(gtagCore, initializedIdPromisesMap) {\n  return function (command, idOrNameOrParams, gtagParams) {\n    // If event, check that relevant initialization promises have completed.\n    if (command === GtagCommand.EVENT) {\n      var initializationPromisesToWaitFor = []; // If there's a 'send_to' param, check if any ID specified matches\n      // a FID we have begun a fetch on.\n\n      if (gtagParams && gtagParams['send_to']) {\n        var gaSendToList = gtagParams['send_to']; // Make it an array if is isn't, so it can be dealt with the same way.\n\n        if (!Array.isArray(gaSendToList)) {\n          gaSendToList = [gaSendToList];\n        }\n\n        for (var _i = 0, gaSendToList_1 = gaSendToList; _i < gaSendToList_1.length; _i++) {\n          var sendToId = gaSendToList_1[_i];\n          var initializationPromise = initializedIdPromisesMap[sendToId]; // Groups will not be in the map.\n\n          if (initializationPromise) {\n            initializationPromisesToWaitFor.push(initializationPromise);\n          } else {\n            // There is an item in 'send_to' that is not associated\n            // directly with an FID, possibly a group.  Empty this array\n            // and let it get populated below.\n            initializationPromisesToWaitFor = [];\n            break;\n          }\n        }\n      } // This will be unpopulated if there was no 'send_to' field , or\n      // if not all entries in the 'send_to' field could be mapped to\n      // a FID. In these cases, wait on all pending initialization promises.\n\n\n      if (initializationPromisesToWaitFor.length === 0) {\n        for (var _a = 0, _b = Object.values(initializedIdPromisesMap); _a < _b.length; _a++) {\n          var idPromise = _b[_a];\n          initializationPromisesToWaitFor.push(idPromise);\n        }\n      } // Run core gtag function with args after all relevant initialization\n      // promises have been resolved.\n\n\n      Promise.all(initializationPromisesToWaitFor) // Workaround for http://b/141370449 - third argument cannot be undefined.\n      .then(function () {\n        return gtagCore(GtagCommand.EVENT, idOrNameOrParams, gtagParams || {});\n      })[\"catch\"](function (e) {\n        return console.error(e);\n      });\n    } else if (command === GtagCommand.CONFIG) {\n      var initializationPromiseToWait = initializedIdPromisesMap[idOrNameOrParams] || Promise.resolve();\n      initializationPromiseToWait.then(function () {\n        gtagCore(GtagCommand.CONFIG, idOrNameOrParams, gtagParams);\n      })[\"catch\"](function (e) {\n        return console.error(e);\n      });\n    } else {\n      // SET command.\n      // Splitting calls for CONFIG and SET to make it clear which signature\n      // Typescript is checking.\n      gtagCore(GtagCommand.SET, idOrNameOrParams);\n    }\n  };\n}\n/**\r\n * Creates global gtag function or wraps existing one if found.\r\n * This wrapped function attaches Firebase instance ID (FID) to gtag 'config' and\r\n * 'event' calls that belong to the GAID associated with this Firebase instance.\r\n *\r\n * @param initializedIdPromisesMap Map of gaId to initialization promises.\r\n * @param dataLayerName Name of global GA datalayer array.\r\n * @param gtagFunctionName Name of global gtag function (\"gtag\" if not user-specified)\r\n */\n\n\nfunction wrapOrCreateGtag(initializedIdPromisesMap, dataLayerName, gtagFunctionName) {\n  // Create a basic core gtag function\n  var gtagCore = function gtagCore() {\n    var _args = [];\n\n    for (var _i = 0; _i < arguments.length; _i++) {\n      _args[_i] = arguments[_i];\n    } // Must push IArguments object, not an array.\n\n\n    window[dataLayerName].push(arguments);\n  }; // Replace it with existing one if found\n\n\n  if (window[gtagFunctionName] && typeof window[gtagFunctionName] === 'function') {\n    // @ts-ignore\n    gtagCore = window[gtagFunctionName];\n  }\n\n  window[gtagFunctionName] = wrapGtag(gtagCore, initializedIdPromisesMap);\n  return {\n    gtagCore: gtagCore,\n    wrappedGtag: window[gtagFunctionName]\n  };\n}\n/**\r\n * Returns first script tag in DOM matching our gtag url pattern.\r\n */\n\n\nfunction findGtagScriptOnPage() {\n  var scriptTags = window.document.getElementsByTagName('script');\n\n  for (var _i = 0, _a = Object.values(scriptTags); _i < _a.length; _i++) {\n    var tag = _a[_i];\n\n    if (tag.src && tag.src.includes(GTAG_URL)) {\n      return tag;\n    }\n  }\n\n  return null;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar _a;\n\nvar ERRORS = (_a = {}, _a[\"no-ga-id\"\n/* NO_GA_ID */\n] = \"\\\"\" + ANALYTICS_ID_FIELD + \"\\\" field is empty in \" + 'Firebase config. Firebase Analytics ' + 'requires this field to contain a valid measurement ID.', _a[\"already-exists\"\n/* ALREADY_EXISTS */\n] = 'A Firebase Analytics instance with the measurement ID ${id} ' + ' already exists. ' + 'Only one Firebase Analytics instance can be created for each measurement ID.', _a[\"already-initialized\"\n/* ALREADY_INITIALIZED */\n] = 'Firebase Analytics has already been initialized.' + 'settings() must be called before initializing any Analytics instance' + 'or it will have no effect.', _a[\"interop-component-reg-failed\"\n/* INTEROP_COMPONENT_REG_FAILED */\n] = 'Firebase Analytics Interop Component failed to instantiate', _a);\nvar ERROR_FACTORY = new ErrorFactory('analytics', 'Analytics', ERRORS);\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Maps gaId to FID fetch promises.\r\n */\n\nvar initializedIdPromisesMap = {};\n/**\r\n * Name for window global data layer array used by GA: defaults to 'dataLayer'.\r\n */\n\nvar dataLayerName = 'dataLayer';\n/**\r\n * Name for window global gtag function used by GA: defaults to 'gtag'.\r\n */\n\nvar gtagName = 'gtag';\n/**\r\n * Reproduction of standard gtag function or reference to existing\r\n * gtag function on window object.\r\n */\n\nvar gtagCoreFunction;\n/**\r\n * Wrapper around gtag function that ensures FID is sent with all\r\n * relevant event and config calls.\r\n */\n\nvar wrappedGtagFunction;\n/**\r\n * Flag to ensure page initialization steps (creation or wrapping of\r\n * dataLayer and gtag script) are only run once per page load.\r\n */\n\nvar globalInitDone = false;\n/**\r\n * For testing\r\n */\n\nfunction resetGlobalVars(newGlobalInitDone, newGaInitializedPromise) {\n  if (newGlobalInitDone === void 0) {\n    newGlobalInitDone = false;\n  }\n\n  if (newGaInitializedPromise === void 0) {\n    newGaInitializedPromise = {};\n  }\n\n  globalInitDone = newGlobalInitDone;\n  initializedIdPromisesMap = newGaInitializedPromise;\n  dataLayerName = 'dataLayer';\n  gtagName = 'gtag';\n}\n/**\r\n * This must be run before calling firebase.analytics() or it won't\r\n * have any effect.\r\n * @param options Custom gtag and dataLayer names.\r\n */\n\n\nfunction settings(options) {\n  if (globalInitDone) {\n    throw ERROR_FACTORY.create(\"already-initialized\"\n    /* ALREADY_INITIALIZED */\n    );\n  }\n\n  if (options.dataLayerName) {\n    dataLayerName = options.dataLayerName;\n  }\n\n  if (options.gtagName) {\n    gtagName = options.gtagName;\n  }\n}\n\nfunction factory(app, installations) {\n  var analyticsId = app.options[ANALYTICS_ID_FIELD];\n\n  if (!analyticsId) {\n    throw ERROR_FACTORY.create(\"no-ga-id\"\n    /* NO_GA_ID */\n    );\n  }\n\n  if (initializedIdPromisesMap[analyticsId] != null) {\n    throw ERROR_FACTORY.create(\"already-exists\"\n    /* ALREADY_EXISTS */\n    , {\n      id: analyticsId\n    });\n  }\n\n  if (!globalInitDone) {\n    // Steps here should only be done once per page: creation or wrapping\n    // of dataLayer and global gtag function.\n    // Detect if user has already put the gtag <script> tag on this page.\n    if (!findGtagScriptOnPage()) {\n      insertScriptTag(dataLayerName);\n    }\n\n    getOrCreateDataLayer(dataLayerName);\n\n    var _a = wrapOrCreateGtag(initializedIdPromisesMap, dataLayerName, gtagName),\n        wrappedGtag = _a.wrappedGtag,\n        gtagCore = _a.gtagCore;\n\n    wrappedGtagFunction = wrappedGtag;\n    gtagCoreFunction = gtagCore;\n    globalInitDone = true;\n  } // Async but non-blocking.\n\n\n  initializedIdPromisesMap[analyticsId] = initializeGAId(app, installations, gtagCoreFunction);\n  var analyticsInstance = {\n    app: app,\n    logEvent: function logEvent(eventName, eventParams, options) {\n      return _logEvent(wrappedGtagFunction, analyticsId, eventName, eventParams, options);\n    },\n    setCurrentScreen: function setCurrentScreen(screenName, options) {\n      return _setCurrentScreen(wrappedGtagFunction, analyticsId, screenName, options);\n    },\n    setUserId: function setUserId(id, options) {\n      return _setUserId(wrappedGtagFunction, analyticsId, id, options);\n    },\n    setUserProperties: function setUserProperties(properties, options) {\n      return _setUserProperties(wrappedGtagFunction, analyticsId, properties, options);\n    },\n    setAnalyticsCollectionEnabled: function setAnalyticsCollectionEnabled(enabled) {\n      return _setAnalyticsCollectionEnabled(analyticsId, enabled);\n    }\n  };\n  return analyticsInstance;\n}\n\nvar name = \"@firebase/analytics\";\nvar version = \"0.2.9\";\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Type constant for Firebase Analytics.\r\n */\n\nvar ANALYTICS_TYPE = 'analytics';\n\nfunction registerAnalytics(instance) {\n  instance.INTERNAL.registerComponent(new Component(ANALYTICS_TYPE, function (container) {\n    // getImmediate for FirebaseApp will always succeed\n    var app = container.getProvider('app').getImmediate();\n    var installations = container.getProvider('installations').getImmediate();\n    return factory(app, installations);\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ).setServiceProps({\n    settings: settings,\n    EventName: EventName\n  }));\n  instance.INTERNAL.registerComponent(new Component('analytics-internal', internalFactory, \"PRIVATE\"\n  /* PRIVATE */\n  ));\n  instance.registerVersion(name, version);\n\n  function internalFactory(container) {\n    try {\n      var analytics = container.getProvider(ANALYTICS_TYPE).getImmediate();\n      return {\n        logEvent: analytics.logEvent\n      };\n    } catch (e) {\n      throw ERROR_FACTORY.create(\"interop-component-reg-failed\"\n      /* INTEROP_COMPONENT_REG_FAILED */\n      , {\n        reason: e\n      });\n    }\n  }\n}\n\nregisterAnalytics(firebase);\nexport { factory, registerAnalytics, resetGlobalVars, settings };","import \"core-js/modules/es6.function.name\";\nimport \"core-js/modules/es6.typed.uint8-array\";\nimport \"core-js/modules/es6.promise\";\nimport \"core-js/modules/es6.object.to-string\";\nimport \"core-js/modules/es6.regexp.replace\";\nimport \"core-js/modules/es6.number.constructor\";\nimport \"core-js/modules/es6.date.now\";\nimport \"core-js/modules/es7.array.includes\";\nimport \"core-js/modules/es6.string.includes\";\nimport firebase from '@firebase/app';\nimport { Component } from '@firebase/component';\nimport { __awaiter, __generator, __spread, __assign, __values } from 'tslib';\nimport { ErrorFactory, FirebaseError } from '@firebase/util';\nimport { openDb } from 'idb';\nvar name = \"@firebase/installations\";\nvar version = \"0.3.8\";\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar PENDING_TIMEOUT_MS = 10000;\nvar PACKAGE_VERSION = \"w:\" + version;\nvar INTERNAL_AUTH_VERSION = 'FIS_v2';\nvar INSTALLATIONS_API_URL = 'https://firebaseinstallations.googleapis.com/v1';\nvar TOKEN_EXPIRATION_BUFFER = 60 * 60 * 1000; // One hour\n\nvar SERVICE = 'installations';\nvar SERVICE_NAME = 'Installations';\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\nvar _a;\n\nvar ERROR_DESCRIPTION_MAP = (_a = {}, _a[\"missing-app-config-values\"\n/* MISSING_APP_CONFIG_VALUES */\n] = 'Missing App configuration value: \"{$valueName}\"', _a[\"not-registered\"\n/* NOT_REGISTERED */\n] = 'Firebase Installation is not registered.', _a[\"installation-not-found\"\n/* INSTALLATION_NOT_FOUND */\n] = 'Firebase Installation not found.', _a[\"request-failed\"\n/* REQUEST_FAILED */\n] = '{$requestName} request failed with error \"{$serverCode} {$serverStatus}: {$serverMessage}\"', _a[\"app-offline\"\n/* APP_OFFLINE */\n] = 'Could not process request. Application offline.', _a[\"delete-pending-registration\"\n/* DELETE_PENDING_REGISTRATION */\n] = \"Can't delete installation while there is a pending registration request.\", _a);\nvar ERROR_FACTORY = new ErrorFactory(SERVICE, SERVICE_NAME, ERROR_DESCRIPTION_MAP);\n/** Returns true if error is a FirebaseError that is based on an error from the server. */\n\nfunction isServerError(error) {\n  return error instanceof FirebaseError && error.code.includes(\"request-failed\"\n  /* REQUEST_FAILED */\n  );\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction getInstallationsEndpoint(_a) {\n  var projectId = _a.projectId;\n  return INSTALLATIONS_API_URL + \"/projects/\" + projectId + \"/installations\";\n}\n\nfunction extractAuthTokenInfoFromResponse(response) {\n  return {\n    token: response.token,\n    requestStatus: 2\n    /* COMPLETED */\n    ,\n    expiresIn: getExpiresInFromResponseExpiresIn(response.expiresIn),\n    creationTime: Date.now()\n  };\n}\n\nfunction getErrorFromResponse(requestName, response) {\n  return __awaiter(this, void 0, void 0, function () {\n    var responseJson, errorData;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 1:\n          responseJson = _a.sent();\n          errorData = responseJson.error;\n          return [2\n          /*return*/\n          , ERROR_FACTORY.create(\"request-failed\"\n          /* REQUEST_FAILED */\n          , {\n            requestName: requestName,\n            serverCode: errorData.code,\n            serverMessage: errorData.message,\n            serverStatus: errorData.status\n          })];\n      }\n    });\n  });\n}\n\nfunction getHeaders(_a) {\n  var apiKey = _a.apiKey;\n  return new Headers({\n    'Content-Type': 'application/json',\n    Accept: 'application/json',\n    'x-goog-api-key': apiKey\n  });\n}\n\nfunction getHeadersWithAuth(appConfig, _a) {\n  var refreshToken = _a.refreshToken;\n  var headers = getHeaders(appConfig);\n  headers.append('Authorization', getAuthorizationHeader(refreshToken));\n  return headers;\n}\n/**\r\n * Calls the passed in fetch wrapper and returns the response.\r\n * If the returned response has a status of 5xx, re-runs the function once and\r\n * returns the response.\r\n */\n\n\nfunction retryIfServerError(fn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var result;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , fn()];\n\n        case 1:\n          result = _a.sent();\n\n          if (result.status >= 500 && result.status < 600) {\n            // Internal Server Error. Retry request.\n            return [2\n            /*return*/\n            , fn()];\n          }\n\n          return [2\n          /*return*/\n          , result];\n      }\n    });\n  });\n}\n\nfunction getExpiresInFromResponseExpiresIn(responseExpiresIn) {\n  // This works because the server will never respond with fractions of a second.\n  return Number(responseExpiresIn.replace('s', '000'));\n}\n\nfunction getAuthorizationHeader(refreshToken) {\n  return INTERNAL_AUTH_VERSION + \" \" + refreshToken;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction createInstallationRequest(appConfig, _a) {\n  var fid = _a.fid;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, body, request, response, responseValue, registeredInstallationEntry;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getInstallationsEndpoint(appConfig);\n          headers = getHeaders(appConfig);\n          body = {\n            fid: fid,\n            authVersion: INTERNAL_AUTH_VERSION,\n            appId: appConfig.appId,\n            sdkVersion: PACKAGE_VERSION\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          registeredInstallationEntry = {\n            fid: responseValue.fid || fid,\n            registrationStatus: 2\n            /* COMPLETED */\n            ,\n            refreshToken: responseValue.refreshToken,\n            authToken: extractAuthTokenInfoFromResponse(responseValue.authToken)\n          };\n          return [2\n          /*return*/\n          , registeredInstallationEntry];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Create Installation', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/** Returns a promise that resolves after given time passes. */\n\n\nfunction sleep(ms) {\n  return new Promise(function (resolve) {\n    setTimeout(resolve, ms);\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction bufferToBase64UrlSafe(array) {\n  var b64 = btoa(String.fromCharCode.apply(String, __spread(array)));\n  return b64.replace(/\\+/g, '-').replace(/\\//g, '_');\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar VALID_FID_PATTERN = /^[cdef][\\w-]{21}$/;\nvar INVALID_FID = '';\n/**\r\n * Generates a new FID using random values from Web Crypto API.\r\n * Returns an empty string if FID generation fails for any reason.\r\n */\n\nfunction generateFid() {\n  try {\n    // A valid FID has exactly 22 base64 characters, which is 132 bits, or 16.5\n    // bytes. our implementation generates a 17 byte array instead.\n    var fidByteArray = new Uint8Array(17);\n    var crypto_1 = self.crypto || self.msCrypto;\n    crypto_1.getRandomValues(fidByteArray); // Replace the first 4 random bits with the constant FID header of 0b0111.\n\n    fidByteArray[0] = 112 + fidByteArray[0] % 16;\n    var fid = encode(fidByteArray);\n    return VALID_FID_PATTERN.test(fid) ? fid : INVALID_FID;\n  } catch (_a) {\n    // FID generation errored\n    return INVALID_FID;\n  }\n}\n/** Converts a FID Uint8Array to a base64 string representation. */\n\n\nfunction encode(fidByteArray) {\n  var b64String = bufferToBase64UrlSafe(fidByteArray); // Remove the 23rd character that was added because of the extra 4 bits at the\n  // end of our 17 byte array, and the '=' padding.\n\n  return b64String.substr(0, 22);\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nvar DATABASE_NAME = 'firebase-installations-database';\nvar DATABASE_VERSION = 1;\nvar OBJECT_STORE_NAME = 'firebase-installations-store';\nvar dbPromise = null;\n\nfunction getDbPromise() {\n  if (!dbPromise) {\n    dbPromise = openDb(DATABASE_NAME, DATABASE_VERSION, function (upgradeDB) {\n      // We don't use 'break' in this switch statement, the fall-through\n      // behavior is what we want, because if there are multiple versions between\n      // the old version and the current version, we want ALL the migrations\n      // that correspond to those versions to run, not only the last one.\n      // eslint-disable-next-line default-case\n      switch (upgradeDB.oldVersion) {\n        case 0:\n          upgradeDB.createObjectStore(OBJECT_STORE_NAME);\n      }\n    });\n  }\n\n  return dbPromise;\n}\n/** Assigns or overwrites the record for the given key with the given value. */\n\n\nfunction set(appConfig, value) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME).put(value, key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , value];\n      }\n    });\n  });\n}\n/** Removes record(s) from the objectStore that match the given key. */\n\n\nfunction remove(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          return [4\n          /*yield*/\n          , tx.objectStore(OBJECT_STORE_NAME)[\"delete\"](key)];\n\n        case 2:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 3:\n          _a.sent();\n\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * Atomically updates a record with the result of updateFn, which gets\r\n * called with the current value. If newValue is undefined, the record is\r\n * deleted instead.\r\n * @return Updated value\r\n */\n\n\nfunction update(appConfig, updateFn) {\n  return __awaiter(this, void 0, void 0, function () {\n    var key, db, tx, store, oldValue, newValue;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          key = getKey(appConfig);\n          return [4\n          /*yield*/\n          , getDbPromise()];\n\n        case 1:\n          db = _a.sent();\n          tx = db.transaction(OBJECT_STORE_NAME, 'readwrite');\n          store = tx.objectStore(OBJECT_STORE_NAME);\n          return [4\n          /*yield*/\n          , store.get(key)];\n\n        case 2:\n          oldValue = _a.sent();\n          newValue = updateFn(oldValue);\n          if (!(newValue === undefined)) return [3\n          /*break*/\n          , 4];\n          return [4\n          /*yield*/\n          , store[\"delete\"](key)];\n\n        case 3:\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          return [4\n          /*yield*/\n          , store.put(newValue, key)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [4\n          /*yield*/\n          , tx.complete];\n\n        case 7:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , newValue];\n      }\n    });\n  });\n}\n\nfunction getKey(appConfig) {\n  return appConfig.appName + \"!\" + appConfig.appId;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Updates and returns the InstallationEntry from the database.\r\n * Also triggers a registration request if it is necessary and possible.\r\n */\n\n\nfunction getInstallationEntry(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise, installationEntry, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            var installationEntry = updateOrCreateInstallationEntry(oldEntry);\n            var entryWithPromise = triggerRegistrationIfNecessary(appConfig, installationEntry);\n            registrationPromise = entryWithPromise.registrationPromise;\n            return entryWithPromise.installationEntry;\n          })];\n\n        case 1:\n          installationEntry = _b.sent();\n          if (!(installationEntry.fid === INVALID_FID)) return [3\n          /*break*/\n          , 3];\n          _a = {};\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // FID generation failed. Waiting for the FID from the server.\n          return [2\n          /*return*/\n          , (_a.installationEntry = _b.sent(), _a)];\n\n        case 3:\n          return [2\n          /*return*/\n          , {\n            installationEntry: installationEntry,\n            registrationPromise: registrationPromise\n          }];\n      }\n    });\n  });\n}\n/**\r\n * Creates a new Installation Entry if one does not exist.\r\n * Also clears timed out pending requests.\r\n */\n\n\nfunction updateOrCreateInstallationEntry(oldEntry) {\n  var entry = oldEntry || {\n    fid: generateFid(),\n    registrationStatus: 0\n    /* NOT_STARTED */\n\n  };\n  return clearTimedOutRequest(entry);\n}\n/**\r\n * If the Firebase Installation is not registered yet, this will trigger the\r\n * registration and return an InProgressInstallationEntry.\r\n *\r\n * If registrationPromise does not exist, the installationEntry is guaranteed\r\n * to be registered.\r\n */\n\n\nfunction triggerRegistrationIfNecessary(appConfig, installationEntry) {\n  if (installationEntry.registrationStatus === 0\n  /* NOT_STARTED */\n  ) {\n      if (!navigator.onLine) {\n        // Registration required but app is offline.\n        var registrationPromiseWithError = Promise.reject(ERROR_FACTORY.create(\"app-offline\"\n        /* APP_OFFLINE */\n        ));\n        return {\n          installationEntry: installationEntry,\n          registrationPromise: registrationPromiseWithError\n        };\n      } // Try registering. Change status to IN_PROGRESS.\n\n\n      var inProgressEntry = {\n        fid: installationEntry.fid,\n        registrationStatus: 1\n        /* IN_PROGRESS */\n        ,\n        registrationTime: Date.now()\n      };\n      var registrationPromise = registerInstallation(appConfig, inProgressEntry);\n      return {\n        installationEntry: inProgressEntry,\n        registrationPromise: registrationPromise\n      };\n    } else if (installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  ) {\n      return {\n        installationEntry: installationEntry,\n        registrationPromise: waitUntilFidRegistration(appConfig)\n      };\n    } else {\n    return {\n      installationEntry: installationEntry\n    };\n  }\n}\n/** This will be executed only once for each new Firebase Installation. */\n\n\nfunction registerInstallation(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registeredInstallationEntry, e_1;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 2,, 7]);\n\n          return [4\n          /*yield*/\n          , createInstallationRequest(appConfig, installationEntry)];\n\n        case 1:\n          registeredInstallationEntry = _a.sent();\n          return [2\n          /*return*/\n          , set(appConfig, registeredInstallationEntry)];\n\n        case 2:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && e_1.serverCode === 409)) return [3\n          /*break*/\n          , 4]; // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 3:\n          // Server returned a \"FID can not be used\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 6];\n\n        case 4:\n          // Registration failed. Set FID as not registered.\n          return [4\n          /*yield*/\n          , set(appConfig, {\n            fid: installationEntry.fid,\n            registrationStatus: 0\n            /* NOT_STARTED */\n\n          })];\n\n        case 5:\n          // Registration failed. Set FID as not registered.\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          throw e_1;\n\n        case 7:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/** Call if FID registration is pending in another request. */\n\n\nfunction waitUntilFidRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 1:\n          entry = _b.sent();\n          _b.label = 2;\n\n        case 2:\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // createInstallation request still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // createInstallation request still in progress.\n          _b.sent();\n\n          return [4\n          /*yield*/\n          , updateInstallationRequest(appConfig)];\n\n        case 4:\n          entry = _b.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          if (!(entry.registrationStatus === 0\n          /* NOT_STARTED */\n          )) return [3\n            /*break*/\n            , 7];\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 6:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            return [2\n            /*return*/\n            , registrationPromise];\n          } else {\n            // if there is no registrationPromise, entry is registered.\n            return [2\n            /*return*/\n            , installationEntry];\n          }\n\n        case 7:\n          return [2\n          /*return*/\n          , entry];\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a CreateInstallation request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * CreateInstallation request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateInstallationRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!oldEntry) {\n      throw ERROR_FACTORY.create(\"installation-not-found\"\n      /* INSTALLATION_NOT_FOUND */\n      );\n    }\n\n    return clearTimedOutRequest(oldEntry);\n  });\n}\n\nfunction clearTimedOutRequest(entry) {\n  if (hasInstallationRequestTimedOut(entry)) {\n    return {\n      fid: entry.fid,\n      registrationStatus: 0\n      /* NOT_STARTED */\n\n    };\n  }\n\n  return entry;\n}\n\nfunction hasInstallationRequestTimedOut(installationEntry) {\n  return installationEntry.registrationStatus === 1\n  /* IN_PROGRESS */\n  && installationEntry.registrationTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction generateAuthTokenRequest(_a, installationEntry) {\n  var appConfig = _a.appConfig,\n      platformLoggerProvider = _a.platformLoggerProvider;\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, platformLogger, body, request, response, responseValue, completedAuthToken;\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          endpoint = getGenerateAuthTokenEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          platformLogger = platformLoggerProvider.getImmediate({\n            optional: true\n          });\n\n          if (platformLogger) {\n            headers.append('x-firebase-client', platformLogger.getPlatformInfoString());\n          }\n\n          body = {\n            installation: {\n              sdkVersion: PACKAGE_VERSION\n            }\n          };\n          request = {\n            method: 'POST',\n            headers: headers,\n            body: JSON.stringify(body)\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _b.sent();\n          if (!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , response.json()];\n\n        case 2:\n          responseValue = _b.sent();\n          completedAuthToken = extractAuthTokenInfoFromResponse(responseValue);\n          return [2\n          /*return*/\n          , completedAuthToken];\n\n        case 3:\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Generate Auth Token', response)];\n\n        case 4:\n          throw _b.sent();\n      }\n    });\n  });\n}\n\nfunction getGenerateAuthTokenEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid + \"/authTokens:generate\";\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n/**\r\n * Returns a valid authentication token for the installation. Generates a new\r\n * token if one doesn't exist, is expired or about to expire.\r\n *\r\n * Should only be called if the Firebase Installation is registered.\r\n */\n\n\nfunction refreshAuthToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var tokenPromise, entry, authToken, _a;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , update(dependencies.appConfig, function (oldEntry) {\n            if (!isEntryRegistered(oldEntry)) {\n              throw ERROR_FACTORY.create(\"not-registered\"\n              /* NOT_REGISTERED */\n              );\n            }\n\n            var oldAuthToken = oldEntry.authToken;\n\n            if (!forceRefresh && isAuthTokenValid(oldAuthToken)) {\n              // There is a valid token in the DB.\n              return oldEntry;\n            } else if (oldAuthToken.requestStatus === 1\n            /* IN_PROGRESS */\n            ) {\n                // There already is a token request in progress.\n                tokenPromise = waitUntilAuthTokenRequest(dependencies, forceRefresh);\n                return oldEntry;\n              } else {\n              // No token or token expired.\n              if (!navigator.onLine) {\n                throw ERROR_FACTORY.create(\"app-offline\"\n                /* APP_OFFLINE */\n                );\n              }\n\n              var inProgressEntry = makeAuthTokenRequestInProgressEntry(oldEntry);\n              tokenPromise = fetchAuthTokenFromServer(dependencies, inProgressEntry);\n              return inProgressEntry;\n            }\n          })];\n\n        case 1:\n          entry = _b.sent();\n          if (!tokenPromise) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , tokenPromise];\n\n        case 2:\n          _a = _b.sent();\n          return [3\n          /*break*/\n          , 4];\n\n        case 3:\n          _a = entry.authToken;\n          _b.label = 4;\n\n        case 4:\n          authToken = _a;\n          return [2\n          /*return*/\n          , authToken];\n      }\n    });\n  });\n}\n/**\r\n * Call only if FID is registered and Auth Token request is in progress.\r\n *\r\n * Waits until the current pending request finishes. If the request times out,\r\n * tries once in this thread as well.\r\n */\n\n\nfunction waitUntilAuthTokenRequest(dependencies, forceRefresh) {\n  return __awaiter(this, void 0, void 0, function () {\n    var entry, authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 1:\n          entry = _a.sent();\n          _a.label = 2;\n\n        case 2:\n          if (!(entry.authToken.requestStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 5]; // generateAuthToken still in progress.\n\n          return [4\n          /*yield*/\n          , sleep(100)];\n\n        case 3:\n          // generateAuthToken still in progress.\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , updateAuthTokenRequest(dependencies.appConfig)];\n\n        case 4:\n          entry = _a.sent();\n          return [3\n          /*break*/\n          , 2];\n\n        case 5:\n          authToken = entry.authToken;\n\n          if (authToken.requestStatus === 0\n          /* NOT_STARTED */\n          ) {\n              // The request timed out or failed in a different call. Try again.\n              return [2\n              /*return*/\n              , refreshAuthToken(dependencies, forceRefresh)];\n            } else {\n            return [2\n            /*return*/\n            , authToken];\n          }\n\n      }\n    });\n  });\n}\n/**\r\n * Called only if there is a GenerateAuthToken request in progress.\r\n *\r\n * Updates the InstallationEntry in the DB based on the status of the\r\n * GenerateAuthToken request.\r\n *\r\n * Returns the updated InstallationEntry.\r\n */\n\n\nfunction updateAuthTokenRequest(appConfig) {\n  return update(appConfig, function (oldEntry) {\n    if (!isEntryRegistered(oldEntry)) {\n      throw ERROR_FACTORY.create(\"not-registered\"\n      /* NOT_REGISTERED */\n      );\n    }\n\n    var oldAuthToken = oldEntry.authToken;\n\n    if (hasAuthTokenRequestTimedOut(oldAuthToken)) {\n      return __assign(__assign({}, oldEntry), {\n        authToken: {\n          requestStatus: 0\n          /* NOT_STARTED */\n\n        }\n      });\n    }\n\n    return oldEntry;\n  });\n}\n\nfunction fetchAuthTokenFromServer(dependencies, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken, updatedInstallationEntry, e_1, updatedInstallationEntry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          _a.trys.push([0, 3,, 8]);\n\n          return [4\n          /*yield*/\n          , generateAuthTokenRequest(dependencies, installationEntry)];\n\n        case 1:\n          authToken = _a.sent();\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: authToken\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 2:\n          _a.sent();\n\n          return [2\n          /*return*/\n          , authToken];\n\n        case 3:\n          e_1 = _a.sent();\n          if (!(isServerError(e_1) && (e_1.serverCode === 401 || e_1.serverCode === 404))) return [3\n          /*break*/\n          , 5]; // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n\n          return [4\n          /*yield*/\n          , remove(dependencies.appConfig)];\n\n        case 4:\n          // Server returned a \"FID not found\" or a \"Invalid authentication\" error.\n          // Generate a new ID next time.\n          _a.sent();\n\n          return [3\n          /*break*/\n          , 7];\n\n        case 5:\n          updatedInstallationEntry = __assign(__assign({}, installationEntry), {\n            authToken: {\n              requestStatus: 0\n              /* NOT_STARTED */\n\n            }\n          });\n          return [4\n          /*yield*/\n          , set(dependencies.appConfig, updatedInstallationEntry)];\n\n        case 6:\n          _a.sent();\n\n          _a.label = 7;\n\n        case 7:\n          throw e_1;\n\n        case 8:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction isEntryRegistered(installationEntry) {\n  return installationEntry !== undefined && installationEntry.registrationStatus === 2\n  /* COMPLETED */\n  ;\n}\n\nfunction isAuthTokenValid(authToken) {\n  return authToken.requestStatus === 2\n  /* COMPLETED */\n  && !isAuthTokenExpired(authToken);\n}\n\nfunction isAuthTokenExpired(authToken) {\n  var now = Date.now();\n  return now < authToken.creationTime || authToken.creationTime + authToken.expiresIn < now + TOKEN_EXPIRATION_BUFFER;\n}\n/** Returns an updated InstallationEntry with an InProgressAuthToken. */\n\n\nfunction makeAuthTokenRequestInProgressEntry(oldEntry) {\n  var inProgressAuthToken = {\n    requestStatus: 1\n    /* IN_PROGRESS */\n    ,\n    requestTime: Date.now()\n  };\n  return __assign(__assign({}, oldEntry), {\n    authToken: inProgressAuthToken\n  });\n}\n\nfunction hasAuthTokenRequestTimedOut(authToken) {\n  return authToken.requestStatus === 1\n  /* IN_PROGRESS */\n  && authToken.requestTime + PENDING_TIMEOUT_MS < Date.now();\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getId(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var _a, installationEntry, registrationPromise;\n\n    return __generator(this, function (_b) {\n      switch (_b.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(dependencies.appConfig)];\n\n        case 1:\n          _a = _b.sent(), installationEntry = _a.installationEntry, registrationPromise = _a.registrationPromise;\n\n          if (registrationPromise) {\n            registrationPromise[\"catch\"](console.error);\n          } else {\n            // If the installation is already registered, update the authentication\n            // token if needed.\n            refreshAuthToken(dependencies)[\"catch\"](console.error);\n          }\n\n          return [2\n          /*return*/\n          , installationEntry.fid];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction _getToken(dependencies, forceRefresh) {\n  if (forceRefresh === void 0) {\n    forceRefresh = false;\n  }\n\n  return __awaiter(this, void 0, void 0, function () {\n    var authToken;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , completeInstallationRegistration(dependencies.appConfig)];\n\n        case 1:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , refreshAuthToken(dependencies, forceRefresh)];\n\n        case 2:\n          authToken = _a.sent();\n          return [2\n          /*return*/\n          , authToken.token];\n      }\n    });\n  });\n}\n\nfunction completeInstallationRegistration(appConfig) {\n  return __awaiter(this, void 0, void 0, function () {\n    var registrationPromise;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          return [4\n          /*yield*/\n          , getInstallationEntry(appConfig)];\n\n        case 1:\n          registrationPromise = _a.sent().registrationPromise;\n          if (!registrationPromise) return [3\n          /*break*/\n          , 3]; // A createInstallation request is in progress. Wait until it finishes.\n\n          return [4\n          /*yield*/\n          , registrationPromise];\n\n        case 2:\n          // A createInstallation request is in progress. Wait until it finishes.\n          _a.sent();\n\n          _a.label = 3;\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallationRequest(appConfig, installationEntry) {\n  return __awaiter(this, void 0, void 0, function () {\n    var endpoint, headers, request, response;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          endpoint = getDeleteEndpoint(appConfig, installationEntry);\n          headers = getHeadersWithAuth(appConfig, installationEntry);\n          request = {\n            method: 'DELETE',\n            headers: headers\n          };\n          return [4\n          /*yield*/\n          , retryIfServerError(function () {\n            return fetch(endpoint, request);\n          })];\n\n        case 1:\n          response = _a.sent();\n          if (!!response.ok) return [3\n          /*break*/\n          , 3];\n          return [4\n          /*yield*/\n          , getErrorFromResponse('Delete Installation', response)];\n\n        case 2:\n          throw _a.sent();\n\n        case 3:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n\nfunction getDeleteEndpoint(appConfig, _a) {\n  var fid = _a.fid;\n  return getInstallationsEndpoint(appConfig) + \"/\" + fid;\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction deleteInstallation(dependencies) {\n  return __awaiter(this, void 0, void 0, function () {\n    var appConfig, entry;\n    return __generator(this, function (_a) {\n      switch (_a.label) {\n        case 0:\n          appConfig = dependencies.appConfig;\n          return [4\n          /*yield*/\n          , update(appConfig, function (oldEntry) {\n            if (oldEntry && oldEntry.registrationStatus === 0\n            /* NOT_STARTED */\n            ) {\n                // Delete the unregistered entry without sending a deleteInstallation request.\n                return undefined;\n              }\n\n            return oldEntry;\n          })];\n\n        case 1:\n          entry = _a.sent();\n          if (!entry) return [3\n          /*break*/\n          , 6];\n          if (!(entry.registrationStatus === 1\n          /* IN_PROGRESS */\n          )) return [3\n            /*break*/\n            , 2]; // Can't delete while trying to register.\n\n          throw ERROR_FACTORY.create(\"delete-pending-registration\"\n          /* DELETE_PENDING_REGISTRATION */\n          );\n\n        case 2:\n          if (!(entry.registrationStatus === 2\n          /* COMPLETED */\n          )) return [3\n            /*break*/\n            , 6];\n          if (!!navigator.onLine) return [3\n          /*break*/\n          , 3];\n          throw ERROR_FACTORY.create(\"app-offline\"\n          /* APP_OFFLINE */\n          );\n\n        case 3:\n          return [4\n          /*yield*/\n          , deleteInstallationRequest(appConfig, entry)];\n\n        case 4:\n          _a.sent();\n\n          return [4\n          /*yield*/\n          , remove(appConfig)];\n\n        case 5:\n          _a.sent();\n\n          _a.label = 6;\n\n        case 6:\n          return [2\n          /*return*/\n          ];\n      }\n    });\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction extractAppConfig(app) {\n  var e_1, _a;\n\n  if (!app || !app.options) {\n    throw getMissingValueError('App Configuration');\n  }\n\n  if (!app.name) {\n    throw getMissingValueError('App Name');\n  } // Required app config keys\n\n\n  var configKeys = ['projectId', 'apiKey', 'appId'];\n\n  try {\n    for (var configKeys_1 = __values(configKeys), configKeys_1_1 = configKeys_1.next(); !configKeys_1_1.done; configKeys_1_1 = configKeys_1.next()) {\n      var keyName = configKeys_1_1.value;\n\n      if (!app.options[keyName]) {\n        throw getMissingValueError(keyName);\n      }\n    }\n  } catch (e_1_1) {\n    e_1 = {\n      error: e_1_1\n    };\n  } finally {\n    try {\n      if (configKeys_1_1 && !configKeys_1_1.done && (_a = configKeys_1[\"return\"])) _a.call(configKeys_1);\n    } finally {\n      if (e_1) throw e_1.error;\n    }\n  }\n\n  return {\n    appName: app.name,\n    projectId: app.options.projectId,\n    apiKey: app.options.apiKey,\n    appId: app.options.appId\n  };\n}\n\nfunction getMissingValueError(valueName) {\n  return ERROR_FACTORY.create(\"missing-app-config-values\"\n  /* MISSING_APP_CONFIG_VALUES */\n  , {\n    valueName: valueName\n  });\n}\n/**\r\n * @license\r\n * Copyright 2019 Google Inc.\r\n *\r\n * Licensed under the Apache License, Version 2.0 (the \"License\");\r\n * you may not use this file except in compliance with the License.\r\n * You may obtain a copy of the License at\r\n *\r\n *   http://www.apache.org/licenses/LICENSE-2.0\r\n *\r\n * Unless required by applicable law or agreed to in writing, software\r\n * distributed under the License is distributed on an \"AS IS\" BASIS,\r\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\r\n * See the License for the specific language governing permissions and\r\n * limitations under the License.\r\n */\n\n\nfunction registerInstallations(instance) {\n  var installationsName = 'installations';\n  instance.INTERNAL.registerComponent(new Component(installationsName, function (container) {\n    var app = container.getProvider('app').getImmediate(); // Throws if app isn't configured properly.\n\n    var appConfig = extractAppConfig(app);\n    var platformLoggerProvider = container.getProvider('platform-logger');\n    var dependencies = {\n      appConfig: appConfig,\n      platformLoggerProvider: platformLoggerProvider\n    };\n    return {\n      app: app,\n      getId: function getId() {\n        return _getId(dependencies);\n      },\n      getToken: function getToken(forceRefresh) {\n        return _getToken(dependencies, forceRefresh);\n      },\n      \"delete\": function _delete() {\n        return deleteInstallation(dependencies);\n      }\n    };\n  }, \"PUBLIC\"\n  /* PUBLIC */\n  ));\n  instance.registerVersion(name, version);\n}\n\nregisterInstallations(firebase);\nexport { registerInstallations };","// https://github.com/tc39/proposal-object-values-entries\nvar $export = require('./_export');\nvar $values = require('./_object-to-array')(false);\n\n$export($export.S, 'Object', {\n  values: function values(it) {\n    return $values(it);\n  }\n});\n","require(\"core-js/modules/es6.regexp.replace\");\n\nrequire(\"core-js/modules/es6.object.define-property\");\n\nrequire(\"core-js/modules/es6.array.for-each\");\n\nrequire(\"core-js/modules/es6.promise\");\n\nrequire(\"core-js/modules/es6.object.to-string\");\n\n(function (global, factory) {\n  typeof exports === 'object' && typeof module !== 'undefined' ? factory(exports) : typeof define === 'function' && define.amd ? define(['exports'], factory) : (global = global || self, factory(global.idb = {}));\n})(this, function (exports) {\n  'use strict';\n\n  function toArray(arr) {\n    return Array.prototype.slice.call(arr);\n  }\n\n  function promisifyRequest(request) {\n    return new Promise(function (resolve, reject) {\n      request.onsuccess = function () {\n        resolve(request.result);\n      };\n\n      request.onerror = function () {\n        reject(request.error);\n      };\n    });\n  }\n\n  function promisifyRequestCall(obj, method, args) {\n    var request;\n    var p = new Promise(function (resolve, reject) {\n      request = obj[method].apply(obj, args);\n      promisifyRequest(request).then(resolve, reject);\n    });\n    p.request = request;\n    return p;\n  }\n\n  function promisifyCursorRequestCall(obj, method, args) {\n    var p = promisifyRequestCall(obj, method, args);\n    return p.then(function (value) {\n      if (!value) return;\n      return new Cursor(value, p.request);\n    });\n  }\n\n  function proxyProperties(ProxyClass, targetProp, properties) {\n    properties.forEach(function (prop) {\n      Object.defineProperty(ProxyClass.prototype, prop, {\n        get: function get() {\n          return this[targetProp][prop];\n        },\n        set: function set(val) {\n          this[targetProp][prop] = val;\n        }\n      });\n    });\n  }\n\n  function proxyRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function proxyMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return this[targetProp][prop].apply(this[targetProp], arguments);\n      };\n    });\n  }\n\n  function proxyCursorRequestMethods(ProxyClass, targetProp, Constructor, properties) {\n    properties.forEach(function (prop) {\n      if (!(prop in Constructor.prototype)) return;\n\n      ProxyClass.prototype[prop] = function () {\n        return promisifyCursorRequestCall(this[targetProp], prop, arguments);\n      };\n    });\n  }\n\n  function Index(index) {\n    this._index = index;\n  }\n\n  proxyProperties(Index, '_index', ['name', 'keyPath', 'multiEntry', 'unique']);\n  proxyRequestMethods(Index, '_index', IDBIndex, ['get', 'getKey', 'getAll', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(Index, '_index', IDBIndex, ['openCursor', 'openKeyCursor']);\n\n  function Cursor(cursor, request) {\n    this._cursor = cursor;\n    this._request = request;\n  }\n\n  proxyProperties(Cursor, '_cursor', ['direction', 'key', 'primaryKey', 'value']);\n  proxyRequestMethods(Cursor, '_cursor', IDBCursor, ['update', 'delete']); // proxy 'next' methods\n\n  ['advance', 'continue', 'continuePrimaryKey'].forEach(function (methodName) {\n    if (!(methodName in IDBCursor.prototype)) return;\n\n    Cursor.prototype[methodName] = function () {\n      var cursor = this;\n      var args = arguments;\n      return Promise.resolve().then(function () {\n        cursor._cursor[methodName].apply(cursor._cursor, args);\n\n        return promisifyRequest(cursor._request).then(function (value) {\n          if (!value) return;\n          return new Cursor(value, cursor._request);\n        });\n      });\n    };\n  });\n\n  function ObjectStore(store) {\n    this._store = store;\n  }\n\n  ObjectStore.prototype.createIndex = function () {\n    return new Index(this._store.createIndex.apply(this._store, arguments));\n  };\n\n  ObjectStore.prototype.index = function () {\n    return new Index(this._store.index.apply(this._store, arguments));\n  };\n\n  proxyProperties(ObjectStore, '_store', ['name', 'keyPath', 'indexNames', 'autoIncrement']);\n  proxyRequestMethods(ObjectStore, '_store', IDBObjectStore, ['put', 'add', 'delete', 'clear', 'get', 'getAll', 'getKey', 'getAllKeys', 'count']);\n  proxyCursorRequestMethods(ObjectStore, '_store', IDBObjectStore, ['openCursor', 'openKeyCursor']);\n  proxyMethods(ObjectStore, '_store', IDBObjectStore, ['deleteIndex']);\n\n  function Transaction(idbTransaction) {\n    this._tx = idbTransaction;\n    this.complete = new Promise(function (resolve, reject) {\n      idbTransaction.oncomplete = function () {\n        resolve();\n      };\n\n      idbTransaction.onerror = function () {\n        reject(idbTransaction.error);\n      };\n\n      idbTransaction.onabort = function () {\n        reject(idbTransaction.error);\n      };\n    });\n  }\n\n  Transaction.prototype.objectStore = function () {\n    return new ObjectStore(this._tx.objectStore.apply(this._tx, arguments));\n  };\n\n  proxyProperties(Transaction, '_tx', ['objectStoreNames', 'mode']);\n  proxyMethods(Transaction, '_tx', IDBTransaction, ['abort']);\n\n  function UpgradeDB(db, oldVersion, transaction) {\n    this._db = db;\n    this.oldVersion = oldVersion;\n    this.transaction = new Transaction(transaction);\n  }\n\n  UpgradeDB.prototype.createObjectStore = function () {\n    return new ObjectStore(this._db.createObjectStore.apply(this._db, arguments));\n  };\n\n  proxyProperties(UpgradeDB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(UpgradeDB, '_db', IDBDatabase, ['deleteObjectStore', 'close']);\n\n  function DB(db) {\n    this._db = db;\n  }\n\n  DB.prototype.transaction = function () {\n    return new Transaction(this._db.transaction.apply(this._db, arguments));\n  };\n\n  proxyProperties(DB, '_db', ['name', 'version', 'objectStoreNames']);\n  proxyMethods(DB, '_db', IDBDatabase, ['close']); // Add cursor iterators\n  // TODO: remove this once browsers do the right thing with promises\n\n  ['openCursor', 'openKeyCursor'].forEach(function (funcName) {\n    [ObjectStore, Index].forEach(function (Constructor) {\n      // Don't create iterateKeyCursor if openKeyCursor doesn't exist.\n      if (!(funcName in Constructor.prototype)) return;\n\n      Constructor.prototype[funcName.replace('open', 'iterate')] = function () {\n        var args = toArray(arguments);\n        var callback = args[args.length - 1];\n        var nativeObject = this._store || this._index;\n        var request = nativeObject[funcName].apply(nativeObject, args.slice(0, -1));\n\n        request.onsuccess = function () {\n          callback(request.result);\n        };\n      };\n    });\n  }); // polyfill getAll\n\n  [Index, ObjectStore].forEach(function (Constructor) {\n    if (Constructor.prototype.getAll) return;\n\n    Constructor.prototype.getAll = function (query, count) {\n      var instance = this;\n      var items = [];\n      return new Promise(function (resolve) {\n        instance.iterateCursor(query, function (cursor) {\n          if (!cursor) {\n            resolve(items);\n            return;\n          }\n\n          items.push(cursor.value);\n\n          if (count !== undefined && items.length == count) {\n            resolve(items);\n            return;\n          }\n\n          cursor[\"continue\"]();\n        });\n      });\n    };\n  });\n\n  function openDb(name, version, upgradeCallback) {\n    var p = promisifyRequestCall(indexedDB, 'open', [name, version]);\n    var request = p.request;\n\n    if (request) {\n      request.onupgradeneeded = function (event) {\n        if (upgradeCallback) {\n          upgradeCallback(new UpgradeDB(request.result, event.oldVersion, request.transaction));\n        }\n      };\n    }\n\n    return p.then(function (db) {\n      return new DB(db);\n    });\n  }\n\n  function deleteDb(name) {\n    return promisifyRequestCall(indexedDB, 'deleteDatabase', [name]);\n  }\n\n  exports.openDb = openDb;\n  exports.deleteDb = deleteDb;\n  Object.defineProperty(exports, '__esModule', {\n    value: true\n  });\n});"],"sourceRoot":""}